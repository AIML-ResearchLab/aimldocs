<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Ganesh kinkar Giri" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>AWS - AIML documents</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "AWS";
        var mkdocs_page_input_path = "AgenticAI/aws.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> AIML documents
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">AIML</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >Programing</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Programing/python.html">PYTHON</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Statistic</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >Descriptive Statistics</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Measures of Central Tendency</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Central-Tendency/Mean.html">Mean</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Central-Tendency/Median.html">Median</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Central-Tendency/Mode.html">Mode</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Measures of Position (Relative Standing)</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Position-Relative-Standing/Percentiles.html">Percentiles</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Position-Relative-Standing/Quartiles.html">Quartiles</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Position-Relative-Standing/Deciles.html">Deciles</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Position-Relative-Standing/Z-Score.html">Z-Score</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Shape of the Distribution</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Shape-of-the-Distribution/Skewness.html">Skewness</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Shape-of-the-Distribution/Kurtosis.html">Kurtosis</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Visualization Tools</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/Histogram.html">Histogram</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/BarChart.html">Bar Chart</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/PieChart.html">Pie Chart</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/BoxPlot.html">Box Plot</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/LinePlot.html">Line Plot</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/DotPlot.html">Dot Plot</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Measures of Dispersion (Variability)</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/Range.html">Range</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/Variance.html">Variance</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/StandardDeviation.html">Standard Deviation</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/InterquartileRange.html">Interquartile Range(IQR)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/CofficientVariation.html">Cofficient of Variation</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Inferential Statistics</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Population and Sample</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Population-and-Sample/Population.html">Population</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Population-and-Sample/Sample.html">Sample</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Population-and-Sample/SamplingMethods.html">Sampling Methods</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Estimation</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Estimation/PointEstimation.html">Point Estimation</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Estimation/IntervalEstimation.html">Interval Estimation</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Estimation/MarginError.html">Margin of Error</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Regression and Correlation Analysis</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Regression-and-Correlation-Analysis/LinearRegression.html">Linear Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Regression-and-Correlation-Analysis/LogisticRegression.html">Logistic Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Regression-and-Correlation-Analysis/MultipleRegression.html">Multiple Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Regression-and-Correlation-Analysis/CorrelationCoefficients.html">Correlation Coefficients</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Hypothesis Testing</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/NullHypothesis.html">Null Hypothesis (H₀)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/AlternativeHypothesis.html">Alternative Hypothesis (H₁)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/TestStatistic.html">Test Statistic</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/pvalue.html">p-value</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/SignificanceLevel.html">Significance Level (α)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/TypeIError.html">Type I Error (α)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/TypeIIError.html">Type II Error (β)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/PoweroftheTest.html">Power of the Test</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Parametric Tests</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Parametric-Tests/t-test.html">t-test</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Parametric-Tests/z-test.html">z-test</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Parametric-Tests/ANOVA.html">ANOVA</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Parametric-Tests/F-test.html">F-test</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Non-Parametric Tests</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Non-Parametric-Tests/Mann-WhitneyU.html">Mann-Whitney U</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Non-Parametric-Tests/Kruskal-Wallis.html">Kruskal-Wallis</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Non-Parametric-Tests/Wilcoxon.html">Wilcoxon</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Non-Parametric-Tests/Chi-square.html">Chi-square</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Resampling Methods</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Resampling-Methods/Bootstrapping.html">Bootstrapping</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Resampling-Methods/Jackknife.html">Jackknife</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Analysis of Variance (ANOVA)</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/ANOVA/One-way-ANOVA.html">One-way ANOVA</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/ANOVA/Two-way-ANOVA.html">Two-way ANOVA</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/ANOVA/Post-hoc-Tests.html">Post-hoc Tests</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Probability Theory</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Probability-Theory/ProbabilityDistributions.html">Probability Distributions</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Probability-Theory/CentralLimitTheorem.html">Central Limit Theorem</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Probability-Theory/BayesianInference.html">Bayesian Inference</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Time Series</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Trend.html">Trend</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Seasonality.html">Seasonality</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Cyclic.html">Cyclic</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Noise.html">Irregular/Noise</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Stationarity.html">Stationarity</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Non-stationary.html">Non-stationary</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Autocorrelation.html">Autocorrelation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Lag.html">Lag</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/MovingAverages.html">Moving Averages</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Holt-Winters.html">Holt-Winters Method</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Additive.html">Additive</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Multiplicative.html">Multiplicative</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/AR.html">AR (Auto Regression)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/ARIMA.html">ARIMA</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Arimax.html">Arimax</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Sarimax.html">Sarimax</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Smoothing.html">Smoothing</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/AutomatedForecasting.html">Automated Forecasting</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/AutomatedTimeSeries.html">Automated Time Series</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Multivariate.html">Uni, Bi and Multivariate</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Statistic/metrics.html">Metrics Evaluation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Statistic/timeseries.html">Time Series Old</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Statistic/statistic-details.html">Statistic Details</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Data manipulation and analysis</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Data-manipulation-and-analysis/data-manipulation-analysis.html">PANDAS</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Data Processing</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Data-processing/sql.html">Basic SQL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Data-processing/sql-datascience.html">Using SQL for Data Science</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Data-processing/unstructured-data.html">Unstructured Data</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Data-processing/exploratory-data-analysis.html">Exploratory Data Analysis(EDA)</a>
                </li>
                <li class="toctree-l2"><a class="" href="../Data-processing/building-ml-models-on-text-data.md">Building ML Models on Text Data</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Databases</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Databases/PostgreSQL.html">PostgreSQL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Databases/MySQL.html">MySQL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Databases/MongoDB.html">MongoDB</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Machine Learning</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../MachineLearning/Overview.html">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Supervised Learning</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/Overview.html">Overview</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/Regression.html">Regression</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/Classification.html">Classification</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/CrossValidation.html">Cross Validation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/HyperparameterTuning.html">Hyperparameter Tuning</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/TuningDecisionThreshold.html">Tuning decision threshold</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Regression Models</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/SimpleLinearRegression.html">Simple Linear Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/MultipleLinearRegression.html">Multiple Linear Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/PolynomialRegression.html">Polynomial Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/RidgeLassoRegression.html">Ridge & Lasso Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/SupportVectorRegression.html">Support Vector Regression (SVR)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/DecisionTreeRegression.html">Decision Tree Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/RandomForestRegression.html">Random Forest Regression</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Linear Classification Models</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/LinearClassificationModels/LogisticRegression.html">Logistic Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/LinearClassificationModels/SupportVectorMachines.html">Support Vector Machines</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/LinearClassificationModels/SinglelayerPerceptron.html">Single-layer Perceptron</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/LinearClassificationModels/StochasticGradientDescent.html">Stochastic Gradient Descent (SGD)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Non-linear Classification Models</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/DecisionTreeClassification.html">Decision Tree Classification</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/KNearestNeighbours.html">K-Nearest Neighbours</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/NaiveBayes.html">Naive Bayes</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/RandomForests.html">Random Forests</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/AdaBoost.html">AdaBoost</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/BaggingClassifier.html">Bagging Classifier</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/Ensemblelearningclassifiers.html">Ensemble learning classifiers</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/KernelSVM.html">Kernel SVM</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Unsupervised Learning</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/UnsupervisedLearning/overview.html">Overview</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/UnsupervisedLearning/Clustering.html">Clustering</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/UnsupervisedLearning/Pca.html">Principal Component Analysis(PCA)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Reinforcement Learning</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/ReinforcementLearning/ReinforcementLearning.html">Overview</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Linear Algebra</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../LinearAlgebra/Overview.html">Overview</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Deep Learning</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../DeepLearning/Overview.html">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../DeepLearning/Vanishing.html">Vanishing and Exploding Gradients Problems</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Components of Neural Networks</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/LayersNeuralNetworks.html">Layers in Neural Networks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/WeightsBiases.html">Weights and Biases</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/ForwardPropagation.html">Forward Propagation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/ActivationFunctions.html">Activation Functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/LossFunctions.html">Loss Functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/Backpropagation.html">Backpropagation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/LearningRate.html">Learning Rate</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Optimization Algorithm</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/GradientDescent.html">Gradient Descent</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/SGD.html">Stochastic Gradient Descent (SGD)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/Adam.html">Adam (Adaptive Moment Estimation)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/BatchNormalization.html">Batch Normalization</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/Mini-batch-GD.html">Mini-batch Gradient Descent</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/Momentum-based-GO.html">Momentum-based Gradient Optimizer</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/AdagradOptimizer.html">Adagrad Optimizer</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/RMSPropOptimizer.html">RMSProp Optimizer</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Models</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/FNN.html">Feedforward Neural Network (FNN)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Recurrent Neural Network (RNN)</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../DeepLearning/Models/RNN.html">Recurrent Neural Network (RNN)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../DeepLearning/Models/LSTM.html">LSTM (Long Short-Term Memory)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../DeepLearning/Models/GRU.html">GRU (Gated Recurrent Unit)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/CNN.html">Convolutional Neural Network (CNN)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/RBFN.html">Radial Basis Function Network (RBFN)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/ComputerVision.html">Computer Vision</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/GANs.html">Generative Adversarial Networks (GANs)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/Transformer.html">Transformer Networks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/Autoencoders.html">Autoencoders</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/SOM.html">Self-Organizing Maps (SOM)</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Natural Language Processing(NLP)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../NLP/overview.html">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../NLP/nlpdetails.html">NLP Details</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Retrieval-Augmented Generation(RAG)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../RAG/rag.html">RAG</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >AI agents</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../AIagents/aiagents.html">AI agents</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Agentic AI</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="general.html">general</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="crewai.html">crewai</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="LangGraph.html">LangGraph</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="AutoGen.html">AutoGen</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">AWS</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="azure.html">AZURE</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Agent Development Kit</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="GCP/adk.html">ADK</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="GCP/Agents.html">Agents</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="GCP/Tools.html">Tools</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="GCP/a2a.html">Tools</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >MCPModel Context Protocol (MCP)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../MCP/mcp.html">MCP</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Models Details information</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Models/Ollama.html">Ollama</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Note Book</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Notebook/allnotebook.html">All Notebook</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AIML documents</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">AIML</li>
          <li class="breadcrumb-item">Agentic AI</li>
      <li class="breadcrumb-item active">AWS</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="aws-agentic-ai-services">AWS Agentic AI Services<a class="headerlink" href="#aws-agentic-ai-services" title="Permanent link">#</a></h2>
<p><img alt="alt text" src="image/aws-1.png" /></p>
<p><img alt="alt text" src="image/aws-2.png" /></p>
<p><img alt="alt text" src="image/aws-3.png" /></p>
<p><img alt="alt text" src="image/aws-4.png" /></p>
<p><img alt="alt text" src="image/aws-5.png" /></p>
<p><a href="https://www.youtube.com/watch?v=6O9DqCrInvw">Amazon Bedrock Agents</a></p>
<p><a href="https://aws.amazon.com/blogs/machine-learning/build-agentic-ai-solutions-with-deepseek-r1-crewai-and-amazon-sagemaker-ai/">Amazon-sagemaker</a></p>
<table>
<thead>
<tr>
<th><strong>Service</strong></th>
<th><strong>Description</strong></th>
<th><strong>Service Type</strong></th>
<th><strong>SaaS / Shelf-Managed</strong></th>
<th><strong>Use Case Example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Amazon Rekognition</td>
<td>Computer vision for image and video analysis</td>
<td>Computer Vision</td>
<td>SaaS</td>
<td>Detect faces and objects in surveillance footage</td>
</tr>
<tr>
<td>Amazon Transcribe</td>
<td>Speech-to-text for real-time or batch transcription</td>
<td>Speech Recognition</td>
<td>SaaS</td>
<td>Transcribe customer service calls</td>
</tr>
<tr>
<td>Amazon Translate</td>
<td>Neural machine translation</td>
<td>Translation / NLP</td>
<td>SaaS</td>
<td>Translate product descriptions for global marketplaces</td>
</tr>
<tr>
<td>Amazon Polly</td>
<td>Text-to-speech for lifelike speech generation</td>
<td>Speech Synthesis</td>
<td>SaaS</td>
<td>Generate lifelike voices for e-learning apps</td>
</tr>
<tr>
<td>Amazon Comprehend</td>
<td>NLP for text insights like sentiment analysis</td>
<td>Natural Language Processing</td>
<td>SaaS</td>
<td>Analyze customer reviews for sentiment and key phrases</td>
</tr>
<tr>
<td>Amazon Textract</td>
<td>Text and data extraction from documents</td>
<td>Document Processing</td>
<td>SaaS</td>
<td>Extract tables and fields from scanned invoices</td>
</tr>
<tr>
<td>Amazon Personalize</td>
<td>Personalized recommendations and user segmentation</td>
<td>Recommendation System</td>
<td>SaaS</td>
<td>Product recommendation for e-commerce platform</td>
</tr>
<tr>
<td>Amazon Augmented AI (A2I)</td>
<td>Human review of ML predictions</td>
<td>Human-in-the-loop (HITL)</td>
<td>Shelf-Managed</td>
<td>Review flagged document classifications in loan processing</td>
</tr>
<tr>
<td>Amazon Bedrock</td>
<td>Access to foundation models for generative AI apps</td>
<td>Generative AI / Foundation Models</td>
<td>SaaS</td>
<td>Build a chatbot using Anthropic, Mistral, or Meta models</td>
</tr>
<tr>
<td>Amazon Q</td>
<td>Generative AI assistant for development and business insights</td>
<td>Generative AI Assistant</td>
<td>SaaS</td>
<td>Get coding help or business data insights via natural queries</td>
</tr>
<tr>
<td>Amazon SageMaker</td>
<td>Comprehensive platform for ML and foundation models</td>
<td>ML Platform / MLOps</td>
<td>Shelf-Managed</td>
<td>Train, deploy, and monitor custom ML models</td>
</tr>
<tr>
<td>Amazon CodeGuru</td>
<td>ML for code analysis and optimization</td>
<td>DevOps / Code Quality</td>
<td>SaaS</td>
<td>Detect bugs and optimize code performance</td>
</tr>
<tr>
<td>Amazon DevOps Guru</td>
<td>ML for operational data analysis and issue resolution</td>
<td>DevOps / AIOps</td>
<td>SaaS</td>
<td>Detect anomalies in application performance metrics</td>
</tr>
<tr>
<td>AWS HealthLake</td>
<td>HIPAA-eligible for healthcare data management</td>
<td>Healthcare Data Platform</td>
<td>Shelf-Managed</td>
<td>Normalize and analyze patient health records</td>
</tr>
<tr>
<td>Amazon Lex</td>
<td>Conversational interfaces like chatbots and voice assistants</td>
<td>Conversational AI</td>
<td>SaaS</td>
<td>Create a customer support chatbot</td>
</tr>
</tbody>
</table>
<h2 id="sample-agentic-ai-workflow">Sample Agentic AI Workflow<a class="headerlink" href="#sample-agentic-ai-workflow" title="Permanent link">#</a></h2>
<p>To set up a Multi-Agent System using AWS Bedrock with a real working example, you can follow this structured, practical approach using AWS Bedrock + AWS Lambda + AWS Step Functions (no external server needed). This example will simulate agents working together in a typical IT Support scenario:</p>
<h2 id="use-case-it-support-chatbot-with-multi-agents">🎯 Use Case: IT Support Chatbot with Multi-Agents<a class="headerlink" href="#use-case-it-support-chatbot-with-multi-agents" title="Permanent link">#</a></h2>
<h2 id="agents">🧠 Agents:<a class="headerlink" href="#agents" title="Permanent link">#</a></h2>
<ol>
<li><strong>Classifier Agent</strong> – Classifies user intent (e.g., knowledge/action).</li>
<li><strong>Knowledge Agent</strong> – Answers general IT questions.</li>
<li><strong>Action Agent</strong> – Simulates action (e.g., reset password).</li>
</ol>
<h2 id="what-youll-build">🛠️ What You’ll Build<a class="headerlink" href="#what-youll-build" title="Permanent link">#</a></h2>
<p>Using <strong>AWS Console (UI)</strong>:</p>
<ul>
<li>Use <strong>Amazon Bedrock</strong> to call Claude/Titan models.</li>
<li>Use <strong>AWS Lambda</strong> to create agents as serverless functions.</li>
<li>Use <strong>AWS Step Functions</strong> to orchestrate agent flow based on logic.</li>
</ul>
<h2 id="step-by-step-setup-ui-lambda-bedrock">✅ Step-by-Step Setup (UI + Lambda + Bedrock)<a class="headerlink" href="#step-by-step-setup-ui-lambda-bedrock" title="Permanent link">#</a></h2>
<h2 id="step-1-enable-amazon-bedrock-models">🔹 STEP 1: Enable Amazon Bedrock Models<a class="headerlink" href="#step-1-enable-amazon-bedrock-models" title="Permanent link">#</a></h2>
<ol>
<li>Go to: <strong>Amazon Bedrock &gt; Model Access</strong></li>
<li>Enable Claude (Anthropic) or any model you'd like (Titan, Mistral, Llama)</li>
</ol>
<h2 id="step-2-create-iam-role-with-bedrock-access">🔹 STEP 2: Create IAM Role with Bedrock Access<a class="headerlink" href="#step-2-create-iam-role-with-bedrock-access" title="Permanent link">#</a></h2>
<ol>
<li>Go to <strong>IAM &gt; Roles &gt; Create Role</strong></li>
<li>Choose: Lambda</li>
<li>Attach Policy: AmazonBedrockFullAccess + AWSLambdaBasicExecutionRole</li>
<li>Name the role: LambdaBedrockRole</li>
</ol>
<h2 id="step-3-create-3-lambda-functions-1-per-agent">🔹 STEP 3: Create 3 Lambda Functions (1 per Agent)<a class="headerlink" href="#step-3-create-3-lambda-functions-1-per-agent" title="Permanent link">#</a></h2>
<h2 id="a-classifier-agent-lambda">A. Classifier Agent Lambda<a class="headerlink" href="#a-classifier-agent-lambda" title="Permanent link">#</a></h2>
<ol>
<li>Name: classifierAgent</li>
<li>Runtime: Python 3.12</li>
<li>Use this code</li>
</ol>
<h2 id="code">code<a class="headerlink" href="#code" title="Permanent link">#</a></h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Classify this request into either &#39;knowledge&#39; or &#39;action&#39;: </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;user_input&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">bedrock</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;bedrock-runtime&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">bedrock</span><span class="o">.</span><span class="n">invoke_model</span><span class="p">(</span>
        <span class="n">modelId</span><span class="o">=</span><span class="s1">&#39;amazon.titan-text-premier-v1:0&#39;</span><span class="p">,</span>
        <span class="n">contentType</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="n">accept</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s2">&quot;inputText&quot;</span><span class="p">:</span> <span class="n">prompt</span>
        <span class="p">})</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">classification</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;outputText&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span> <span class="n">classification</span> <span class="p">}</span>
</code></pre></div>

<h2 id="b-knowledge-agent-lambda">B. Knowledge Agent Lambda<a class="headerlink" href="#b-knowledge-agent-lambda" title="Permanent link">#</a></h2>
<ol>
<li>Name: KnowledgeAgent</li>
<li>Runtime: Python 3.12</li>
<li>Use this code</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;You are an IT support expert. Answer the user&#39;s question: </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;user_input&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">bedrock</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;bedrock-runtime&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">bedrock</span><span class="o">.</span><span class="n">invoke_model</span><span class="p">(</span>
        <span class="n">modelId</span><span class="o">=</span><span class="s1">&#39;amazon.titan-text-premier-v1:0&#39;</span><span class="p">,</span>
        <span class="n">contentType</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="n">accept</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s2">&quot;inputText&quot;</span><span class="p">:</span> <span class="n">prompt</span>
        <span class="p">})</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;agent&quot;</span><span class="p">:</span> <span class="s2">&quot;knowledge&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;outputText&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div>

<h2 id="c-action-agent-lambda">C. Action Agent Lambda<a class="headerlink" href="#c-action-agent-lambda" title="Permanent link">#</a></h2>
<ol>
<li>Name: ActionAgent</li>
<li>Runtime: Python 3.12</li>
<li>Use this code</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;You are an IT support automation bot. Respond to this action request: </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;user_input&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">bedrock</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;bedrock-runtime&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>  <span class="c1"># include region</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">bedrock</span><span class="o">.</span><span class="n">invoke_model</span><span class="p">(</span>
        <span class="n">modelId</span><span class="o">=</span><span class="s1">&#39;amazon.titan-text-premier-v1:0&#39;</span><span class="p">,</span>
        <span class="n">contentType</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="n">accept</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s2">&quot;inputText&quot;</span><span class="p">:</span> <span class="n">prompt</span>
        <span class="p">})</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;agent&quot;</span><span class="p">:</span> <span class="s2">&quot;action&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;outputText&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="p">}</span>
</code></pre></div>

<h2 id="step-4-create-a-step-function-for-orchestration">🔹 STEP 4: Create a Step Function for Orchestration<a class="headerlink" href="#step-4-create-a-step-function-for-orchestration" title="Permanent link">#</a></h2>
<p>Go to <strong>AWS Step Functions &gt; Create State Machine</strong>
   Choose <strong>Author with Code Snippet</strong>
   Paste the following Amazon States Language (ASL):</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;Comment&quot;: &quot;Multi-Agent Orchestration for IT Support&quot;,
  &quot;StartAt&quot;: &quot;ClassifierAgent&quot;,
  &quot;States&quot;: {
    &quot;ClassifierAgent&quot;: {
      &quot;Type&quot;: &quot;Task&quot;,
      &quot;Resource&quot;: &quot;arn:aws:lambda:us-east-1:777203855866:function:classifierAgent&quot;,
      &quot;ResultPath&quot;: &quot;$.classificationResult&quot;,
      &quot;Next&quot;: &quot;CheckClassification&quot;
    },
    &quot;CheckClassification&quot;: {
      &quot;Type&quot;: &quot;Choice&quot;,
      &quot;Choices&quot;: [
        {
          &quot;Variable&quot;: &quot;$.classificationResult.classification&quot;,
          &quot;StringMatches&quot;: &quot;*knowledge*&quot;,
          &quot;Next&quot;: &quot;KnowledgeAgent&quot;
        },
        {
          &quot;Variable&quot;: &quot;$.classificationResult.classification&quot;,
          &quot;StringMatches&quot;: &quot;*action*&quot;,
          &quot;Next&quot;: &quot;ActionAgent&quot;
        }
      ],
      &quot;Default&quot;: &quot;UnknownClassification&quot;
    },
    &quot;KnowledgeAgent&quot;: {
      &quot;Type&quot;: &quot;Task&quot;,
      &quot;Resource&quot;: &quot;arn:aws:lambda:us-east-1:777203855866:function:KnowledgeAgent&quot;,
      &quot;ResultPath&quot;: &quot;$.response&quot;,
      &quot;End&quot;: true
    },
    &quot;ActionAgent&quot;: {
      &quot;Type&quot;: &quot;Task&quot;,
      &quot;Resource&quot;: &quot;arn:aws:lambda:us-east-1:777203855866:function:ActionAgent&quot;,
      &quot;ResultPath&quot;: &quot;$.response&quot;,
      &quot;End&quot;: true
    },
    &quot;UnknownClassification&quot;: {
      &quot;Type&quot;: &quot;Fail&quot;,
      &quot;Error&quot;: &quot;InvalidClassification&quot;,
      &quot;Cause&quot;: &quot;Could not classify the user request&quot;
    }
  }
}
</code></pre></div>

<h2 id="step-5-test-the-multi-agent-system">🔹 STEP 5: Test the Multi-Agent System<a class="headerlink" href="#step-5-test-the-multi-agent-system" title="Permanent link">#</a></h2>
<p>Go to Step Functions &gt; Your State Machine
   Click Start Execution
   Use this test input:</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;user_input&quot;: &quot;How can I install VPN on my laptop?&quot;
}
</code></pre></div>

<p><img alt="Agenticai" src="image/agentic-1.png" /></p>
<p><img alt="Agenticai" src="image/agentic-2.png" /></p>
<p><img alt="Agenticai" src="image/agentic-3.png" /></p>
<h1 id="building-a-simple-agent-using-aws-bedrock">Building a Simple Agent Using AWS Bedrock<a class="headerlink" href="#building-a-simple-agent-using-aws-bedrock" title="Permanent link">#</a></h1>
<h2 id="step-1-create-a-lambda-function">Step 1: Create a Lambda Function<a class="headerlink" href="#step-1-create-a-lambda-function" title="Permanent link">#</a></h2>
<p>First, create a Lambda function that your agent will invoke to perform actions. In this procedure, you'll create a Python Lambda function that returns the current date and time when invoked. You'll set up the function with basic permissions, add the necessary code to handle requests from your Amazon Bedrock agent, and deploy the function so it's ready to be connected to your agent.</p>
<hr />
<h3 id="create-a-lambda-function">Create a Lambda Function<a class="headerlink" href="#create-a-lambda-function" title="Permanent link">#</a></h3>
<ol>
<li>
<p>Sign in to the AWS Management Console and open the Lambda console at<br />
<a href="https://console.aws.amazon.com/lambda/">https://console.aws.amazon.com/lambda/</a></p>
</li>
<li>
<p>Choose <strong>Create function</strong>.</p>
</li>
<li>
<p>Select <strong>Author from scratch</strong>.</p>
</li>
<li>
<p>In the <strong>Basic information</strong> section:</p>
</li>
<li>For <strong>Function name</strong>, enter a function name (for example, <code>DateTimeFunction</code>).</li>
<li>For <strong>Runtime</strong>, select <strong>Python 3.9</strong> (or your preferred version).</li>
<li>For <strong>Architecture</strong>, leave unchanged.</li>
<li>
<p>In <strong>Permissions</strong>, select <strong>Change default execution role</strong> and then select <strong>Create a new role with basic Lambda permissions</strong>.</p>
</li>
<li>
<p>Choose <strong>Create function</strong>.</p>
</li>
<li>
<p>In <strong>Function overview</strong>, under <strong>Function ARN</strong>, note the Amazon Resource Name (ARN) for the function.</p>
</li>
<li>
<p>In the <strong>Code</strong> tab, replace the existing code with the following:</p>
<div class="codehilite"><pre><span></span><code>  <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
      <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

      <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
          <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)</span>
      <span class="p">}</span>

      <span class="n">response_body</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;application/json&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
          <span class="p">}</span>
      <span class="p">}</span>

      <span class="n">action_response</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;actionGroup&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;actionGroup&quot;</span><span class="p">],</span>
          <span class="s2">&quot;apiPath&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;apiPath&quot;</span><span class="p">],</span>
          <span class="s2">&quot;httpMethod&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;httpMethod&quot;</span><span class="p">],</span>
          <span class="s2">&quot;httpStatusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
          <span class="s2">&quot;responseBody&quot;</span><span class="p">:</span> <span class="n">response_body</span><span class="p">,</span>
      <span class="p">}</span>

      <span class="n">session_attributes</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;sessionAttributes&quot;</span><span class="p">]</span>
      <span class="n">prompt_session_attributes</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">]</span>

      <span class="k">return</span> <span class="p">{</span>
          <span class="s2">&quot;messageVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
          <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">action_response</span><span class="p">,</span>
          <span class="s2">&quot;sessionAttributes&quot;</span><span class="p">:</span> <span class="n">session_attributes</span><span class="p">,</span>
          <span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">:</span> <span class="n">prompt_session_attributes</span><span class="p">,</span>
      <span class="p">}</span>
</code></pre></div>

</li>
<li>
<p>Choose <strong>Deploy</strong> to deploy your function.</p>
</li>
<li>
<p>Choose the <strong>Configuration</strong> tab.</p>
</li>
<li>
<p>Choose <strong>Permissions</strong>.</p>
</li>
<li>
<p>Under <strong>Resource-based policy statements</strong>, choose <strong>Add permissions</strong>.</p>
</li>
<li>
<p>In <strong>Edit policy statement</strong>, do the following:</p>
<ul>
<li>a. Choose <strong>AWS service</strong></li>
<li>b. In <strong>Service</strong>, select <strong>Other</strong>.</li>
<li>c. For <strong>Statement ID</strong>, enter a unique identifier (for example, <code>AllowBedrockInvocation</code>).</li>
<li>d. For <strong>Principal</strong>, enter <code>bedrock.amazonaws.com</code>.</li>
<li>
<p>e. For <strong>Source ARN</strong>, enter:</p>
<p><code>arn:aws:bedrock:&lt;region&gt;:&lt;AWS account ID&gt;:agent/*</code></p>
<p>Replace <code>&lt;region&gt;</code> with your AWS Region, such as <code>us-east-1</code>.<br />
Replace <code>&lt;AWS account ID&gt;</code> with your actual AWS account ID.</p>
</li>
</ul>
</li>
<li>
<p>Choose <strong>Save</strong>.</p>
</li>
</ol>
<h1 id="building-a-simple-agent-using-aws-bedrock_1">Building a Simple Agent Using AWS Bedrock<a class="headerlink" href="#building-a-simple-agent-using-aws-bedrock_1" title="Permanent link">#</a></h1>
<h2 id="step-2-create-a-bedrock-agent">Step 2: Create a Bedrock Agent<a class="headerlink" href="#step-2-create-a-bedrock-agent" title="Permanent link">#</a></h2>
<h3 id="1-sign-in-and-open-bedrock-console">1. Sign in and Open Bedrock Console<a class="headerlink" href="#1-sign-in-and-open-bedrock-console" title="Permanent link">#</a></h3>
<ul>
<li>Sign in to the <a href="https://console.aws.amazon.com/">AWS Management Console</a> using an <strong>IAM role with Amazon Bedrock permissions</strong>.</li>
<li>Navigate to the <a href="https://console.aws.amazon.com/bedrock/">Amazon Bedrock console</a>.</li>
<li>Ensure you're in an <strong>AWS Region</strong> that supports <strong>Amazon Bedrock agents</strong>.</li>
</ul>
<h3 id="2-create-an-agent">2. Create an Agent<a class="headerlink" href="#2-create-an-agent" title="Permanent link">#</a></h3>
<ol>
<li>In the left navigation pane under <strong>Builder tools</strong>, choose <strong>Agents</strong>.</li>
<li>Choose <strong>Create agent</strong>.</li>
<li>Fill in the following:</li>
<li><strong>Name</strong>: (e.g., <code>MyBedrockAgent</code>)</li>
<li><strong>Description</strong> (optional)</li>
<li>Choose <strong>Create</strong>. The <strong>Agent builder</strong> pane opens.</li>
</ol>
<h3 id="3-configure-agent-details">3. Configure Agent Details<a class="headerlink" href="#3-configure-agent-details" title="Permanent link">#</a></h3>
<ul>
<li>In the <strong>Agent details</strong> section:</li>
<li>For <strong>Agent resource role</strong>, select <strong>Create and use a new service role</strong>.</li>
<li>For <strong>Select model</strong>, choose a model (e.g., <code>Claude 3 Haiku</code>).</li>
<li>
<p>In <strong>Instructions for the Agent</strong>, paste the following:</p>
<p><code>You are a friendly chat bot. You have access to a function called that returns
information about the current date and time. When responding with date or time,
please make sure to add the timezone UTC.</code></p>
</li>
<li>
<p>Choose <strong>Save</strong>.</p>
</li>
</ul>
<hr />
<h2 id="step-3-add-action-group">Step 3: Add Action Group<a class="headerlink" href="#step-3-add-action-group" title="Permanent link">#</a></h2>
<h3 id="1-navigate-to-action-groups">1. Navigate to Action Groups<a class="headerlink" href="#1-navigate-to-action-groups" title="Permanent link">#</a></h3>
<ul>
<li>Choose the <strong>Action groups</strong> tab.</li>
<li>Choose <strong>Add</strong>.</li>
</ul>
<h3 id="2-configure-action-group">2. Configure Action Group<a class="headerlink" href="#2-configure-action-group" title="Permanent link">#</a></h3>
<ul>
<li><strong>Action group name</strong>: (e.g., <code>TimeActions</code>)</li>
<li><strong>Description</strong> (optional)</li>
<li><strong>Action group type</strong>: Select <strong>Define with API schemas</strong></li>
<li><strong>Action group invocation</strong>: Choose <strong>Select an existing Lambda function</strong></li>
<li><strong>Select Lambda function</strong>: Choose the Lambda function created in <a href="#step-1-create-a-lambda-function">Step 1</a></li>
<li><strong>Action group schema</strong>: Choose <strong>Define via in-line schema editor</strong></li>
</ul>
<h3 id="3-paste-openapi-schema">3. Paste OpenAPI Schema<a class="headerlink" href="#3-paste-openapi-schema" title="Permanent link">#</a></h3>
<p>Replace the existing schema with:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">openapi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0.0</span>
<span class="nt">info</span><span class="p">:</span>
<span class="w">  </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Time API</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API to get the current date and time.</span>
<span class="nt">paths</span><span class="p">:</span>
<span class="w">  </span><span class="nt">/get-current-date-and-time</span><span class="p">:</span>
<span class="w">    </span><span class="nt">get</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gets the current date and time.</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gets the current date and time.</span>
<span class="w">      </span><span class="nt">operationId</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">getDateAndTime</span>
<span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
<span class="w">        </span><span class="s">&#39;200&#39;</span><span class="p p-Indicator">:</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gets the current date and time.</span>
<span class="w">          </span><span class="nt">content</span><span class="p">:</span>
<span class="w">            </span><span class="s">&#39;application/json&#39;</span><span class="p p-Indicator">:</span>
<span class="w">              </span><span class="nt">schema</span><span class="p">:</span>
<span class="w">                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
<span class="w">                </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">date</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The current date</span>
<span class="w">                  </span><span class="nt">time</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The current time</span>
</code></pre></div>

<h3 id="4-finalize-agent-and-add-permissions">4. Finalize Agent and Add Permissions<a class="headerlink" href="#4-finalize-agent-and-add-permissions" title="Permanent link">#</a></h3>
<ol>
<li><strong>Review</strong> your action group configuration and choose <strong>Create</strong>.</li>
<li>Choose <strong>Save</strong> to save your changes.</li>
<li>Choose <strong>Prepare</strong> to prepare the agent.</li>
<li>Choose <strong>Save and exit</strong> to save your changes and exit the agent builder.</li>
</ol>
<hr />
<h2 id="step-6-grant-lambda-invoke-permissions-to-the-agent">Step 6: Grant Lambda Invoke Permissions to the Agent<a class="headerlink" href="#step-6-grant-lambda-invoke-permissions-to-the-agent" title="Permanent link">#</a></h2>
<ol>
<li>
<p>In the <strong>Agent overview</strong> section, under <strong>Permissions</strong>, click the <strong>IAM service role</strong>. This opens the role in the IAM console.</p>
</li>
<li>
<p>In the IAM console:</p>
</li>
<li>Choose the <strong>Permissions</strong> tab.</li>
<li>
<p>Choose <strong>Add permissions</strong> → <strong>Create inline policy</strong>.</p>
</li>
<li>
<p>Choose the <strong>JSON</strong> tab and paste the following policy:</p>
<p><code>json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "lambda:InvokeFunction"
            ],
            "Resource": "Function ARN"
        }
    ]
}</code></p>
<blockquote>
<p>🔄 <strong>Note</strong>: Replace <code>"Function ARN"</code> with the ARN of your Lambda function from Step 6 of <a href="#step-1-create-a-lambda-function">Step 1: Create a Lambda Function</a></p>
</blockquote>
</li>
<li>
<p>Choose <strong>Next</strong>.</p>
</li>
<li>
<p>Enter a name for the policy (e.g., <code>BedrockAgentLambdaInvoke</code>).</p>
</li>
<li>
<p>Choose <strong>Create policy</strong>.</p>
</li>
</ol>
<h1 id="agentic-ai-usecase-1-slow-response-times-on-network-causing-otp-relay-delays-for-banking-customers-how-does-agentic-ai-identify-and-apply-fixes">Agentic AI - Usecase 1: <code>Slow response times on network causing OTP relay delays for Banking customers. How does Agentic AI identify and apply fixes.</code><a class="headerlink" href="#agentic-ai-usecase-1-slow-response-times-on-network-causing-otp-relay-delays-for-banking-customers-how-does-agentic-ai-identify-and-apply-fixes" title="Permanent link">#</a></h1>
<h2 id="step-1-create-a-lambda-function_1">Step 1: Create a Lambda Function<a class="headerlink" href="#step-1-create-a-lambda-function_1" title="Permanent link">#</a></h2>
<p><strong>Function Name:</strong> <code>OtpMonitorLambdaFunction</code></p>
<p><strong>Code:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Version-1</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">logs_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">log_group_name</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log_group_name&quot;</span><span class="p">,</span> <span class="s2">&quot;/eks/otp-webapp&quot;</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">48</span><span class="p">))</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;&quot;Attempting to send OTP&quot;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;&quot;OTP email sent in&quot;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;&quot;Failed to send OTP&quot;&#39;</span>
    <span class="p">]</span>

    <span class="n">all_events</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">delivery_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">failed_otp_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">logs_client</span><span class="o">.</span><span class="n">filter_log_events</span><span class="p">(</span>
                <span class="n">logGroupName</span><span class="o">=</span><span class="n">log_group_name</span><span class="p">,</span>
                <span class="n">startTime</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
                <span class="n">endTime</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span>
                <span class="n">filterPattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="mi">500</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">event_item</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">event_item</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">event_item</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;OTP email sent in&quot;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;OTP email sent in ([\d.]+) seconds&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                        <span class="n">delivery_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

                <span class="k">if</span> <span class="s2">&quot;Failed to send OTP&quot;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                    <span class="n">failed_otp_count</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">all_events</span><span class="p">[</span><span class="n">event_item</span><span class="p">[</span><span class="s1">&#39;eventId&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span>
                <span class="p">}</span>

        <span class="n">logs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_events</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">max_delivery</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">delivery_times</span><span class="p">)</span> <span class="k">if</span> <span class="n">delivery_times</span> <span class="k">else</span> <span class="mf">0.0</span>

        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>
        <span class="k">if</span> <span class="n">failed_otp_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">max_delivery</span> <span class="o">&gt;</span> <span class="mf">2.5</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
        <span class="k">if</span> <span class="n">failed_otp_count</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">max_delivery</span> <span class="o">&gt;</span> <span class="mf">5.0</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;CRITICAL&quot;</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
            <span class="s2">&quot;affected_services&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Lambda&quot;</span><span class="p">],</span>
            <span class="s2">&quot;metric_alerts&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;Max OTP Delivery Time&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_delivery</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="s2">&quot;2.5s&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;Lambda&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed OTP Count&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">failed_otp_count</span><span class="p">,</span>
                    <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;Lambda&quot;</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span><span class="si">}</span><span class="s2"> OTP logs in the last 12 hours. Failures: </span><span class="si">{</span><span class="n">failed_otp_count</span><span class="si">}</span><span class="s2">, Max delivery time: </span><span class="si">{</span><span class="n">max_delivery</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span>
        <span class="p">}</span>

        <span class="n">response_body</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;application/json&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">summary</span><span class="p">)}}</span>

        <span class="n">action_response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;actionGroup&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;actionGroup&quot;</span><span class="p">],</span>
            <span class="s2">&quot;apiPath&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;apiPath&quot;</span><span class="p">],</span>
            <span class="s2">&quot;httpMethod&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;httpMethod&quot;</span><span class="p">],</span>
            <span class="s2">&quot;httpStatusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s2">&quot;responseBody&quot;</span><span class="p">:</span> <span class="n">response_body</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">session_attributes</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;sessionAttributes&quot;</span><span class="p">]</span>
        <span class="n">prompt_session_attributes</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;messageVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">action_response</span><span class="p">,</span>
            <span class="s2">&quot;sessionAttributes&quot;</span><span class="p">:</span> <span class="n">session_attributes</span><span class="p">,</span>
            <span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">:</span> <span class="n">prompt_session_attributes</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_response_body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;application/json&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Lambda Error&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">action_response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;actionGroup&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;actionGroup&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="s2">&quot;apiPath&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;apiPath&quot;</span><span class="p">,</span> <span class="s2">&quot;/unknown&quot;</span><span class="p">),</span>
            <span class="s2">&quot;httpMethod&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;httpMethod&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">),</span>
            <span class="s2">&quot;httpStatusCode&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s2">&quot;responseBody&quot;</span><span class="p">:</span> <span class="n">error_response_body</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;messageVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">action_response</span><span class="p">,</span>
            <span class="s2">&quot;sessionAttributes&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sessionAttributes&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># Version-2</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">logs_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">extract_email</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="c1"># Basic regex for email extraction; adjust based on your logs</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\w\.-]+@[\w\.-]+&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">log_group_name</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log_group_name&quot;</span><span class="p">,</span> <span class="s2">&quot;/eks/otp-webapp&quot;</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="n">search_keywords</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Attempting to send OTP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OTP email sent in&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Failed to send OTP&quot;</span>
    <span class="p">]</span>

    <span class="n">result_logs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">paginator</span> <span class="o">=</span> <span class="n">logs_client</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s1">&#39;filter_log_events&#39;</span><span class="p">)</span>
        <span class="n">page_iterator</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span>
            <span class="n">logGroupName</span><span class="o">=</span><span class="n">log_group_name</span><span class="p">,</span>
            <span class="n">startTime</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
            <span class="n">endTime</span><span class="o">=</span><span class="n">end_time</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">page_iterator</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event_item</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">event_item</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">keyword</span> <span class="ow">in</span> <span class="n">message</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">search_keywords</span><span class="p">):</span>
                    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">event_item</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                    <span class="n">email_id</span> <span class="o">=</span> <span class="n">extract_email</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

                    <span class="n">result_logs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                        <span class="s2">&quot;email_id&quot;</span><span class="p">:</span> <span class="n">email_id</span>
                    <span class="p">})</span>

        <span class="n">response_body</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;application/json&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_logs</span><span class="p">)}}</span>

        <span class="n">action_response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;actionGroup&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;actionGroup&quot;</span><span class="p">],</span>
            <span class="s2">&quot;apiPath&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;apiPath&quot;</span><span class="p">],</span>
            <span class="s2">&quot;httpMethod&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;httpMethod&quot;</span><span class="p">],</span>
            <span class="s2">&quot;httpStatusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s2">&quot;responseBody&quot;</span><span class="p">:</span> <span class="n">response_body</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;messageVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">action_response</span><span class="p">,</span>
            <span class="s2">&quot;sessionAttributes&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sessionAttributes&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_response_body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;application/json&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Lambda Error&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">action_response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;actionGroup&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;actionGroup&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="s2">&quot;apiPath&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;apiPath&quot;</span><span class="p">,</span> <span class="s2">&quot;/unknown&quot;</span><span class="p">),</span>
            <span class="s2">&quot;httpMethod&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;httpMethod&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">),</span>
            <span class="s2">&quot;httpStatusCode&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s2">&quot;responseBody&quot;</span><span class="p">:</span> <span class="n">error_response_body</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;messageVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">action_response</span><span class="p">,</span>
            <span class="s2">&quot;sessionAttributes&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sessionAttributes&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;promptSessionAttributes&quot;</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="p">}</span>
</code></pre></div>

<p><strong>Test:</strong>
Event JSON</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;log_group_name&quot;: &quot;/eks/otp-webapp&quot;,
  &quot;actionGroup&quot;: &quot;OtpMonitorActionGroup&quot;,
  &quot;apiPath&quot;: &quot;/get-otp-monitor&quot;,
  &quot;httpMethod&quot;: &quot;GET&quot;,
  &quot;sessionAttributes&quot;: {},
  &quot;promptSessionAttributes&quot;: {}
}
</code></pre></div>

<p><strong>Executing function: succeeded:</strong></p>
<div class="codehilite"><pre><span></span><code>{
  &quot;messageVersion&quot;: &quot;1.0&quot;,
  &quot;response&quot;: {
    &quot;actionGroup&quot;: &quot;OtpMonitorActionGroup&quot;,
    &quot;apiPath&quot;: &quot;/get-otp-monitor&quot;,
    &quot;httpMethod&quot;: &quot;GET&quot;,
    &quot;httpStatusCode&quot;: 200,
    &quot;responseBody&quot;: {
      &quot;application/json&quot;: {
        &quot;body&quot;: &quot;{\&quot;status\&quot;: \&quot;WARNING\&quot;, \&quot;affected_services\&quot;: [\&quot;Lambda\&quot;], \&quot;metric_alerts\&quot;: [{\&quot;metric\&quot;: \&quot;Max OTP Delivery Time\&quot;, \&quot;value\&quot;: \&quot;3.38s\&quot;, \&quot;threshold\&quot;: \&quot;2.5s\&quot;, \&quot;service\&quot;: \&quot;Lambda\&quot;}, {\&quot;metric\&quot;: \&quot;Failed OTP Count\&quot;, \&quot;value\&quot;: 0, \&quot;threshold\&quot;: \&quot;0\&quot;, \&quot;service\&quot;: \&quot;Lambda\&quot;}], \&quot;summary\&quot;: \&quot;Found 6 OTP logs in the last 12 hours. Failures: 0, Max delivery time: 3.38s\&quot;}&quot;
      }
    }
  },
  &quot;sessionAttributes&quot;: {},
  &quot;promptSessionAttributes&quot;: {}
}
</code></pre></div>

<p><strong>Configuration:</strong>
<strong>Permissions:</strong>
<strong>Role name:</strong>
OtpMonitorLambdaFunction-role-ntyfvqf0
IAM -&gt; Roles -&gt; OtpMonitorLambdaFunction-role-ntyfvqf0</p>
<p>Policy name:
AWSLambdaBasicExecutionRole-9a1d489a-eda2-4c6e-bced-f99a004d9617
IAM -&gt; Policies -&gt; AWSLambdaBasicExecutionRole-9a1d489a-eda2-4c6e-bced-f99a004d9617</p>
<p>Service:
CloudWatch Logs</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: &quot;logs:CreateLogGroup&quot;,
            &quot;Resource&quot;: &quot;arn:aws:logs:us-east-1:777203855866:*&quot;
        },
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;logs:CreateLogStream&quot;,
                &quot;logs:PutLogEvents&quot;
            ],
            &quot;Resource&quot;: [
                &quot;arn:aws:logs:us-east-1:777203855866:log-group:/aws/lambda/OtpMonitorLambdaFunction:*&quot;
            ]
        },
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;logs:FilterLogEvents&quot;,
                &quot;logs:GetLogEvents&quot;,
                &quot;logs:DescribeLogStreams&quot;
            ],
            &quot;Resource&quot;: [
                &quot;arn:aws:logs:us-east-1:777203855866:log-group:/eks/otp-webapp:*&quot;,
                &quot;arn:aws:logs:us-east-1:777203855866:log-group:sns/us-east-1/777203855866/otp_delay_poc:*&quot;
            ]
        }
    ]
}
</code></pre></div>

<p><strong>Resource-based policy statements</strong>
Resource-based policies grant other AWS accounts and services permissions to access your Lambda resources.</p>
<p>Statement ID:
AllowBedrockInvocation</p>
<p>Resource-based policy document</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Id&quot;: &quot;default&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Sid&quot;: &quot;AllowBedrockInvocation&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Principal&quot;: {
        &quot;Service&quot;: &quot;bedrock.amazonaws.com&quot;
      },
      &quot;Action&quot;: &quot;lambda:InvokeFunction&quot;,
      &quot;Resource&quot;: &quot;arn:aws:lambda:us-east-1:777203855866:function:OtpMonitorLambdaFunction&quot;,
      &quot;Condition&quot;: {
        &quot;ArnLike&quot;: {
          &quot;AWS:SourceArn&quot;: &quot;arn:aws:bedrock:us-east-1:777203855866:agent/*&quot;
        }
      }
    }
  ]
}
</code></pre></div>

<p><img alt="Lambda Function" src="image/LF1.png" /></p>
<p><img alt="Lambda Function" src="image/LF2.png" /></p>
<p><img alt="Lambda Function" src="image/LF3.png" /></p>
<p><img alt="Lambda Function" src="image/LF4.png" /></p>
<p><img alt="Lambda Function" src="image/LF5.png" /></p>
<p><img alt="Lambda Function" src="image/LF6.png" /></p>
<p><img alt="Lambda Function" src="image/LF7.png" /></p>
<h2 id="step-2-create-a-amazon-bedrock-agent">Step 2: Create a Amazon Bedrock Agent<a class="headerlink" href="#step-2-create-a-amazon-bedrock-agent" title="Permanent link">#</a></h2>
<p><img alt="Agent" src="image/Agent1.png" /></p>
<p><strong>Agent details</strong>
<strong>Agent name:</strong> OtpMonitorAgent
<strong>Agent description - optional:</strong> OTP CloudWatch logs monitor Agent
<strong>Agent resource role:</strong> Create and use a new service role
<strong>Select model:</strong> select from Model providers list
<strong>Instructions for the Agent:</strong> Provide clear and specific instructions for the task the Agent will perform. You can also provide certain style and tone.</p>
<div class="codehilite"><pre><span></span><code>Your role is to analyze the output of a Lambda function that queries AWS CloudWatch logs from the log

  Focus on the following OTP flow log messages:
  <span class="k">-</span> &quot;Generated OTP&quot;
  <span class="k">-</span> &quot;Attempting to send OTP&quot;
  <span class="k">-</span> &quot;OTP email sent&quot;
  <span class="k">-</span> &quot;OTP stored&quot;
  <span class="k">-</span> &quot;OTP verified&quot;

Parse and track OTP-related events in **chronological order** per transaction.
Expected order:
<span class="k">-</span> Generated OTP → Attempting to send OTP → OTP email sent → OTP stored → OTP verified

 Detect and flag the following anomalies:
     <span class="k">-</span> Missing events in the expected sequence
     <span class="k">-</span> Time delays &gt; 10 seconds between any two consecutive steps
     <span class="k">-</span> Presence of known error patterns (e.g., &quot;SMTP error&quot;, &quot;send failure&quot;, &quot;OTP failed&quot;, &quot;storage error&quot;)
</code></pre></div>

<p><strong>Action groups:</strong>
<strong>Action group details</strong>
<strong>Enter Action group name:</strong> OtpMonitorActionGroup
<strong>Description - optional:</strong></p>
<p><strong>Action group type:</strong>
Select what type of action group to create: <code>Define with API schemas</code></p>
<p><strong>Action group invocation:</strong> 
Specify a Lambda function that will be invoked based on the action group identified by the Foundation model during orchestration.</p>
<p>Select an existing Lambda function: <code>OtpMonitorLambdaFunction</code></p>
<p><strong>Action group schema:</strong>
Select an existing schema or create a new one via the in-line editor to define the APIs that the agent can invoke to carry out its tasks.</p>
<ul>
<li><code>Define via in-line schema editor</code></li>
</ul>
<p><strong>In-line OpenAPI schema:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">openapi</span><span class="o">:</span><span class="w"> </span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span>
<span class="n">info</span><span class="o">:</span>
<span class="w">  </span><span class="n">title</span><span class="o">:</span><span class="w"> </span><span class="n">OTP</span><span class="w"> </span><span class="n">Monitoring</span><span class="w"> </span><span class="n">API</span>
<span class="w">  </span><span class="n">version</span><span class="o">:</span><span class="w"> </span><span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span>
<span class="w">  </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">monitor</span><span class="w"> </span><span class="n">OTP</span><span class="w"> </span><span class="n">delivery</span><span class="w"> </span><span class="n">delays</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">CloudWatch</span><span class="w"> </span><span class="n">logs</span><span class="o">.</span>
<span class="n">paths</span><span class="o">:</span>
<span class="w">  </span><span class="o">/</span><span class="kd">get</span><span class="o">-</span><span class="n">otp</span><span class="o">-</span><span class="n">monitor</span><span class="o">:</span>
<span class="w">    </span><span class="kd">get</span><span class="o">:</span>
<span class="w">      </span><span class="n">summary</span><span class="o">:</span><span class="w"> </span><span class="n">Gets</span><span class="w"> </span><span class="n">OTP</span><span class="w"> </span><span class="n">delivery</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="n">data</span><span class="o">.</span>
<span class="w">      </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">Retrieves</span><span class="w"> </span><span class="n">OTP</span><span class="w"> </span><span class="n">delivery</span><span class="w"> </span><span class="n">times</span><span class="o">,</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="n">counts</span><span class="o">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">CloudWatch</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">past</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">hours</span><span class="o">.</span>
<span class="w">      </span><span class="n">operationId</span><span class="o">:</span><span class="w"> </span><span class="n">getOtpMonitoringInfo</span>
<span class="w">      </span><span class="n">responses</span><span class="o">:</span>
<span class="w">        </span><span class="s1">&#39;200&#39;</span><span class="o">:</span>
<span class="w">          </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">OTP</span><span class="w"> </span><span class="n">delivery</span><span class="w"> </span><span class="n">metrics</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">summary</span><span class="o">.</span>
<span class="w">          </span><span class="n">content</span><span class="o">:</span>
<span class="w">            </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">:</span>
<span class="w">              </span><span class="n">schema</span><span class="o">:</span>
<span class="w">                </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">object</span>
<span class="w">                </span><span class="n">properties</span><span class="o">:</span>
<span class="w">                  </span><span class="n">status</span><span class="o">:</span>
<span class="w">                    </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">string</span>
<span class="w">                    </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">Overall</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">OTP</span><span class="w"> </span><span class="n">metrics</span><span class="w"> </span><span class="o">(</span><span class="n">INFO</span><span class="o">,</span><span class="w"> </span><span class="n">WARNING</span><span class="o">,</span><span class="w"> </span><span class="n">CRITICAL</span><span class="o">)</span>
<span class="w">                  </span><span class="n">affected_services</span><span class="o">:</span>
<span class="w">                    </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">array</span>
<span class="w">                    </span><span class="n">items</span><span class="o">:</span>
<span class="w">                      </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">string</span>
<span class="w">                    </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">Services</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">g</span><span class="o">.,</span><span class="w"> </span><span class="n">Lambda</span><span class="o">)</span>
<span class="w">                  </span><span class="n">metric_alerts</span><span class="o">:</span>
<span class="w">                    </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">array</span>
<span class="w">                    </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">metric</span><span class="w"> </span><span class="n">evaluations</span>
<span class="w">                    </span><span class="n">items</span><span class="o">:</span>
<span class="w">                      </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">object</span>
<span class="w">                      </span><span class="n">properties</span><span class="o">:</span>
<span class="w">                        </span><span class="n">metric</span><span class="o">:</span>
<span class="w">                          </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">string</span>
<span class="w">                          </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">Metric</span><span class="w"> </span><span class="n">name</span>
<span class="w">                        </span><span class="n">value</span><span class="o">:</span>
<span class="w">                          </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">string</span>
<span class="w">                          </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">Observed</span><span class="w"> </span><span class="n">value</span>
<span class="w">                        </span><span class="n">threshold</span><span class="o">:</span>
<span class="w">                          </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">string</span>
<span class="w">                          </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">Threshold</span><span class="w"> </span><span class="n">value</span>
<span class="w">                        </span><span class="n">service</span><span class="o">:</span>
<span class="w">                          </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">string</span>
<span class="w">                          </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">Related</span><span class="w"> </span><span class="n">service</span>
<span class="w">                  </span><span class="n">summary</span><span class="o">:</span>
<span class="w">                    </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">string</span>
<span class="w">                    </span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">Summary</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">findings</span>
</code></pre></div>

<p><strong>Permissions:</strong> <code>arn:aws:iam::777203855866:role/service-role/AmazonBedrockExecutionRoleForAgents_589IDLBHO1U</code></p>
<p><img alt="Agent" src="image/Agent8.png" /></p>
<p>IAM -&gt; Roles -&gt; AmazonBedrockExecutionRoleForAgents_589IDLBHO1U</p>
<p><img alt="Agent" src="image/Agent9.png" /></p>
<p>IAM -&gt; Policies -&gt; AmazonBedrockAgentBedrockFoundationModelPolicy_TU2VOQK6HG</p>
<p><img alt="Agent" src="image/Agent10.png" /></p>
<p><strong>Permissions defined in this policy</strong></p>
<div class="codehilite"><pre><span></span><code>{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Sid&quot;: &quot;AmazonBedrockAgentBedrockFoundationModelPolicyProd&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;bedrock:InvokeModel&quot;,
                &quot;bedrock:InvokeModelWithResponseStream&quot;
            ],
            &quot;Resource&quot;: [
                &quot;arn:aws:bedrock:us-east-1::foundation-model/amazon.titan-text-premier-v1:0&quot;
            ]
        }
    ]
}
</code></pre></div>

<p>IAM -&gt; Roles -&gt; AmazonBedrockExecutionRoleForAgents_589IDLBHO1U</p>
<p><strong>permissions in OtpMonitorPolicy</strong></p>
<div class="codehilite"><pre><span></span><code>{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;lambda:InvokeFunction&quot;
            ],
            &quot;Resource&quot;: &quot;arn:aws:lambda:us-east-1:777203855866:function:OtpMonitorLambdaFunction&quot;
        }
    ]
}
</code></pre></div>

<p><strong>Action status:</strong> Enable</p>
<p><img alt="Agent" src="image/Agent2.png" /></p>
<p><img alt="Agent" src="image/Agent3.png" /></p>
<p><img alt="Agent" src="image/Agent4.png" /></p>
<p><img alt="Agent" src="image/Agent5.png" /></p>
<p><img alt="Agent" src="image/Agent6.png" /></p>
<p><img alt="Agent" src="image/Agent7.png" /></p>
<h2 id="note">Note:<a class="headerlink" href="#note" title="Permanent link">#</a></h2>
<ul>
<li><strong>Save</strong> -&gt; <strong>Prepare</strong> -&gt; <strong>Test</strong> -&gt; <strong>Create alias</strong></li>
</ul>
<h2 id="test-the-otpmonitoragent">Test the <code>OtpMonitorAgent</code><a class="headerlink" href="#test-the-otpmonitoragent" title="Permanent link">#</a></h2>
<p>Here’s a test prompt you can use to trigger your AWS Bedrock Agent (which calls the Lambda OtpMonitorActionGroup.getOtpMonitoringInfoGET) correctly:</p>
<h2 id="test-prompt">✅ Test Prompt<a class="headerlink" href="#test-prompt" title="Permanent link">#</a></h2>
<div class="codehilite"><pre><span></span><code>Check the OTP delivery metrics.
</code></pre></div>

<p><img alt="Agent" src="image/Agent11.png" /></p>
<h2 id="trace-step-1">Trace step 1<a class="headerlink" href="#trace-step-1" title="Permanent link">#</a></h2>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;agentId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MZJDM5Z9N3&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;callerChain&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;agentAliasArn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arn:aws:bedrock:us-east-1:777203855866:agent-alias/MZJDM5Z9N3/TSTALIASID&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s">&quot;eventTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:31.591Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;modelInvocationInput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;foundationModel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;amazon.titan-text-premier-v1:0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;inferenceConfiguration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;maximumLength&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2048</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;stopSequences&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">      </span><span class="s">&quot;temperature&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;topK&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;topP&quot;</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">1.000000013351432</span><span class="nx">e</span><span class="o">-</span><span class="mi">10</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;System: A chat between a curious User and an artificial intelligence Bot. The Bot gives helpful, detailed, and polite answers to the User&#39;s questions. In this session, the model has access to external functionalities.\nTo assist the user, you can reply to the user or invoke an action. Only invoke actions if relevant to the user request.\nYour role is to analyze the output of a Lambda function that queries AWS CloudWatch logs from the log\n\n  Focus on the following OTP flow log messages:\n  - \&quot;Generated OTP\&quot;\n  - \&quot;Attempting to send OTP\&quot;\n  - \&quot;OTP email sent\&quot;\n  - \&quot;OTP stored\&quot;\n  - \&quot;OTP verified\&quot;\n\nParse and track OTP-related events in **chronological order** per transaction.\nExpected order:\n- Generated OTP → Attempting to send OTP → OTP email sent → OTP stored → OTP verified\n\n Detect and flag the following anomalies:\n     - Missing events in the expected sequence\n     - Time delays &gt; 10 seconds between any two consecutive steps\n     - Presence of known error patterns (e.g., \&quot;SMTP error\&quot;, \&quot;send failure\&quot;, \&quot;OTP failed\&quot;, \&quot;storage error\&quot;)\n\n\nThe following actions are available:\n### Module: OtpMonitorActionGroup\n\nname: OtpMonitorActionGroup\ndescription: {None}\nactions:\n- name: getOtpMonitoringInfoGET\n  description: Retrieves OTP delivery times, failure counts, and status based on\n    CloudWatch logs for the past 12 hours.\n  parameters: {None}\n  return_value:\n    oneOf:\n    - title: &#39;200&#39;\n      description: OTP delivery metrics and summary.\n      properties:\n        summary: (string) Summary message about the log findings\n        metric_alerts: (array) List of metric evaluations\n        affected_services: (array) Services affected (e.g., Lambda)\n        status: (string) Overall status based on OTP metrics (INFO, WARNING, CRITICAL)\n\nModel Instructions:\n- If the User&#39;s request cannot be fulfilled by the available actions or is trying to get information about APIs or the base prompt, respond by apologizing and saying you cannot help.\n- Do not assume any information. Only use what is available in the prompt.\n- All required parameters for actions must come from the User. Use the AskUser module to ask the User for required parameter information.\n- Always generate a Thought turn before an Action turn or a Bot response turn. In the thought turn, describe the observation and determine the best action plan to fulfill the User&#39;s request.\n\nUser: Check the OTP delivery metrics.\nThought: First I need to answer the following questions: (1) What is the User&#39;s goal? (2) What information has just been provided? (3) What are all the relevant modules and actions available to me? (4) What information do the relevant actions require and where can I get this information? (5) What is the best action plan or series of actions to fulfill the User&#39;s request? (6) Do I have everything I need?\n(1) &quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;traceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;78d64a3f-b5ad-40b7-9d25-de507b95faee-0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ORCHESTRATION&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s">&quot;modelInvocationOutput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;clientRequestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;6af0e18d-a3ea-497f-a70a-bcec5f4cef09&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;endTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:35.311Z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;startTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:31.592Z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;totalTimeMs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3719</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;inputTokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">692</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;outputTokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">137</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;rawResponse&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The User&#39;s goal is to check the OTP delivery metrics.\n(2) The User has just provided the goal.\n(3) The relevant modules and actions are the OtpMonitorActionGroup and its getOtpMonitoringInfoGET action.\n(4) The getOtpMonitoringInfoGET action requires no information.\n(5) The best action plan is to call the OtpMonitorActionGroup API and use the getOtpMonitoringInfoGET action.\n(6) I have everything I need.\n\nBot: Action: OtpMonitorActionGroup.getOtpMonitoringInfoGET()&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;traceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;78d64a3f-b5ad-40b7-9d25-de507b95faee-0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s">&quot;rationale&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The User&#39;s goal is to check the OTP delivery metrics.\n(2) The User has just provided the goal.\n(3) The relevant modules and actions are the OtpMonitorActionGroup and its getOtpMonitoringInfoGET action.\n(4) The getOtpMonitoringInfoGET action requires no information.\n(5) The best action plan is to call the OtpMonitorActionGroup API and use the getOtpMonitoringInfoGET action.\n(6) I have everything I need.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;traceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;78d64a3f-b5ad-40b7-9d25-de507b95faee-0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s">&quot;invocationInput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;actionGroupInvocationInput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;actionGroupName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OtpMonitorActionGroup&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;apiPath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/get-otp-monitor&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;executionType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;LAMBDA&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;verb&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;get&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="s">&quot;invocationType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ACTION_GROUP&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;traceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;78d64a3f-b5ad-40b7-9d25-de507b95faee-0&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s">&quot;observation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;actionGroupInvocationOutput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;clientRequestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;675775c3-6562-4182-a7af-9db3e79f01f8&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;endTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:43.272Z&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;startTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:35.313Z&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;totalTimeMs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7959</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{\&quot;status\&quot;: \&quot;WARNING\&quot;, \&quot;affected_services\&quot;: [\&quot;Lambda\&quot;], \&quot;metric_alerts\&quot;: [{\&quot;metric\&quot;: \&quot;Max OTP Delivery Time\&quot;, \&quot;value\&quot;: \&quot;3.38s\&quot;, \&quot;threshold\&quot;: \&quot;2.5s\&quot;, \&quot;service\&quot;: \&quot;Lambda\&quot;}, {\&quot;metric\&quot;: \&quot;Failed OTP Count\&quot;, \&quot;value\&quot;: 0, \&quot;threshold\&quot;: \&quot;0\&quot;, \&quot;service\&quot;: \&quot;Lambda\&quot;}], \&quot;summary\&quot;: \&quot;Found 6 OTP logs in the last 12 hours. Failures: 0, Max delivery time: 3.38s\&quot;}&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="s">&quot;traceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;78d64a3f-b5ad-40b7-9d25-de507b95faee-0&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ACTION_GROUP&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="trace-step-2">Trace step 2<a class="headerlink" href="#trace-step-2" title="Permanent link">#</a></h2>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;agentId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MZJDM5Z9N3&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;callerChain&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;agentAliasArn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arn:aws:bedrock:us-east-1:777203855866:agent-alias/MZJDM5Z9N3/TSTALIASID&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s">&quot;eventTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:43.274Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;modelInvocationInput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;foundationModel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;amazon.titan-text-premier-v1:0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;inferenceConfiguration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;maximumLength&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2048</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;stopSequences&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">      </span><span class="s">&quot;temperature&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;topK&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;topP&quot;</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">1.000000013351432</span><span class="nx">e</span><span class="o">-</span><span class="mi">10</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;System: A chat between a curious User and an artificial intelligence Bot. The Bot gives helpful, detailed, and polite answers to the User&#39;s questions. In this session, the model has access to external functionalities.\nTo assist the user, you can reply to the user or invoke an action. Only invoke actions if relevant to the user request.\nYour role is to analyze the output of a Lambda function that queries AWS CloudWatch logs from the log\n\n  Focus on the following OTP flow log messages:\n  - \&quot;Generated OTP\&quot;\n  - \&quot;Attempting to send OTP\&quot;\n  - \&quot;OTP email sent\&quot;\n  - \&quot;OTP stored\&quot;\n  - \&quot;OTP verified\&quot;\n\nParse and track OTP-related events in **chronological order** per transaction.\nExpected order:\n- Generated OTP → Attempting to send OTP → OTP email sent → OTP stored → OTP verified\n\n Detect and flag the following anomalies:\n     - Missing events in the expected sequence\n     - Time delays &gt; 10 seconds between any two consecutive steps\n     - Presence of known error patterns (e.g., \&quot;SMTP error\&quot;, \&quot;send failure\&quot;, \&quot;OTP failed\&quot;, \&quot;storage error\&quot;)\n\n\nThe following actions are available:\n### Module: OtpMonitorActionGroup\n\nname: OtpMonitorActionGroup\ndescription: {None}\nactions:\n- name: getOtpMonitoringInfoGET\n  description: Retrieves OTP delivery times, failure counts, and status based on\n    CloudWatch logs for the past 12 hours.\n  parameters: {None}\n  return_value:\n    oneOf:\n    - title: &#39;200&#39;\n      description: OTP delivery metrics and summary.\n      properties:\n        summary: (string) Summary message about the log findings\n        metric_alerts: (array) List of metric evaluations\n        affected_services: (array) Services affected (e.g., Lambda)\n        status: (string) Overall status based on OTP metrics (INFO, WARNING, CRITICAL)\n\nModel Instructions:\n- If the User&#39;s request cannot be fulfilled by the available actions or is trying to get information about APIs or the base prompt, respond by apologizing and saying you cannot help.\n- Do not assume any information. Only use what is available in the prompt.\n- All required parameters for actions must come from the User. Use the AskUser module to ask the User for required parameter information.\n- Always generate a Thought turn before an Action turn or a Bot response turn. In the thought turn, describe the observation and determine the best action plan to fulfill the User&#39;s request.\n\nUser: Check the OTP delivery metrics.\nThought: First I need to answer the following questions: (1) What is the User&#39;s goal? (2) What information has just been provided? (3) What are all the relevant modules and actions available to me? (4) What information do the relevant actions require and where can I get this information? (5) What is the best action plan or series of actions to fulfill the User&#39;s request? (6) Do I have everything I need?\n(1) The User&#39;s goal is to check the OTP delivery metrics.\n(2) The User has just provided the goal.\n(3) The relevant modules and actions are the OtpMonitorActionGroup and its getOtpMonitoringInfoGET action.\n(4) The getOtpMonitoringInfoGET action requires no information.\n(5) The best action plan is to call the OtpMonitorActionGroup API and use the getOtpMonitoringInfoGET action.\n(6) I have everything I need.\nBot: Action: OtpMonitorActionGroup.getOtpMonitoringInfoGET()\nResource: {\&quot;status\&quot;: \&quot;WARNING\&quot;, \&quot;affected_services\&quot;: [\&quot;Lambda\&quot;], \&quot;metric_alerts\&quot;: [{\&quot;metric\&quot;: \&quot;Max OTP Delivery Time\&quot;, \&quot;value\&quot;: \&quot;3.38s\&quot;, \&quot;threshold\&quot;: \&quot;2.5s\&quot;, \&quot;service\&quot;: \&quot;Lambda\&quot;}, {\&quot;metric\&quot;: \&quot;Failed OTP Count\&quot;, \&quot;value\&quot;: 0, \&quot;threshold\&quot;: \&quot;0\&quot;, \&quot;service\&quot;: \&quot;Lambda\&quot;}], \&quot;summary\&quot;: \&quot;Found 6 OTP logs in the last 12 hours. Failures: 0, Max delivery time: 3.38s\&quot;}\nThought: First I need to answer the following questions: (1) What is the User&#39;s goal? (2) What information has just been provided? (3) What are all the relevant modules and actions available to me? (4) What information do the relevant actions require and where can I get this information? (5) What is the best action plan or series of actions to fulfill the User&#39;s request? (6) Do I have everything I need?\n(1) &quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;traceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;78d64a3f-b5ad-40b7-9d25-de507b95faee-1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ORCHESTRATION&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s">&quot;modelInvocationOutput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;clientRequestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0c71fbb9-1d4b-4c23-82ea-b78afeea92f2&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;endTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:46.960Z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;startTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:43.274Z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;totalTimeMs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3686</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;inputTokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1057</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;outputTokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">173</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;rawResponse&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The User&#39;s goal is to check the OTP delivery metrics.\n(2) The User has just provided the goal.\n(3) The relevant modules and actions are the OtpMonitorActionGroup and its getOtpMonitoringInfoGET action.\n(4) The getOtpMonitoringInfoGET action requires no information.\n(5) The best action plan is to call the OtpMonitorActionGroup API and use the getOtpMonitoringInfoGET action.\n(6) I have everything I need.\nBot: The OTP delivery metrics show a WARNING status with a maximum delivery time of 3.38 seconds, which is above the threshold of 2.5 seconds. There have been no failures in the last 12 hours. Would you like to investigate further?&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;traceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;78d64a3f-b5ad-40b7-9d25-de507b95faee-1&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s">&quot;rationale&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The User&#39;s goal is to check the OTP delivery metrics.\n(2) The User has just provided the goal.\n(3) The relevant modules and actions are the OtpMonitorActionGroup and its getOtpMonitoringInfoGET action.\n(4) The getOtpMonitoringInfoGET action requires no information.\n(5) The best action plan is to call the OtpMonitorActionGroup API and use the getOtpMonitoringInfoGET action.\n(6) I have everything I need.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;traceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;78d64a3f-b5ad-40b7-9d25-de507b95faee-1&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s">&quot;observation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;finalResponse&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;endTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:47.017Z&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;operationTotalTimeMs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15817</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;startTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-06-05T12:10:31.200Z&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The OTP delivery metrics show a WARNING status with a maximum delivery time of 3.38 seconds, which is above the threshold of 2.5 seconds. There have been no failures in the last 12 hours. Would you like to investigate further?&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="s">&quot;traceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;78d64a3f-b5ad-40b7-9d25-de507b95faee-1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;FINISH&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="create-alias-create-a-versions">Create Alias (Create a Versions)<a class="headerlink" href="#create-alias-create-a-versions" title="Permanent link">#</a></h2>
<p><img alt="Agent" src="image/Agent12.png" /></p>
<p><strong>Alias name:</strong> OtpMonitorWorkingDraftv1</p>
<h2 id="invoke-bedrock-agent-using-python">Invoke Bedrock Agent using python<a class="headerlink" href="#invoke-bedrock-agent-using-python" title="Permanent link">#</a></h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">agent_id</span> <span class="o">=</span> <span class="s2">&quot;MZJDM5Z9N3&quot;</span>
<span class="n">agent_alias_id</span> <span class="o">=</span> <span class="s2">&quot;U0SJVOESII&quot;</span>
<span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;us-east-1&quot;</span>
<span class="n">session_id</span> <span class="o">=</span> <span class="s2">&quot;local-test-session-001&quot;</span>
<span class="n">user_input</span> <span class="o">=</span> <span class="s2">&quot;Check the OTP delivery metrics.&quot;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;bedrock-agent-runtime&quot;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">invoke_agent</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response_stream</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">invoke_agent</span><span class="p">(</span>
            <span class="n">agentId</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span>
            <span class="n">agentAliasId</span><span class="o">=</span><span class="n">agent_alias_id</span><span class="p">,</span>
            <span class="n">sessionId</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span>
            <span class="n">inputText</span><span class="o">=</span><span class="n">user_input</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Agent Response:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">response_stream</span><span class="p">[</span><span class="s1">&#39;completion&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s2">&quot;chunk&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;chunk&quot;</span><span class="p">][</span><span class="s2">&quot;bytes&quot;</span><span class="p">]</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- End of Agent Response ---&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error invoking agent:&quot;</span><span class="p">)</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">invoke_agent</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>python bedrock_invoke.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="nv">Agent</span><span class="w"> </span><span class="nv">Response</span>:
<span class="nv">The</span><span class="w"> </span><span class="nv">OTP</span><span class="w"> </span><span class="nv">delivery</span><span class="w"> </span><span class="nv">metrics</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">WARNING</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">maximum</span><span class="w"> </span><span class="nv">delivery</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">3</span>.<span class="mi">38</span><span class="w"> </span><span class="nv">seconds</span>,<span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">above</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">threshold</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">2</span>.<span class="mi">5</span><span class="w"> </span><span class="nv">seconds</span>.<span class="w"> </span><span class="nv">There</span><span class="w"> </span><span class="nv">have</span><span class="w"> </span><span class="nv">been</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">failures</span><span class="w"> </span><span class="nv">reported</span>.<span class="w"> </span><span class="nv">Would</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">like</span><span class="w"> </span><span class="nv">more</span><span class="w"> </span><span class="nv">details</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">these</span><span class="w"> </span><span class="nv">metrics</span>?
<span class="o">---</span><span class="w"> </span><span class="k">End</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">Agent</span><span class="w"> </span><span class="nv">Response</span><span class="w"> </span><span class="o">---</span>
</code></pre></div>

<h2 id="how-to-setup-aws-sns-to-send-sms-to-mobile">How to setup AWS SNS to send SMS to Mobile<a class="headerlink" href="#how-to-setup-aws-sns-to-send-sms-to-mobile" title="Permanent link">#</a></h2>
<ul>
<li>Amazon SNS - Topics - Create topic</li>
</ul>
<p><img alt="SNS" src="image/sns1.png" /></p>
<p><img alt="SNS" src="image/sns2.png" /></p>
<ul>
<li>Amazon SNS - Topics - otp_delay_poc - Create subscription</li>
</ul>
<p><img alt="SNS" src="image/sns3.png" /></p>
<ul>
<li>Delivery status logging - AWS Lambda</li>
<li>IAM roles - Create new service role (IAM role for successful deliveries &amp; IAM role for failed deliveries)</li>
</ul>
<p><img alt="SNS" src="image/sns4.png" /></p>
<p><img alt="SNS" src="image/sns5.png" /></p>
<ul>
<li>Amazon SNS - Subscriptions - Create subscription</li>
</ul>
<p><img alt="SNS" src="image/sns6.png" /></p>
<ul>
<li><strong>Protocol</strong> : AWS Lambda</li>
<li>
<p><strong>Endpoint</strong>: Lambda function created ex:(sns-logger-function)
                arn:aws:lambda:us-east-1:777203855866:function:sns-logger-function</p>
</li>
<li>
<p>Lambda - Functions - sns-logger-function</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;📩 SNS Message Received&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;✅ Event Details:&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>

        <span class="c1"># You can further parse the message if needed:</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Records&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">sns</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Sns&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">message_id</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MessageId&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span> <span class="s1">&#39;No Subject&#39;</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Message&#39;</span><span class="p">,</span> <span class="s1">&#39;No Message&#39;</span><span class="p">)</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;No Timestamp&#39;</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🟢 MessageId: </span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📌 Subject: </span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📝 Message: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱ Timestamp: </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s2">&quot;SNS message processed successfully.&quot;</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;❌ Error processing SNS message&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s2">&quot;Error processing SNS message.&quot;</span><span class="p">)</span>
        <span class="p">}</span>
</code></pre></div>

<h2 id="otp-service-app">OTP Service APP<a class="headerlink" href="#otp-service-app" title="Permanent link">#</a></h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">streamlit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">st</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">smtplib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">email.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmailMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="c1"># Load environment variables</span>
<span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">EMAIL_ADDRESS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;EMAIL_ADDRESS&quot;</span><span class="p">)</span>
<span class="n">EMAIL_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;EMAIL_PASSWORD&quot;</span><span class="p">)</span>
<span class="n">AWS_REGION</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AWS_REGION&quot;</span><span class="p">,</span> <span class="s2">&quot;us-east-1&quot;</span><span class="p">)</span>
<span class="n">SNS_TOPIC_ARN</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SNS_TOPIC_ARN&quot;</span><span class="p">)</span>

<span class="c1"># Configure logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(levelname)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Streamlit session state for OTPs</span>
<span class="k">if</span> <span class="s2">&quot;otp_store&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">otp_store</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Generate a 6-digit OTP</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_otp</span><span class="p">():</span>
    <span class="n">otp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">999999</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated OTP: </span><span class="si">{</span><span class="n">otp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">otp</span>

<span class="c1"># Send OTP via Email</span>
<span class="k">def</span><span class="w"> </span><span class="nf">send_otp_email</span><span class="p">(</span><span class="n">receiver_email</span><span class="p">,</span> <span class="n">otp</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">EmailMessage</span><span class="p">()</span>
    <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Your OTP Code&quot;</span>
    <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;From&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EMAIL_ADDRESS</span>
    <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;To&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">receiver_email</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">set_content</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your OTP is: </span><span class="si">{</span><span class="n">otp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP_SSL</span><span class="p">(</span><span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="mi">465</span><span class="p">)</span> <span class="k">as</span> <span class="n">smtp</span><span class="p">:</span>
            <span class="n">smtp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">EMAIL_ADDRESS</span><span class="p">,</span> <span class="n">EMAIL_PASSWORD</span><span class="p">)</span>
            <span class="n">smtp</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OTP sent to email: </span><span class="si">{</span><span class="n">receiver_email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;✅ OTP sent to email&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Email Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;❌ Email Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Send OTP via SNS Topic (Transactional SMS)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">send_otp_sms</span><span class="p">(</span><span class="n">phone_number</span><span class="p">,</span> <span class="n">otp</span><span class="p">):</span>
    <span class="n">sns</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;sns&quot;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">AWS_REGION</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Your OTP is: </span><span class="si">{</span><span class="n">otp</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
            <span class="n">TopicArn</span><span class="o">=</span><span class="n">SNS_TOPIC_ARN</span><span class="p">,</span>
            <span class="n">Message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
            <span class="n">MessageAttributes</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;AWS.SNS.SMS.SMSType&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;DataType&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;StringValue&quot;</span><span class="p">:</span> <span class="s2">&quot;Transactional&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;AWS.SNS.SMS.SenderID&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;DataType&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;StringValue&quot;</span><span class="p">:</span> <span class="s2">&quot;OTPSystem&quot;</span>  <span class="c1"># Optional custom sender ID</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OTP sent via SNS topic to: </span><span class="si">{</span><span class="n">phone_number</span><span class="si">}</span><span class="s2"> | MessageId: </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;MessageId&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;✅ OTP sent via SNS topic&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SMS Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;❌ SMS Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># UI</span>
<span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;🔐 OTP Verification System&quot;</span><span class="p">)</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">radio</span><span class="p">(</span><span class="s2">&quot;Select Action&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Request OTP&quot;</span><span class="p">,</span> <span class="s2">&quot;Verify OTP&quot;</span><span class="p">])</span>

<span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;Request OTP&quot;</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Send OTP&quot;</span><span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">radio</span><span class="p">(</span><span class="s2">&quot;Send via:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Email&quot;</span><span class="p">,</span> <span class="s2">&quot;Mobile (SMS)&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;Email&quot;</span><span class="p">:</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s2">&quot;Enter your email&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Send OTP&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Please enter your email.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">otp</span> <span class="o">=</span> <span class="n">generate_otp</span><span class="p">()</span>
                <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">send_otp_email</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">otp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">otp_store</span><span class="p">[</span><span class="n">email</span><span class="p">]</span> <span class="o">=</span> <span class="n">otp</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;Mobile (SMS)&quot;</span><span class="p">:</span>
        <span class="n">phone</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s2">&quot;Enter your phone number (e.g., +91xxxxxxxxxx)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Send OTP&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">phone</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">):</span>
                <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Phone number must be in E.164 format (e.g., +91xxxxxxxxxx)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">otp</span> <span class="o">=</span> <span class="n">generate_otp</span><span class="p">()</span>
                <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">send_otp_sms</span><span class="p">(</span><span class="n">phone</span><span class="p">,</span> <span class="n">otp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">otp_store</span><span class="p">[</span><span class="n">phone</span><span class="p">]</span> <span class="o">=</span> <span class="n">otp</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;Verify OTP&quot;</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Verify OTP&quot;</span><span class="p">)</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s2">&quot;Enter your email or phone number&quot;</span><span class="p">)</span>
    <span class="n">user_otp</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s2">&quot;Enter the OTP you received&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Verify&quot;</span><span class="p">):</span>
        <span class="n">actual_otp</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">otp_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">actual_otp</span> <span class="ow">and</span> <span class="n">user_otp</span> <span class="o">==</span> <span class="n">actual_otp</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OTP verified successfully for </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&quot;✅ OTP verified successfully!&quot;</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">otp_store</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OTP verification failed for </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;❌ Incorrect or expired OTP.&quot;</span><span class="p">)</span>
</code></pre></div>

<p><code>`.env</code></p>
<div class="codehilite"><pre><span></span><code><span class="n">EMAIL_ADDRESS</span><span class="o">=</span><span class="n">k</span><span class="p">.</span><span class="n">xxxxx</span><span class="nv">@gmail</span><span class="p">.</span><span class="n">com</span>
<span class="n">EMAIL_PASSWORD</span><span class="o">=</span><span class="ss">&quot;xxxx xxxx fxaq sndv&quot;</span>
<span class="n">SNS_TOPIC_ARN</span><span class="o">=</span><span class="nl">arn</span><span class="p">:</span><span class="nl">aws</span><span class="p">:</span><span class="nl">sns</span><span class="p">:</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="err">:</span><span class="nl">xxxxxxxx</span><span class="p">:</span><span class="n">otp_delay</span>
<span class="n">AWS_REGION</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span>
</code></pre></div>

<p><img alt="OTPAPP" src="image/otpapp1.png" /></p>
<h2 id="sns-logs-into-cloudwatch">SNS Logs into CloudWatch<a class="headerlink" href="#sns-logs-into-cloudwatch" title="Permanent link">#</a></h2>
<ul>
<li>CloudWatch - Log groups - sns/us-east-1/777203855866/otp_delay_poc - All events</li>
</ul>
<p><img alt="CloudWatch" src="image/SNS-CloudWatch1.png" /></p>
<h2 id="integrate-agent-response-to-ms-team-channels">Integrate Agent response  to MS Team Channels<a class="headerlink" href="#integrate-agent-response-to-ms-team-channels" title="Permanent link">#</a></h2>
<h2 id="step-by-step-integration">✅ Step-by-step Integration:<a class="headerlink" href="#step-by-step-integration" title="Permanent link">#</a></h2>
<h2 id="1-create-an-incoming-webhook-in-microsoft-teams">✅ 1. Create an Incoming Webhook in Microsoft Teams<a class="headerlink" href="#1-create-an-incoming-webhook-in-microsoft-teams" title="Permanent link">#</a></h2>
<ol>
<li>Open Microsoft Teams.</li>
</ol>
<p><img alt="msteams" src="image/msteams1.png" /></p>
<ol>
<li>Navigate to the channel you want to send the message to.</li>
</ol>
<p><img alt="msteams" src="image/msteams2.png" /></p>
<p><strong>Note:</strong> While create the channel chose the team(ex: Project C...)</p>
<p><img alt="msteams" src="image/msteams3.png" /></p>
<p><strong>Manage channel</strong>
<img alt="msteams" src="image/msteams4.png" /></p>
<ol>
<li>Click the the channel name → Connectors.</li>
</ol>
<p><img alt="msteams" src="image/msteams5.png" /></p>
<ol>
<li>Find Incoming Webhook → Add.</li>
</ol>
<p><img alt="msteams" src="image/msteams6.png" /></p>
<ol>
<li>Give it a name (e.g., OTP Agent Notifier) and optionally upload an image.</li>
</ol>
<p><img alt="msteams" src="image/msteams7.png" /></p>
<ol>
<li>
<p>Click Create.</p>
</li>
<li>
<p>Copy the URL below to save it to the clipboard, then select Save. You'll need this URL when you go to the service that you want to send data to your group.</p>
</li>
</ol>
<p><img alt="msteams" src="image/msteams8.png" /></p>
<p><img alt="msteams" src="image/msteams9.png" /></p>
<p><strong>Code</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># AWS Bedrock Agent configuration</span>
<span class="n">agent_id</span> <span class="o">=</span> <span class="s2">&quot;MZJDM5Z9N3&quot;</span>
<span class="n">agent_alias_id</span> <span class="o">=</span> <span class="s2">&quot;Z0H27XOOEZ&quot;</span>
<span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;us-east-1&quot;</span>
<span class="n">session_id</span> <span class="o">=</span> <span class="s2">&quot;local-test-session-001&quot;</span>
<span class="n">user_input</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Get all email IDs with OTP seconds in descending order, and show step-by-step time gaps &quot;</span>
    <span class="s2">&quot;between OTP events seconds in descending order. Provide the detailed report for OTP delay. &quot;</span>
    <span class="s2">&quot;Based on the output decide which route should the application use to send OTP: email or sms.&quot;</span>
<span class="p">)</span>

<span class="c1"># Microsoft Teams Webhook URL (replace with your actual one)</span>
<span class="n">teams_webhook_url</span> <span class="o">=</span> <span class="s2">&quot;https://xxxx.webhook.office.com/webhookb2/76d009fb-a13f-428e-ae1a-50bd4c94a9e5@f260df36-bc43-424c-8f44-c85226657b01/IncomingWebhook/fd682ceb41c543fe87a7a39f992b5bd6/d97cf923-2ac2-4ce1-9a30-6ec18d4c219f/V29nMFKXKJJYWEp0OyAOvep1Bbh8cPqup2oF87OUGZHjE1&quot;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;bedrock-agent-runtime&quot;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">send_to_teams</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;📩 *Bedrock OTP Delay Report:*</span><span class="se">\n\n</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">teams_webhook_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Message sent to Microsoft Teams successfully.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Failed to send message to Teams: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Exception while sending to Teams:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">invoke_agent</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response_stream</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">invoke_agent</span><span class="p">(</span>
            <span class="n">agentId</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span>
            <span class="n">agentAliasId</span><span class="o">=</span><span class="n">agent_alias_id</span><span class="p">,</span>
            <span class="n">sessionId</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span>
            <span class="n">inputText</span><span class="o">=</span><span class="n">user_input</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Agent Response:&quot;</span><span class="p">)</span>
        <span class="n">full_response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">response_stream</span><span class="p">[</span><span class="s1">&#39;completion&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s2">&quot;chunk&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;chunk&quot;</span><span class="p">][</span><span class="s2">&quot;bytes&quot;</span><span class="p">]</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">full_response</span> <span class="o">+=</span> <span class="n">content</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- End of Agent Response ---&quot;</span><span class="p">)</span>

        <span class="c1"># Send the complete response to Microsoft Teams</span>
        <span class="n">send_to_teams</span><span class="p">(</span><span class="n">full_response</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Error invoking agent:&quot;</span><span class="p">)</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">invoke_agent</span><span class="p">()</span>
</code></pre></div>

<h2 id="how-to-execute-the-bedrock-agent-using-lambda-function">How to Execute the Bedrock Agent using Lambda function.<a class="headerlink" href="#how-to-execute-the-bedrock-agent-using-lambda-function" title="Permanent link">#</a></h2>
<p><strong>1. Create a clean directory</strong></p>
<div class="codehilite"><pre><span></span><code>mkdir lambda_function
cd lambda_function
</code></pre></div>

<p><strong>2. Add your code</strong></p>
<p>Save your Python script as <code>lambda_function.py</code></p>
<p><code>lambda_function.py</code>
<code>requirements.txt</code></p>
<p><strong>3. Install <code>requirements.txt</code> locally into the same directory</strong></p>
<p><code>pip install requests -t .</code></p>
<p>This installs <code>requests/</code>, <code>urllib3/</code>, etc., in the current directory — same place as <code>lambda_function.py</code>.</p>
<p><strong>4. Zip it correctly</strong></p>
<p>You must zip the contents from inside the folder — <code>not the folder itself</code>.</p>
<p><code>zip -r lambda_function.zip .</code></p>
<h2 id="final-zip-should-look-like">📦 Final ZIP should look like:<a class="headerlink" href="#final-zip-should-look-like" title="Permanent link">#</a></h2>
<div class="codehilite"><pre><span></span><code>lambda_function.zip
├── lambda_function.py
├── requests/
├── urllib3/
└── ... (dependencies)
</code></pre></div>

<p><code>lambda_function.py</code></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># AWS Bedrock Agent configuration</span>
<span class="n">agent_id</span> <span class="o">=</span> <span class="s2">&quot;MZJDM5Z9N3&quot;</span>
<span class="n">agent_alias_id</span> <span class="o">=</span> <span class="s2">&quot;Z0H27XOOEZ&quot;</span>
<span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;us-east-1&quot;</span>
<span class="n">session_id</span> <span class="o">=</span> <span class="s2">&quot;local-test-session-001&quot;</span>

<span class="c1"># Microsoft Teams Webhook URL (replace with your actual one)</span>
<span class="n">teams_webhook_url</span> <span class="o">=</span> <span class="s2">&quot;https://xxxxxx.webhook.office.com/webhookb2/76d009fb-a13f-428e-ae1a-50bd4c94a9e5@f260df36-bc43-424c-8f44-c85226657b01/IncomingWebhook/fd682ceb41c543fe87a7a39f992b5bd6/d97cf923-2ac2-4ce1-9a30-6ec18d4c219f/V29nMFKXKJJYWEp0OyAOvep1Bbh8cPqup2oF87OUGZHjE1&quot;</span>  <span class="c1"># ← redacted for security</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;bedrock-agent-runtime&quot;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">send_to_teams</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;📩 *Bedrock OTP Delay Report:*</span><span class="se">\n\n</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">teams_webhook_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Message sent to Microsoft Teams successfully.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Failed to send message to Teams: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Exception while sending to Teams:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">invoke_agent</span><span class="p">(</span><span class="n">user_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response_stream</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">invoke_agent</span><span class="p">(</span>
            <span class="n">agentId</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span>
            <span class="n">agentAliasId</span><span class="o">=</span><span class="n">agent_alias_id</span><span class="p">,</span>
            <span class="n">sessionId</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span>
            <span class="n">inputText</span><span class="o">=</span><span class="n">user_input</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Agent Response:&quot;</span><span class="p">)</span>
        <span class="n">full_response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">response_stream</span><span class="p">[</span><span class="s1">&#39;completion&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s2">&quot;chunk&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;chunk&quot;</span><span class="p">][</span><span class="s2">&quot;bytes&quot;</span><span class="p">]</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">full_response</span> <span class="o">+=</span> <span class="n">content</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- End of Agent Response ---&quot;</span><span class="p">)</span>

        <span class="c1"># Send the complete response to Microsoft Teams</span>
        <span class="n">send_to_teams</span><span class="p">(</span><span class="n">full_response</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">full_response</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Error invoking agent:&quot;</span><span class="p">)</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="c1"># Get the user_input from the event (or fallback to default)</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputText&quot;</span><span class="p">,</span> <span class="s2">&quot;Default user input to Bedrock agent&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">invoke_agent</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>
</code></pre></div>

<p><strong>5. Create a Lambda function</strong></p>
<p><code>Lambda -&gt; Functions -&gt; communication_otp_details_fun</code></p>
<p><img alt="lambdafun" src="image/lambdafun1.png" /></p>
<p><strong>6. Upload the <code>lambda_function.zip</code></strong></p>
<p><img alt="lambdafun" src="image/lambdafun2.png" /></p>
<p><strong>7. Add trigger with <code>EventBridge (CloudWatch Events)</code></strong></p>
<p><img alt="EventBridge" src="image/EventBridge1.png" /></p>
<ul>
<li>Lambda -&gt; Add triggers -&gt; Trigger configuration</li>
</ul>
<p><img alt="EventBridge" src="image/EventBridge2.png" /></p>
<p><img alt="EventBridge" src="image/EventBridge3.png" /></p>
<ul>
<li>Amazon EventBridge -&gt; Rules -&gt; schedule-bedrock-otp-job</li>
</ul>
<p><img alt="EventBridge" src="image/EventBridge4.png" /></p>
<p><img alt="EventBridge" src="image/EventBridge5.png" /></p>
<p><img alt="EventBridge" src="image/EventBridge6.png" /></p>
<h2 id="amazon-bedrock">Amazon Bedrock<a class="headerlink" href="#amazon-bedrock" title="Permanent link">#</a></h2>
<p>We use <a href="https://docs.aws.amazon.com/bedrock/latest/userguide/what-is-bedrock.html">Amazon Bedrock</a> to orchestrate Agentic AI with foundation model support from providers like Anthropic, Amazon, Meta, and others.</p>
<h2 id="aws-documentation">AWS Documentation<a class="headerlink" href="#aws-documentation" title="Permanent link">#</a></h2>
<p>We use AWS Documentation <a href="https://docs.aws.amazon.com/">AWS Documentation</a></p>
<h2 id="amazon-sagemaker-documentation">Amazon SageMaker Documentation<a class="headerlink" href="#amazon-sagemaker-documentation" title="Permanent link">#</a></h2>
<p>We use AWS ageMaker Documentation <a href="https://docs.aws.amazon.com/sagemaker/">sagemaker</a></p>
<h2 id="amazon-sagemaker-api-reference">Amazon SageMaker API Reference<a class="headerlink" href="#amazon-sagemaker-api-reference" title="Permanent link">#</a></h2>
<p>We use AWS ageMaker API Documentation <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/Welcome.html">SageMaker API Reference</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="AutoGen.html" class="btn btn-neutral float-left" title="AutoGen"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="azure.html" class="btn btn-neutral float-right" title="AZURE">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="AutoGen.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="azure.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
