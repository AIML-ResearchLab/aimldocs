<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Ganesh kinkar Giri" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>LangGraph - AIML documents</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "LangGraph";
        var mkdocs_page_input_path = "AgenticAI/LangGraph.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> AIML documents
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">AIML</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >Programing</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Programing/python.html">PYTHON</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Statistic</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >Descriptive Statistics</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Measures of Central Tendency</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Central-Tendency/Mean.html">Mean</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Central-Tendency/Median.html">Median</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Central-Tendency/Mode.html">Mode</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Measures of Position (Relative Standing)</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Position-Relative-Standing/Percentiles.html">Percentiles</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Position-Relative-Standing/Quartiles.html">Quartiles</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Position-Relative-Standing/Deciles.html">Deciles</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Position-Relative-Standing/Z-Score.html">Z-Score</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Shape of the Distribution</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Shape-of-the-Distribution/Skewness.html">Skewness</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Shape-of-the-Distribution/Kurtosis.html">Kurtosis</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Visualization Tools</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/Histogram.html">Histogram</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/BarChart.html">Bar Chart</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/PieChart.html">Pie Chart</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/BoxPlot.html">Box Plot</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/LinePlot.html">Line Plot</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Visualization-Tools/DotPlot.html">Dot Plot</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Measures of Dispersion (Variability)</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/Range.html">Range</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/Variance.html">Variance</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/StandardDeviation.html">Standard Deviation</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/InterquartileRange.html">Interquartile Range(IQR)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/DescriptiveStatistics/Measures-of-Dispersion/CofficientVariation.html">Cofficient of Variation</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Inferential Statistics</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Population and Sample</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Population-and-Sample/Population.html">Population</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Population-and-Sample/Sample.html">Sample</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Population-and-Sample/SamplingMethods.html">Sampling Methods</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Estimation</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Estimation/PointEstimation.html">Point Estimation</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Estimation/IntervalEstimation.html">Interval Estimation</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Estimation/MarginError.html">Margin of Error</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Regression and Correlation Analysis</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Regression-and-Correlation-Analysis/LinearRegression.html">Linear Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Regression-and-Correlation-Analysis/LogisticRegression.html">Logistic Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Regression-and-Correlation-Analysis/MultipleRegression.html">Multiple Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Regression-and-Correlation-Analysis/CorrelationCoefficients.html">Correlation Coefficients</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Hypothesis Testing</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/NullHypothesis.html">Null Hypothesis (H₀)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/AlternativeHypothesis.html">Alternative Hypothesis (H₁)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/TestStatistic.html">Test Statistic</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/pvalue.html">p-value</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/SignificanceLevel.html">Significance Level (α)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/TypeIError.html">Type I Error (α)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/TypeIIError.html">Type II Error (β)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Hypothesis-Testing/PoweroftheTest.html">Power of the Test</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Parametric Tests</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Parametric-Tests/t-test.html">t-test</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Parametric-Tests/z-test.html">z-test</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Parametric-Tests/ANOVA.html">ANOVA</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Parametric-Tests/F-test.html">F-test</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Non-Parametric Tests</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Non-Parametric-Tests/Mann-WhitneyU.html">Mann-Whitney U</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Non-Parametric-Tests/Kruskal-Wallis.html">Kruskal-Wallis</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Non-Parametric-Tests/Wilcoxon.html">Wilcoxon</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Non-Parametric-Tests/Chi-square.html">Chi-square</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Resampling Methods</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Resampling-Methods/Bootstrapping.html">Bootstrapping</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Resampling-Methods/Jackknife.html">Jackknife</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Analysis of Variance (ANOVA)</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/ANOVA/One-way-ANOVA.html">One-way ANOVA</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/ANOVA/Two-way-ANOVA.html">Two-way ANOVA</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/ANOVA/Post-hoc-Tests.html">Post-hoc Tests</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Probability Theory</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Probability-Theory/ProbabilityDistributions.html">Probability Distributions</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Probability-Theory/CentralLimitTheorem.html">Central Limit Theorem</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../Statistic/InferentialStatistics/Probability-Theory/BayesianInference.html">Bayesian Inference</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Time Series</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Trend.html">Trend</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Seasonality.html">Seasonality</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Cyclic.html">Cyclic</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Noise.html">Irregular/Noise</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Stationarity.html">Stationarity</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Non-stationary.html">Non-stationary</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Autocorrelation.html">Autocorrelation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Lag.html">Lag</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/MovingAverages.html">Moving Averages</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Holt-Winters.html">Holt-Winters Method</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Additive.html">Additive</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Multiplicative.html">Multiplicative</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/AR.html">AR (Auto Regression)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/ARIMA.html">ARIMA</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Arimax.html">Arimax</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Sarimax.html">Sarimax</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Smoothing.html">Smoothing</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/AutomatedForecasting.html">Automated Forecasting</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/AutomatedTimeSeries.html">Automated Time Series</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../Statistic/TimeSeries/Multivariate.html">Uni, Bi and Multivariate</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Statistic/metrics.html">Metrics Evaluation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Statistic/timeseries.html">Time Series Old</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Statistic/statistic-details.html">Statistic Details</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Data manipulation and analysis</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Data-manipulation-and-analysis/data-manipulation-analysis.html">PANDAS</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Data Processing</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Data-processing/sql.html">Basic SQL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Data-processing/sql-datascience.html">Using SQL for Data Science</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Data-processing/unstructured-data.html">Unstructured Data</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Data-processing/exploratory-data-analysis.html">Exploratory Data Analysis(EDA)</a>
                </li>
                <li class="toctree-l2"><a class="" href="../Data-processing/building-ml-models-on-text-data.md">Building ML Models on Text Data</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Databases</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Databases/PostgreSQL.html">PostgreSQL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Databases/MySQL.html">MySQL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Databases/MongoDB.html">MongoDB</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Machine Learning</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../MachineLearning/Overview.html">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Supervised Learning</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/Overview.html">Overview</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/Regression.html">Regression</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/Classification.html">Classification</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/CrossValidation.html">Cross Validation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/HyperparameterTuning.html">Hyperparameter Tuning</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/SupervisedLearning/TuningDecisionThreshold.html">Tuning decision threshold</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Regression Models</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/SimpleLinearRegression.html">Simple Linear Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/MultipleLinearRegression.html">Multiple Linear Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/PolynomialRegression.html">Polynomial Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/RidgeLassoRegression.html">Ridge & Lasso Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/SupportVectorRegression.html">Support Vector Regression (SVR)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/DecisionTreeRegression.html">Decision Tree Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/RegressionModels/RandomForestRegression.html">Random Forest Regression</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Linear Classification Models</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/LinearClassificationModels/LogisticRegression.html">Logistic Regression</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/LinearClassificationModels/SupportVectorMachines.html">Support Vector Machines</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/LinearClassificationModels/SinglelayerPerceptron.html">Single-layer Perceptron</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/LinearClassificationModels/StochasticGradientDescent.html">Stochastic Gradient Descent (SGD)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Non-linear Classification Models</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/DecisionTreeClassification.html">Decision Tree Classification</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/KNearestNeighbours.html">K-Nearest Neighbours</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/NaiveBayes.html">Naive Bayes</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/RandomForests.html">Random Forests</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/AdaBoost.html">AdaBoost</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/BaggingClassifier.html">Bagging Classifier</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/Ensemblelearningclassifiers.html">Ensemble learning classifiers</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../MachineLearning/SupervisedLearning/NonlinearClassificationModels/KernelSVM.html">Kernel SVM</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Unsupervised Learning</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/UnsupervisedLearning/overview.html">Overview</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/UnsupervisedLearning/Clustering.html">Clustering</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/UnsupervisedLearning/Pca.html">Principal Component Analysis(PCA)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Reinforcement Learning</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../MachineLearning/ReinforcementLearning/ReinforcementLearning.html">Overview</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Linear Algebra</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../LinearAlgebra/Overview.html">Overview</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Deep Learning</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../DeepLearning/Overview.html">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../DeepLearning/Vanishing.html">Vanishing and Exploding Gradients Problems</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Components of Neural Networks</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/LayersNeuralNetworks.html">Layers in Neural Networks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/WeightsBiases.html">Weights and Biases</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/ForwardPropagation.html">Forward Propagation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/ActivationFunctions.html">Activation Functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/LossFunctions.html">Loss Functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/Backpropagation.html">Backpropagation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Components/LearningRate.html">Learning Rate</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Optimization Algorithm</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/GradientDescent.html">Gradient Descent</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/SGD.html">Stochastic Gradient Descent (SGD)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/Adam.html">Adam (Adaptive Moment Estimation)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/BatchNormalization.html">Batch Normalization</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/Mini-batch-GD.html">Mini-batch Gradient Descent</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/Momentum-based-GO.html">Momentum-based Gradient Optimizer</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/AdagradOptimizer.html">Adagrad Optimizer</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/OptimizationAlgorithm/RMSPropOptimizer.html">RMSProp Optimizer</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Models</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/FNN.html">Feedforward Neural Network (FNN)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Recurrent Neural Network (RNN)</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../DeepLearning/Models/RNN.html">Recurrent Neural Network (RNN)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../DeepLearning/Models/LSTM.html">LSTM (Long Short-Term Memory)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../DeepLearning/Models/GRU.html">GRU (Gated Recurrent Unit)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/CNN.html">Convolutional Neural Network (CNN)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/RBFN.html">Radial Basis Function Network (RBFN)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/ComputerVision.html">Computer Vision</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/GANs.html">Generative Adversarial Networks (GANs)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/Transformer.html">Transformer Networks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/Autoencoders.html">Autoencoders</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../DeepLearning/Models/SOM.html">Self-Organizing Maps (SOM)</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Natural Language Processing(NLP)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../NLP/overview.html">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../NLP/nlpdetails.html">NLP Details</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Retrieval-Augmented Generation(RAG)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../RAG/rag.html">RAG</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >AI agents</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../AIagents/aiagents.html">AI agents</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Agentic AI</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="general.html">general</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="crewai.html">crewai</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">LangGraph</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="AutoGen.html">AutoGen</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="aws.html">AWS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="azure.html">AZURE</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Agent Development Kit</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="GCP/adk.html">ADK</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="GCP/Agents.html">Agents</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="GCP/Tools.html">Tools</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="GCP/a2a.html">Tools</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >MCPModel Context Protocol (MCP)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../MCP/mcp.html">MCP</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Models Details information</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Models/Ollama.html">Ollama</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Note Book</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../Notebook/allnotebook.html">All Notebook</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AIML documents</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">AIML</li>
          <li class="breadcrumb-item">Agentic AI</li>
      <li class="breadcrumb-item active">LangGraph</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h3 style="color:red;">✅ LangGraph</h3>

<h3 style="color:blue;">📌 What is LangGraph?</h3>
<p>LangGraph is built for developers who want to build powerful, adaptable AI agents.Developers choose LangGraph for:</p>
<ul>
<li>
<p><strong>Reliability and controllability.</strong> Steer agent actions with moderation checks and human-in-the-loop approvals. LangGraph persists context for long-running workflows, keeping your agents on course.</p>
</li>
<li>
<p><strong>Low-level and extensible.</strong> Build custom agents with fully descriptive, low-level primitives free from rigid abstractions that limit customization. Design scalable multi-agent systems, with each agent serving a specific role tailored to your use case.</p>
</li>
<li>
<p><strong>First-class streaming support.</strong> With token-by-token streaming and streaming of intermediate steps, LangGraph gives users clear visibility into agent reasoning and actions as they unfold in real time.</p>
</li>
</ul>
<h3 style="color:blue;">📌 Learn LangGraph basics</h3>

<ol>
<li><strong>Build a basic chatbot</strong></li>
<li><strong>Add tools</strong></li>
<li><strong>Add memory</strong></li>
<li><strong>Add human-in-the-loop controls</strong></li>
<li><strong>Customize state</strong></li>
<li><strong>Time travel</strong></li>
</ol>
<h2 id="agent-architectures">Agent architectures<a class="headerlink" href="#agent-architectures" title="Permanent link">#</a></h2>
<p>Many LLM applications implement a particular control flow of steps before and / or after LLM calls. As an example, RAG performs retrieval of documents relevant to a user question, and passes those documents to an LLM in order to ground the model's response in the provided document context.</p>
<p>Instead of hard-coding a fixed control flow, we sometimes want LLM systems that can pick their own control flow to solve more complex problems! This is one definition of an agent: an agent is a system that uses an LLM to decide the control flow of an application. There are many ways that an LLM can control application:</p>
<ul>
<li>
<p>An LLM can route between two potential paths</p>
</li>
<li>
<p>An LLM can decide which of many tools to call</p>
</li>
<li>
<p>An LLM can decide whether the generated answer is sufficient or more work is needed</p>
</li>
</ul>
<p><strong>Router</strong></p>
<p>A router allows an LLM to select a single step from a specified set of options. This is an agent architecture that exhibits a relatively limited level of control because the LLM usually focuses on making a single decision and produces a specific output from a limited set of pre-defined options. Routers typically employ a few different concepts to achieve this.</p>
<p><strong>Structured Output</strong></p>
<p>Structured outputs with LLMs work by providing a specific format or schema that the LLM should follow in its response. This is similar to tool calling, but more general. While tool calling typically involves selecting and using predefined functions, structured outputs can be used for any type of formatted response. Common methods to achieve structured outputs include:</p>
<ol>
<li>
<p><strong>Prompt engineering:</strong> Instructing the LLM to respond in a specific format via the system prompt.</p>
</li>
<li>
<p><strong>Output parsers:</strong> Using post-processing to extract structured data from LLM responses.</p>
</li>
<li>
<p><strong>Tool calling:</strong> Leveraging built-in tool calling capabilities of some LLMs to generate structured outputs.</p>
</li>
</ol>
<p><strong>Tool-calling agent</strong></p>
<p>cWhile a router allows an LLM to make a single decision, more complex agent architectures expand the LLM's control in two key ways:</p>
<ol>
<li>
<p>Multi-step decision making: The LLM can make a series of decisions, one after another, instead of just one.</p>
</li>
<li>
<p>Tool access:The LLM can choose from and use a variety of tools to accomplish tasks.</p>
</li>
</ol>
<h3 style="color:blue;">📌 Install LangGraph:</h3>

<div class="codehilite"><pre><span></span><code>pip install -U langgraph
</code></pre></div>

<h3 style="color:blue;">📌 create an agent using prebuilt components:</h3>

<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>


<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sk-proj-*****&quot;</span>
<span class="n">llm</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;openai:gpt-4.1&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_weather</span><span class="p">(</span><span class="n">city</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get weather for a given city.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;It&#39;s always sunny in </span><span class="si">{</span><span class="n">city</span><span class="si">}</span><span class="s2">!&quot;</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_weather</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant&quot;</span>
<span class="p">)</span>

<span class="c1"># Run the agent</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what is the weather in sf&quot;</span><span class="p">}]}</span>
<span class="p">)</span>

<span class="c1"># Print the output</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>python langgraph_test.py
The weather in San Francisco is reported to be always sunny! If you need a more detailed or up-to-date weather report, please let me know.
</code></pre></div>

<h3 style="color:blue;">📌 Core benefits</h3>

<p>LangGraph provides low-level supporting infrastructure for any long-running, stateful workflow or agent. LangGraph does not abstract prompts or architecture, and provides the following central benefits:</p>
<ul>
<li>
<p><strong>Durable execution:</strong> Build agents that persist through failures and can run for extended periods, automatically resuming from exactly where they left off.</p>
</li>
<li>
<p><strong>Human-in-the-loop:</strong> Seamlessly incorporate human oversight by inspecting and modifying agent state at any point during execution.</p>
</li>
<li>
<p><strong>Comprehensive memory:</strong> Create truly stateful agents with both short-term working memory for ongoing reasoning and long-term persistent memory across sessions.</p>
</li>
<li>
<p><strong>Debugging with LangSmith:</strong> Gain deep visibility into complex agent behavior with visualization tools that trace execution paths, capture state transitions, and provide detailed runtime metrics.</p>
</li>
<li>
<p><strong>Production-ready deployment:</strong> Deploy sophisticated agent systems confidently with scalable infrastructure designed to handle the unique challenges of stateful, long-running workflows.</p>
</li>
</ul>
<h3 style="color:blue;">📌 LangGraph’s ecosystem</h3>

<p>While LangGraph can be used standalone, it also integrates seamlessly with any LangChain product, giving developers a full suite of tools for building agents. To improve your LLM application development, pair LangGraph with:</p>
<ul>
<li>
<p><strong>LangSmith</strong> — Helpful for agent evals and observability. Debug poor-performing LLM app runs, evaluate agent trajectories, gain visibility in production, and improve performance over time.</p>
</li>
<li>
<p><strong>LangGraph Platform</strong> — Deploy and scale agents effortlessly with a purpose-built deployment platform for long running, stateful workflows. Discover, reuse, configure, and share agents across teams — and iterate quickly with visual prototyping in LangGraph Studio.</p>
</li>
<li>
<p><strong>LangChain</strong> – Provides integrations and composable components to streamline LLM application development.</p>
</li>
</ul>
<h3 style="color:blue;">📌 Models</h3>

<p>LangGraph provides built-in support for LLMs (language models) via the LangChain library. This makes it easy to integrate various LLMs into your agents and workflows.</p>
<p><strong>Initialize a model</strong></p>
<p>Use <code>init_chat_model</code> to initialize models:</p>
<h3 style="color:blue;">📌 OpenAI:</h3>

<div class="codehilite"><pre><span></span><code><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="ss">&quot;langchain[openai]&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sk-...&quot;</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;openai:gpt-4.1&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 style="color:blue;">📌 Anthropic:</h3>

<div class="codehilite"><pre><span></span><code><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="ss">&quot;langchain[anthropic]&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;ANTHROPIC_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sk-...&quot;</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 style="color:blue;">📌 Azure:</h3>

<div class="codehilite"><pre><span></span><code><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="ss">&quot;langchain[openai]&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_OPENAI_ENDPOINT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_VERSION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2025-03-01-preview&quot;</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span>
    <span class="s2">&quot;azure_openai:gpt-4.1&quot;</span><span class="p">,</span>
    <span class="n">azure_deployment</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_OPENAI_DEPLOYMENT_NAME&quot;</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

<h3 style="color:blue;">📌 Google Gemini:</h3>

<div class="codehilite"><pre><span></span><code>pip install -U &quot;langchain[google-genai]&quot;
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GOOGLE_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;google_genai:gemini-2.0-flash&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 style="color:blue;">📌 AWS Bedrock:</h3>

<div class="codehilite"><pre><span></span><code><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="ss">&quot;langchain[aws]&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="c1"># Follow the steps here to configure your credentials:</span>
<span class="c1"># https://docs.aws.amazon.com/bedrock/latest/userguide/getting-started.html</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span>
    <span class="s2">&quot;anthropic.claude-3-5-sonnet-20240620-v1:0&quot;</span><span class="p">,</span>
    <span class="n">model_provider</span><span class="o">=</span><span class="s2">&quot;bedrock_converse&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<h3 style="color:blue;">📌 Instantiate a model directly</h3>

<p>If a model provider is not available via init_chat_model, you can instantiate the provider's model class directly. The model must implement the BaseChatModel interface and support tool calling:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Anthropic is already supported by `init_chat_model`,</span>
<span class="c1"># but you can also instantiate it directly.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_anthropic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatAnthropic</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ChatAnthropic</span><span class="p">(</span>
  <span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
  <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
  <span class="n">max_tokens</span><span class="o">=</span><span class="mi">2048</span>
<span class="p">)</span>
</code></pre></div>

<h3 style="color:blue;">📌 Dynamic model selection</h3>

<p>Pass a callable function to create_react_agent to dynamically select the model at runtime. This is useful for scenarios where you want to choose a model based on user input, configuration settings, or other runtime conditions.</p>
<p>The selector function must return a chat model. If you're using tools, you must bind the tools to the model within the selector function.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.language_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseChatModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt.chat_agent_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.runtime</span><span class="w"> </span><span class="kn">import</span> <span class="n">Runtime</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">weather</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the current weather conditions.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;It&#39;s nice and sunny.&quot;</span>


<span class="c1"># Define the runtime context</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomContext</span><span class="p">:</span>
    <span class="n">provider</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;anthropic&quot;</span><span class="p">,</span> <span class="s2">&quot;openai&quot;</span><span class="p">]</span>

<span class="c1"># Initialize models</span>
<span class="n">openai_model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;openai:gpt-4o&quot;</span><span class="p">)</span>
<span class="n">anthropic_model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;anthropic:claude-sonnet-4-20250514&quot;</span><span class="p">)</span>


<span class="c1"># Selector function for model choice</span>
<span class="k">def</span><span class="w"> </span><span class="nf">select_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">,</span> <span class="n">runtime</span><span class="p">:</span> <span class="n">Runtime</span><span class="p">[</span><span class="n">CustomContext</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">BaseChatModel</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">runtime</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;anthropic&quot;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">anthropic_model</span>
    <span class="k">elif</span> <span class="n">runtime</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;openai&quot;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">openai_model</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported provider: </span><span class="si">{</span><span class="n">runtime</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">provider</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># With dynamic model selection, you must bind tools explicitly</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">([</span><span class="n">weather</span><span class="p">])</span>


<span class="c1"># Create agent with dynamic model selection</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span><span class="n">select_model</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">weather</span><span class="p">])</span>

<span class="c1"># Invoke with context to select model</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Which model is handling this?&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">context</span><span class="o">=</span><span class="n">CustomContext</span><span class="p">(</span><span class="n">provider</span><span class="o">=</span><span class="s2">&quot;openai&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</code></pre></div>

<h3 style="color:blue;">📌 Advanced model configuration</h3>

<p><strong>Disable streaming</strong></p>
<p>To disable streaming of the individual LLM tokens, set disable_streaming=True when initializing the model:</p>
<p><strong>init_chat_model</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span>
    <span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">disable_streaming</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>ChatModel</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_anthropic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatAnthropic</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ChatAnthropic</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">disable_streaming</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<h3 style="color:blue;">📌 Add model fallbacks</h3>

<p>You can add a fallback to a different model or a different LLM provider using <code>model.with_fallbacks([...])</code>:</p>
<p><strong>init_chat_model</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="n">model_with_fallbacks</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;anthropic:claude-3-5-haiku-latest&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_fallbacks</span><span class="p">([</span>
        <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;openai:gpt-4.1-mini&quot;</span><span class="p">),</span>
    <span class="p">])</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>ChatModel</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="n">model_with_fallbacks</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;anthropic:claude-3-5-haiku-latest&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_fallbacks</span><span class="p">([</span>
        <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;openai:gpt-4.1-mini&quot;</span><span class="p">),</span>
    <span class="p">])</span>
<span class="p">)</span>
</code></pre></div>

<h3 style="color:blue;">📌 Use the built-in rate limiter</h3>

<p>Langchain includes a built-in in-memory rate limiter. This rate limiter is thread safe and can be shared by multiple threads in the same process.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.rate_limiters</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryRateLimiter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_anthropic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatAnthropic</span>

<span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">InMemoryRateLimiter</span><span class="p">(</span>
    <span class="n">requests_per_second</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># &lt;-- Super slow! We can only make a request once every 10 seconds!!</span>
    <span class="n">check_every_n_seconds</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># Wake up every 100 ms to check whether allowed to make a request,</span>
    <span class="n">max_bucket_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># Controls the maximum burst size.</span>
<span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ChatAnthropic</span><span class="p">(</span>
   <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;claude-3-opus-20240229&quot;</span><span class="p">,</span>
   <span class="n">rate_limiter</span><span class="o">=</span><span class="n">rate_limiter</span>
<span class="p">)</span>
</code></pre></div>

<h3 style="color:blue;">📌 Bring your own model</h3>

<p>If your desired LLM isn't officially supported by LangChain, consider these options:</p>
<ol>
<li>
<p><strong>Implement a custom LangChain chat model:</strong> Create a model conforming to the LangChain chat model interface. This enables full compatibility with LangGraph's agents and workflows but requires understanding of the LangChain framework.</p>
</li>
<li>
<p><strong>Direct invocation with custom streaming:</strong> Use your model directly by adding custom streaming logic with StreamWriter.</p>
</li>
</ol>
<h2 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">#</a></h2>
<p>Many AI applications interact with users via natural language. However, some use cases require models to interface directly with external systems—such as APIs, databases, or file systems—using structured input. In these scenarios, <strong>tool calling</strong> enables models to generate requests that conform to a specified input schema.</p>
<p><strong>Tools</strong> encapsulate a callable function and its input schema. These can be passed to compatible chat models, allowing the model to decide whether to invoke a tool and with what arguments.</p>
<p><img alt="alt text" src="image/langgraph1.png" /></p>
<p>Tool calling is typically <strong>conditional</strong>. Based on the user input and available tools, the model may choose to issue a tool call request. This request is returned in an AIMessage object, which includes a tool_calls field that specifies the tool name and input arguments:</p>
<div class="codehilite"><pre><span></span><code><span class="n">llm_with_tools</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s2">&quot;What is 2 multiplied by 3?&quot;</span><span class="p">)</span>
<span class="c1"># -&gt; AIMessage(tool_calls=[{&#39;name&#39;: &#39;multiply&#39;, &#39;args&#39;: {&#39;a&#39;: 2, &#39;b&#39;: 3}, ...}])</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">AIMessage</span><span class="p">(</span>
<span class="w">  </span><span class="n">tool_calls</span><span class="o">=</span><span class="p">[</span>
<span class="w">    </span><span class="n">ToolCall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;multiply&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">}),</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<p>If the input is unrelated to any tool, the model returns only a natural language message:</p>
<div class="codehilite"><pre><span></span><code><span class="n">llm_with_tools</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># -&gt; AIMessage(content=&quot;Hello!&quot;)</span>
</code></pre></div>

<p>Importantly, the model does not execute the tool—it only generates a request. A separate executor (such as a runtime or agent) is responsible for handling the tool call and returning the result.</p>
<h2 id="custom-tools">Custom tools<a class="headerlink" href="#custom-tools" title="Permanent link">#</a></h2>
<p>You can define custom tools using the @tool decorator or plain Python functions. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
</code></pre></div>

<h2 id="call-tools">Call tools<a class="headerlink" href="#call-tools" title="Permanent link">#</a></h2>
<p><strong>Tools</strong> encapsulate a callable function and its input schema. These can be passed to compatible chat models, allowing the model to decide whether to invoke a tool and determine the appropriate arguments.</p>
<p>You can <strong>define your own tools</strong> or use <strong>prebuilt tools</strong></p>
<p><strong>Define a tool</strong></p>
<p>Define a basic tool with the <strong>@tool</strong> decorator:</p>
<p><strong>Run a tool</strong></p>
<p>Tools conform to the <strong>Runnable interface</strong>, which means you can run a tool using the invoke method:</p>
<div class="codehilite"><pre><span></span><code>multiply.invoke({&quot;a&quot;: 6, &quot;b&quot;: 7})  # returns 42
</code></pre></div>

<p>If the tool is invoked with <code>type="tool_call"</code>, it will return a ToolMessage:</p>
<div class="codehilite"><pre><span></span><code><span class="n">tool_call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tool_call&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">multiply</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span><span class="w"> </span><span class="c1"># returns a ToolMessage object</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">ToolMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s1">&#39;294&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">tool_call_id</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</code></pre></div>

<h2 id="use-in-an-agent">Use in an agent<a class="headerlink" href="#use-in-an-agent" title="Permanent link">#</a></h2>
<p>To create a tool-calling agent, you can use the prebuilt <code>create_react_agent</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-7-sonnet&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">multiply</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what&#39;s 42 x 7?&quot;</span><span class="p">}]})</span>
</code></pre></div>

<h2 id="dynamically-select-tools">Dynamically select tools<a class="headerlink" href="#dynamically-select-tools" title="Permanent link">#</a></h2>
<p>Configure tool availability at runtime based on context:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt.chat_agent_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.runtime</span><span class="w"> </span><span class="kn">import</span> <span class="n">Runtime</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomContext</span><span class="p">:</span>
    <span class="n">tools</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="s2">&quot;compass&quot;</span><span class="p">]]</span>


<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">weather</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the current weather conditions.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;It&#39;s nice and sunny.&quot;</span>


<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compass</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the direction the user is facing.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;North&quot;</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;anthropic:claude-sonnet-4-20250514&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">configure_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">,</span> <span class="n">runtime</span><span class="p">:</span> <span class="n">Runtime</span><span class="p">[</span><span class="n">CustomContext</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure the model with tools based on runtime context.&quot;&quot;&quot;</span>
    <span class="n">selected_tools</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">tool</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="p">[</span><span class="n">weather</span><span class="p">,</span> <span class="n">compass</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tool</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">runtime</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">tools</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">(</span><span class="n">selected_tools</span><span class="p">)</span>


<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="c1"># Dynamically configure the model with tools based on runtime context</span>
    <span class="n">configure_model</span><span class="p">,</span>
    <span class="c1"># Initialize with all tools available</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">weather</span><span class="p">,</span> <span class="n">compass</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Who are you and what tools do you have access to?&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">context</span><span class="o">=</span><span class="n">CustomContext</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">]),</span>  <span class="c1"># Only enable the weather tool</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</code></pre></div>

<h2 id="use-in-a-workflow">Use in a workflow<a class="headerlink" href="#use-in-a-workflow" title="Permanent link">#</a></h2>
<p>If you are writing a custom workflow, you will need to:</p>
<ol>
<li>
<p>register the tools with the chat model</p>
</li>
<li>
<p>call the tool if the model decides to use it</p>
</li>
</ol>
<p>Use <code>model.bind_tools()</code> to register the tools with the model.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-3-5-haiku-latest&quot;</span><span class="p">)</span>

<span class="n">model_with_tools</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">([</span><span class="n">multiply</span><span class="p">])</span>
</code></pre></div>

<p><strong>ToolNode</strong></p>
<p>To execute tools in custom workflows, use the prebuilt ToolNode or implement your own custom node.</p>
<p>ToolNode is a specialized node for executing tools in a workflow. It provides the following features:</p>
<ul>
<li>
<p>Supports both synchronous and asynchronous tools.</p>
</li>
<li>
<p>Executes multiple tools concurrently.</p>
</li>
<li>
<p>Handles errors during tool execution (handle_tool_errors=True, enabled by default).</p>
</li>
</ul>
<p>ToolNode operates on <code>MessagesState</code>:</p>
<ul>
<li>
<p><strong>Input:</strong> MessagesState, where the last message is an AIMessage containing the tool_calls parameter.</p>
</li>
<li>
<p><strong>Output:</strong> MessagesState updated with the resulting ToolMessage from executed tools.</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolNode</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_weather</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call to get the current weather.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sf&quot;</span><span class="p">,</span> <span class="s2">&quot;san francisco&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 60 degrees and foggy.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 90 degrees and sunny.&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_coolest_cities</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of coolest cities&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;nyc, sf&quot;</span>

<span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">([</span><span class="n">get_weather</span><span class="p">,</span> <span class="n">get_coolest_cities</span><span class="p">])</span>
<span class="n">tool_node</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]})</span>
</code></pre></div>

<p><strong>Single tool call</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AIMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolNode</span>

<span class="c1"># Define tools</span>
<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_weather</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call to get the current weather.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sf&quot;</span><span class="p">,</span> <span class="s2">&quot;san francisco&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 60 degrees and foggy.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 90 degrees and sunny.&quot;</span>

<span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">([</span><span class="n">get_weather</span><span class="p">])</span>

<span class="n">message_with_single_tool_call</span> <span class="o">=</span> <span class="n">AIMessage</span><span class="p">(</span>
    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">tool_calls</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;get_weather&quot;</span><span class="p">,</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;sf&quot;</span><span class="p">},</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;tool_call_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tool_call&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">tool_node</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">message_with_single_tool_call</span><span class="p">]})</span>
</code></pre></div>

<p><strong>Multiple tool calls</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AIMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolNode</span>

<span class="c1"># Define tools</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_weather</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call to get the current weather.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sf&quot;</span><span class="p">,</span> <span class="s2">&quot;san francisco&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 60 degrees and foggy.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 90 degrees and sunny.&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_coolest_cities</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of coolest cities&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;nyc, sf&quot;</span>

<span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">([</span><span class="n">get_weather</span><span class="p">,</span> <span class="n">get_coolest_cities</span><span class="p">])</span>

<span class="n">message_with_multiple_tool_calls</span> <span class="o">=</span> <span class="n">AIMessage</span><span class="p">(</span>
    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">tool_calls</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;get_coolest_cities&quot;</span><span class="p">,</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;tool_call_id_1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tool_call&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;get_weather&quot;</span><span class="p">,</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;sf&quot;</span><span class="p">},</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;tool_call_id_2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tool_call&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">tool_node</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">message_with_multiple_tool_calls</span><span class="p">]})</span>
</code></pre></div>

<p><strong>Use with a chat model</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolNode</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_weather</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call to get the current weather.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sf&quot;</span><span class="p">,</span> <span class="s2">&quot;san francisco&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 60 degrees and foggy.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 90 degrees and sunny.&quot;</span>

<span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">([</span><span class="n">get_weather</span><span class="p">])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-3-5-haiku-latest&quot;</span><span class="p">)</span>
<span class="n">model_with_tools</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">([</span><span class="n">get_weather</span><span class="p">])</span>  


<span class="n">response_message</span> <span class="o">=</span> <span class="n">model_with_tools</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s2">&quot;what&#39;s the weather in sf?&quot;</span><span class="p">)</span>
<span class="n">tool_node</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response_message</span><span class="p">]})</span>
</code></pre></div>

<p><strong>Use in a tool-calling agent</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolNode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">MessagesState</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_weather</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call to get the current weather.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sf&quot;</span><span class="p">,</span> <span class="s2">&quot;san francisco&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 60 degrees and foggy.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;It&#39;s 90 degrees and sunny.&quot;</span>

<span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">([</span><span class="n">get_weather</span><span class="p">])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-3-5-haiku-latest&quot;</span><span class="p">)</span>
<span class="n">model_with_tools</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">([</span><span class="n">get_weather</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">should_continue</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span>
    <span class="n">last_message</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">last_message</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;tools&quot;</span>
    <span class="k">return</span> <span class="n">END</span>

<span class="k">def</span><span class="w"> </span><span class="nf">call_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model_with_tools</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]}</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>

<span class="c1"># Define the two nodes we will cycle between</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;call_model&quot;</span><span class="p">,</span> <span class="n">call_model</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="n">tool_node</span><span class="p">)</span>

<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;call_model&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_conditional_edges</span><span class="p">(</span><span class="s2">&quot;call_model&quot;</span><span class="p">,</span> <span class="n">should_continue</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">])</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="s2">&quot;call_model&quot;</span><span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what&#39;s the weather in sf?&quot;</span><span class="p">}]})</span>
</code></pre></div>

<h2 id="tool-customization">Tool customization<a class="headerlink" href="#tool-customization" title="Permanent link">#</a></h2>
<p>For more control over tool behavior, use the @tool decorator.</p>
<p><strong>Parameter descriptions</strong></p>
<p>Auto-generate descriptions from docstrings:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>

<span class="nd">@tool</span><span class="p">(</span><span class="s2">&quot;multiply_tool&quot;</span><span class="p">,</span> <span class="n">parse_docstring</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two numbers.</span>

<span class="sd">    Args:</span>
<span class="sd">        a: First operand</span>
<span class="sd">        b: Second operand</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
</code></pre></div>

<p><strong>Explicit input schema</strong></p>
<p>Define schemas using args_schema:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MultiplyInputSchema</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two numbers&quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;First operand&quot;</span><span class="p">)</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Second operand&quot;</span><span class="p">)</span>

<span class="nd">@tool</span><span class="p">(</span><span class="s2">&quot;multiply_tool&quot;</span><span class="p">,</span> <span class="n">args_schema</span><span class="o">=</span><span class="n">MultiplyInputSchema</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
</code></pre></div>

<p><strong>Tool name</strong></p>
<p>Override the default tool name using the first argument or name property:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>

<span class="nd">@tool</span><span class="p">(</span><span class="s2">&quot;multiply_tool&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
</code></pre></div>

<h2 id="context-management">Context management<a class="headerlink" href="#context-management" title="Permanent link">#</a></h2>
<p>Tools within LangGraph sometimes require context data, such as runtime-only arguments (e.g., user IDs or session details), that should not be controlled by the model. LangGraph provides three methods for managing such context:</p>
<p><strong>Configuration</strong></p>
<p>Use configuration when you have <strong>immutable</strong> runtime data that tools require, such as user identifiers. You pass these arguments via RunnableConfig at invocation and access them in the tool:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunnableConfig</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_info</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">RunnableConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve user information based on user ID.&quot;&quot;&quot;</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;configurable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;User is John Smith&quot;</span> <span class="k">if</span> <span class="n">user_id</span> <span class="o">==</span> <span class="s2">&quot;user_123&quot;</span> <span class="k">else</span> <span class="s2">&quot;Unknown user&quot;</span>

<span class="c1"># Invocation example with an agent</span>
<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;look up user info&quot;</span><span class="p">}]},</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="s2">&quot;user_123&quot;</span><span class="p">}}</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Extended example: Access config in tools</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunnableConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_user_info</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">RunnableConfig</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Look up user info.&quot;&quot;&quot;</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;configurable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;User is John Smith&quot;</span> <span class="k">if</span> <span class="n">user_id</span> <span class="o">==</span> <span class="s2">&quot;user_123&quot;</span> <span class="k">else</span> <span class="s2">&quot;Unknown user&quot;</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_user_info</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;look up user information&quot;</span><span class="p">}]},</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="s2">&quot;user_123&quot;</span><span class="p">}}</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Short-term memory</strong></p>
<p>Short-term memory maintains dynamic state that changes during a single execution.</p>
<p>To <strong>access</strong> (read) the graph state inside the tools, you can use a special parameter <strong>annotation</strong> — InjectedState:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">NotRequired</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">InjectedState</span><span class="p">,</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt.chat_agent_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentState</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomState</span><span class="p">(</span><span class="n">AgentState</span><span class="p">):</span>
    <span class="c1"># The user_name field in short-term state</span>
    <span class="n">user_name</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_name</span><span class="p">(</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">CustomState</span><span class="p">,</span> <span class="n">InjectedState</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the current user-name from state.&quot;&quot;&quot;</span>
    <span class="c1"># Return stored name or a default if not set</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown user&quot;</span><span class="p">)</span>

<span class="c1"># Example agent setup</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_user_name</span><span class="p">],</span>
    <span class="n">state_schema</span><span class="o">=</span><span class="n">CustomState</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Invocation: reads the name from state (initially empty)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="s2">&quot;what&#39;s my name?&quot;</span><span class="p">})</span>
</code></pre></div>

<p><strong>Long-term memory</strong></p>
<p>Use <strong>long-term memory</strong> to store user-specific or application-specific data across conversations. This is useful for applications like chatbots, where you want to remember user preferences or other information.</p>
<p>To use long-term memory, you need to:</p>
<ol>
<li>
<p>Configure a store to persist data across invocations.</p>
</li>
<li>
<p>Access the store from within tools.</p>
</li>
</ol>
<p>To <strong>access</strong> information in the store:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunnableConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_store</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_info</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">RunnableConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Look up user info.&quot;&quot;&quot;</span>
    <span class="c1"># Same as that provided to `builder.compile(store=store)`</span>
    <span class="c1"># or `create_react_agent`</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">get_store</span><span class="p">()</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;configurable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
    <span class="n">user_info</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s2">&quot;users&quot;</span><span class="p">,),</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_info</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">user_info</span> <span class="k">else</span> <span class="s2">&quot;Unknown user&quot;</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">)</span>
</code></pre></div>

<p><strong>Access long-term memory</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunnableConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_store</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.store.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryStore</span>

<span class="n">store</span> <span class="o">=</span> <span class="n">InMemoryStore</span><span class="p">()</span> 

<span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>  
    <span class="p">(</span><span class="s2">&quot;users&quot;</span><span class="p">,),</span>  
    <span class="s2">&quot;user_123&quot;</span><span class="p">,</span>  
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;John Smith&quot;</span><span class="p">,</span>
        <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;English&quot;</span><span class="p">,</span>
    <span class="p">}</span> 
<span class="p">)</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_info</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">RunnableConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Look up user info.&quot;&quot;&quot;</span>
    <span class="c1"># Same as that provided to `create_react_agent`</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">get_store</span><span class="p">()</span> 
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;configurable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
    <span class="n">user_info</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s2">&quot;users&quot;</span><span class="p">,),</span> <span class="n">user_id</span><span class="p">)</span> 
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_info</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">user_info</span> <span class="k">else</span> <span class="s2">&quot;Unknown user&quot;</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_user_info</span><span class="p">],</span>
    <span class="n">store</span><span class="o">=</span><span class="n">store</span> 
<span class="p">)</span>

<span class="c1"># Run the agent</span>
<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;look up user information&quot;</span><span class="p">}]},</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="s2">&quot;user_123&quot;</span><span class="p">}}</span>
<span class="p">)</span>
</code></pre></div>

<p>To <strong>update</strong> information in the store:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunnableConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_store</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_user_info</span><span class="p">(</span><span class="n">user_info</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">RunnableConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save user info.&quot;&quot;&quot;</span>
    <span class="c1"># Same as that provided to `builder.compile(store=store)`</span>
    <span class="c1"># or `create_react_agent`</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">get_store</span><span class="p">()</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;configurable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="s2">&quot;users&quot;</span><span class="p">,),</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">user_info</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;Successfully saved user info.&quot;</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">)</span>
</code></pre></div>

<p><strong>Update long-term memory</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_store</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunnableConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.store.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryStore</span>

<span class="n">store</span> <span class="o">=</span> <span class="n">InMemoryStore</span><span class="p">()</span> 

<span class="k">class</span><span class="w"> </span><span class="nc">UserInfo</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span> 
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_user_info</span><span class="p">(</span><span class="n">user_info</span><span class="p">:</span> <span class="n">UserInfo</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">RunnableConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save user info.&quot;&quot;&quot;</span>
    <span class="c1"># Same as that provided to `create_react_agent`</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">get_store</span><span class="p">()</span> 
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;configurable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="s2">&quot;users&quot;</span><span class="p">,),</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">user_info</span><span class="p">)</span> 
    <span class="k">return</span> <span class="s2">&quot;Successfully saved user info.&quot;</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">save_user_info</span><span class="p">],</span>
    <span class="n">store</span><span class="o">=</span><span class="n">store</span>
<span class="p">)</span>

<span class="c1"># Run the agent</span>
<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;My name is John Smith&quot;</span><span class="p">}]},</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="s2">&quot;user_123&quot;</span><span class="p">}}</span> 
<span class="p">)</span>

<span class="c1"># You can access the store directly to get the value</span>
<span class="n">store</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s2">&quot;users&quot;</span><span class="p">,),</span> <span class="s2">&quot;user_123&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</code></pre></div>

<h2 id="advanced-tool-features">Advanced tool features<a class="headerlink" href="#advanced-tool-features" title="Permanent link">#</a></h2>
<p><strong>Immediate return</strong></p>
<p>Use <code>return_direct=True</code> to immediately return a tool's result without executing additional logic.</p>
<p>This is useful for tools that should not trigger further processing or tool calls, allowing you to return results directly to the user.</p>
<div class="codehilite"><pre><span></span><code><span class="err">@</span><span class="k">tool</span><span class="p">(</span><span class="n">return_direct</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<span class="n">def</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
</code></pre></div>

<p><strong>Extended example: Using return_direct in a prebuilt agent</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>

<span class="nd">@tool</span><span class="p">(</span><span class="n">return_direct</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">add</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what&#39;s 3 + 5?&quot;</span><span class="p">}]}</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Force tool use</strong></p>
<p>If you need to force a specific tool to be used, you will need to configure this at the model level using the <code>tool_choice</code> parameter in the bind_tools method.</p>
<p>Force specific tool usage via tool_choice:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">@tool</span><span class="p">(</span><span class="n">return_direct</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
<span class="n">def</span><span class="w"> </span><span class="n">greet</span><span class="p">(</span><span class="nf">user_name</span><span class="err">:</span><span class="w"> </span><span class="nf">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">int</span><span class="err">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Greet user.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="ss">&quot;Hello {user_name}!&quot;</span>

<span class="n">tools</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">greet</span><span class="o">]</span>

<span class="n">configured_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">bind_tools</span><span class="p">(</span>
<span class="w">    </span><span class="n">tools</span><span class="p">,</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Force</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s1">&#39;greet&#39;</span><span class="w"> </span><span class="n">tool</span>
<span class="w">    </span><span class="n">tool_choice</span><span class="o">=</span><span class="err">{</span><span class="ss">&quot;type&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;tool&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;name&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;greet&quot;</span><span class="err">}</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Extended example: Force tool usage in an agent</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>

<span class="nd">@tool</span><span class="p">(</span><span class="n">return_direct</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">greet</span><span class="p">(</span><span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Greet user.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s2">!&quot;</span>

<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">greet</span><span class="p">]</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">,</span> <span class="n">tool_choice</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tool&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;greet&quot;</span><span class="p">}),</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
<span class="p">)</span>

<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hi, I am Bob&quot;</span><span class="p">}]}</span>
<span class="p">)</span>
</code></pre></div>

<p><code>Forcing tool usage without stopping conditions can create infinite loops. Use one of the following safeguards:</code></p>
<ul>
<li>
<p>Mark the tool with <code>return_direct=True</code> to end the loop after execution.</p>
</li>
<li>
<p>Set <code>recursion_limit</code> to restrict the number of execution steps.</p>
</li>
</ul>
<p><strong>Disable parallel calls</strong></p>
<p>For supported providers, you can disable parallel tool calling by setting <code>parallel_tool_calls=False</code> via the <code>model.bind_tools()</code> method:</p>
<p><strong>Extended example: disable parallel tool calls in a prebuilt agent</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">add</span><span class="p">,</span> <span class="n">multiply</span><span class="p">]</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="c1"># disable parallel tool calls</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">,</span> <span class="n">parallel_tool_calls</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
<span class="p">)</span>

<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what&#39;s 3 + 5 and 4 * 7?&quot;</span><span class="p">}]}</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Handle errors</strong></p>
<p>LangGraph provides built-in error handling for tool execution through the prebuilt ToolNode component, used both independently and in prebuilt agents.</p>
<p>By default, ToolNode catches exceptions raised during tool execution and returns them as ToolMessage objects with a status indicating an error.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AIMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolNode</span>

<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">42</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The ultimate error&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="c1"># Default error handling (enabled by default)</span>
<span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">([</span><span class="n">multiply</span><span class="p">])</span>

<span class="n">message</span> <span class="o">=</span> <span class="n">AIMessage</span><span class="p">(</span>
    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">tool_calls</span><span class="o">=</span><span class="p">[{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;multiply&quot;</span><span class="p">,</span>
        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">},</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;tool_call_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tool_call&quot;</span>
    <span class="p">}]</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">tool_node</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">message</span><span class="p">]})</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;messages&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="n">ToolMessage</span><span class="p">(</span>
<span class="w">        </span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Error: ValueError(&#39;The ultimate error&#39;)</span><span class="se">\n</span><span class="s2"> Please fix your mistakes.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">tool_call_id</span><span class="o">=</span><span class="s1">&#39;tool_call_id&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;error&#39;</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">]}</span>
</code></pre></div>

<p><strong>Disable error handling</strong></p>
<p>To propagate exceptions directly, disable error handling:</p>
<div class="codehilite"><pre><span></span><code><span class="n">tool_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ToolNode</span><span class="p">(</span><span class="o">[</span><span class="n">multiply</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">handle_tool_errors</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
</code></pre></div>

<p><strong>Example output:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;messages&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="n">ToolMessage</span><span class="p">(</span>
<span class="w">        </span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Can&#39;t use 42 as the first operand, please switch operands!&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">tool_call_id</span><span class="o">=</span><span class="s1">&#39;tool_call_id&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;error&#39;</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">]}</span>
</code></pre></div>

<p><strong>Error handling in agents</strong></p>
<p>Error handling in prebuilt agents (<code>create_react_agent</code>) leverages <code>ToolNode</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">multiply</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Default error handling</span>
<span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what&#39;s 42 x 7?&quot;</span><span class="p">}]})</span>
</code></pre></div>

<p>To disable or customize error handling in prebuilt agents, explicitly pass a configured ToolNode:</p>
<div class="codehilite"><pre><span></span><code><span class="n">custom_tool_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ToolNode</span><span class="p">(</span>
<span class="w">    </span><span class="o">[</span><span class="n">multiply</span><span class="o">]</span><span class="p">,</span>
<span class="w">    </span><span class="n">handle_tool_errors</span><span class="o">=</span><span class="ss">&quot;Cannot use 42 as a first operand!&quot;</span>
<span class="p">)</span>

<span class="n">agent_custom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_react_agent</span><span class="p">(</span>
<span class="w">    </span><span class="n">model</span><span class="o">=</span><span class="ss">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">tools</span><span class="o">=</span><span class="n">custom_tool_node</span>
<span class="p">)</span>

<span class="n">agent_custom</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span><span class="err">{</span><span class="ss">&quot;messages&quot;</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;what&#39;s 42 x 7?&quot;}</span><span class="o">]</span><span class="err">}</span><span class="p">)</span>
</code></pre></div>

<p><strong>Handle large numbers of tools</strong></p>
<p>As the number of available tools grows, you may want to limit the scope of the LLM's selection, to decrease token consumption and to help manage sources of error in LLM reasoning.</p>
<p>To address this, you can dynamically adjust the tools available to a model by retrieving relevant tools at runtime using semantic search.</p>
<h2 id="human-in-the-loop">Human-in-the-loop<a class="headerlink" href="#human-in-the-loop" title="Permanent link">#</a></h2>
<p>To review, edit, and approve tool calls in an agent or workflow, use LangGraph's human-in-the-loop features to enable human intervention at any point in a workflow. This is especially useful in large language model (LLM)-driven applications where model output may require validation, correction, or additional context.</p>
<p><img alt="alt text" src="image/langgraph2.png" /></p>
<p><strong>Key capabilities</strong></p>
<ul>
<li><strong>Persistent execution state:</strong> Interrupts use LangGraph's persistence layer, which saves the graph state, to indefinitely pause graph execution until you resume. This is possible because LangGraph checkpoints the graph state after each step, which allows the system to persist execution context and later resume the workflow, continuing from where it left off. This supports asynchronous human review or input without time constraints.</li>
</ul>
<p><strong>There are two ways to pause a graph:</strong></p>
<ul>
<li>
<p><strong>Dynamic interrupts:</strong> Use interrupt to pause a graph from inside a specific node, based on the current state of the graph.</p>
</li>
<li>
<p><strong>Static interrupts:</strong> Use <code>interrupt_before</code> and <code>interrupt_after</code> to pause the graph at pre-defined points, either before or after a node executes.</p>
</li>
</ul>
<p><img alt="alt text" src="image/langgraph3.png" /></p>
<ul>
<li><strong>Flexible integration points:</strong> Human-in-the-loop logic can be introduced at any point in the workflow. This allows targeted human involvement, such as approving API calls, correcting outputs, or guiding conversations.</li>
</ul>
<p><strong>Patterns</strong></p>
<p>There are four typical design patterns that you can implement using <code>interrupt</code> and <code>Command</code>:</p>
<ul>
<li>
<p><strong>Approve or reject:</strong> Pause the graph before a critical step, such as an API call, to review and approve the action. If the action is rejected, you can prevent the graph from executing the step, and potentially take an alternative action. This pattern often involves routing the graph based on the human's input.</p>
</li>
<li>
<p><strong>Edit graph state:</strong> Pause the graph to review and edit the graph state. This is useful for correcting mistakes or updating the state with additional information. This pattern often involves updating the state with the human's input.</p>
</li>
<li>
<p><strong>Review tool calls:</strong> Pause the graph to review and edit tool calls requested by the LLM before tool execution.</p>
</li>
<li>
<p><strong>Validate human input:</strong> Pause the graph to validate human input before proceeding with the next step.</p>
</li>
</ul>
<h2 id="enable-human-intervention">Enable human intervention<a class="headerlink" href="#enable-human-intervention" title="Permanent link">#</a></h2>
<p>To review, edit, and approve tool calls in an agent or workflow, use interrupts to pause a graph and wait for human input. Interrupts use LangGraph's <code>persistence</code> layer, which saves the graph state, to indefinitely pause graph execution until you resume.</p>
<p><strong>Pause using interrupt</strong></p>
<p><strong>Dynamic interrupts</strong> (also known as dynamic breakpoints) are triggered based on the current state of the graph. You can set dynamic interrupts by calling <strong>interrupt function</strong> in the appropriate place. The graph will pause, which allows for human intervention, and then resumes the graph with their input. It's useful for tasks like approvals, edits, or gathering additional context.</p>
<p>To use <code>interrupt</code> in your graph, you need to:</p>
<ol>
<li>
<p><strong>Specify a checkpointer</strong> to save the graph state after each step.</p>
</li>
<li>
<p><strong>Call</strong> <code>interrupt()</code> in the appropriate place. See the <strong>Common Patterns</strong> section for examples.</p>
</li>
<li>
<p><strong>Run the graph</strong> with a <strong>thread ID</strong> until the <code>interrupt</code> is hit.</p>
</li>
<li>
<p><strong>Resume execution</strong> using <code>invoke/stream</code></p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span><span class="p">,</span> <span class="n">Command</span>

<span class="k">def</span><span class="w"> </span><span class="nf">human_node</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">(</span> 
        <span class="p">{</span>
            <span class="s2">&quot;text_to_revise&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;some_text&quot;</span><span class="p">]</span> 
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;some_text&quot;</span><span class="p">:</span> <span class="n">value</span> 
    <span class="p">}</span>


<span class="n">graph</span> <span class="o">=</span> <span class="n">graph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span> 

<span class="c1"># Run the graph until the interrupt is hit.</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;some_id&quot;</span><span class="p">}}</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;some_text&quot;</span><span class="p">:</span> <span class="s2">&quot;original text&quot;</span><span class="p">},</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;__interrupt__&#39;</span><span class="p">])</span> 
<span class="c1"># &gt; [</span>
<span class="c1"># &gt;    Interrupt(</span>
<span class="c1"># &gt;       value={&#39;text_to_revise&#39;: &#39;original text&#39;},</span>
<span class="c1"># &gt;       resumable=True,</span>
<span class="c1"># &gt;       ns=[&#39;human_node:6ce9e64f-edef-fe5d-f7dc-511fa9526960&#39;]</span>
<span class="c1"># &gt;    )</span>
<span class="c1"># &gt; ]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="s2">&quot;Edited text&quot;</span><span class="p">),</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">))</span> 
<span class="c1"># &gt; {&#39;some_text&#39;: &#39;Edited text&#39;}</span>
</code></pre></div>

<p><img alt="alt text" src="image/langgraph4.png" /></p>
<p>When the interrupt function is used within a graph, execution pauses at that point and awaits user input.</p>
<p>To resume execution, use the Command primitive, which can be supplied via the invoke or stream methods. The graph resumes execution from the beginning of the node where interrupt(...) was initially called. This time, the interrupt function will return the value provided in Command(resume=value) rather than pausing again. All code from the beginning of the node to the interrupt will be re-executed.</p>
<div class="codehilite"><pre><span></span><code><span class="gh">#</span> Resume graph execution by providing the user&#39;s input.
graph.invoke(Command(resume={&quot;age&quot;: &quot;25&quot;}), thread_config)
</code></pre></div>

<p><strong>Resume multiple interrupts with one invocation</strong></p>
<p>When nodes with interrupt conditions are run in parallel, it's possible to have multiple interrupts in the task queue. For example, the following graph has two nodes run in parallel that require human input:</p>
<p><img alt="alt text" src="image/langgraph5.png" /></p>
<p>Once your graph has been interrupted and is stalled, you can resume all the interrupts at once with Command.resume, passing a dictionary mapping of interrupt ids to resume values.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunnableConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.checkpoint.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemorySaver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">START</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span><span class="p">,</span> <span class="n">Command</span>


<span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">text_1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">text_2</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">def</span><span class="w"> </span><span class="nf">human_node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">({</span><span class="s2">&quot;text_to_revise&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;text_1&quot;</span><span class="p">]})</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;text_1&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">human_node_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">({</span><span class="s2">&quot;text_to_revise&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;text_2&quot;</span><span class="p">]})</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;text_2&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>


<span class="n">graph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">graph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;human_node_1&quot;</span><span class="p">,</span> <span class="n">human_node_1</span><span class="p">)</span>
<span class="n">graph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;human_node_2&quot;</span><span class="p">,</span> <span class="n">human_node_2</span><span class="p">)</span>

<span class="c1"># Add both nodes in parallel from START</span>
<span class="n">graph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;human_node_1&quot;</span><span class="p">)</span>
<span class="n">graph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;human_node_2&quot;</span><span class="p">)</span>

<span class="n">checkpointer</span> <span class="o">=</span> <span class="n">InMemorySaver</span><span class="p">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">graph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span>

<span class="n">thread_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<span class="n">config</span><span class="p">:</span> <span class="n">RunnableConfig</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="n">thread_id</span><span class="p">}}</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;text_1&quot;</span><span class="p">:</span> <span class="s2">&quot;original text 1&quot;</span><span class="p">,</span> <span class="s2">&quot;text_2&quot;</span><span class="p">:</span> <span class="s2">&quot;original text 2&quot;</span><span class="p">},</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span>
<span class="p">)</span>

<span class="c1"># Resume with mapping of interrupt IDs to values</span>
<span class="n">resume_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">i</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;edited text for </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;text_to_revise&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">interrupts</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="n">resume_map</span><span class="p">),</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">))</span>
<span class="c1"># &gt; {&#39;text_1&#39;: &#39;edited text for original text 1&#39;, &#39;text_2&#39;: &#39;edited text for original text 2&#39;}</span>
</code></pre></div>

<p><strong>Common patterns</strong></p>
<p>Below we show different design patterns that can be implemented using interrupt and Command.</p>
<p><img alt="alt text" src="image/langgraph6.png" /></p>
<p>Pause the graph before a critical step, such as an API call, to review and approve the action. If the action is rejected, you can prevent the graph from executing the step, and potentially take an alternative action.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span><span class="p">,</span> <span class="n">Command</span>

<span class="k">def</span><span class="w"> </span><span class="nf">human_approval</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;some_node&quot;</span><span class="p">,</span> <span class="s2">&quot;another_node&quot;</span><span class="p">]]:</span>
    <span class="n">is_approved</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="s2">&quot;Is this correct?&quot;</span><span class="p">,</span>
            <span class="c1"># Surface the output that should be</span>
            <span class="c1"># reviewed and approved by the human.</span>
            <span class="s2">&quot;llm_output&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">is_approved</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Command</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="s2">&quot;some_node&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Command</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="s2">&quot;another_node&quot;</span><span class="p">)</span>

<span class="c1"># Add the node to the graph in an appropriate location</span>
<span class="c1"># and connect it to the relevant nodes.</span>
<span class="n">graph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;human_approval&quot;</span><span class="p">,</span> <span class="n">human_approval</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">graph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span>

<span class="c1"># After running the graph and hitting the interrupt, the graph will pause.</span>
<span class="c1"># Resume it with either an approval or rejection.</span>
<span class="n">thread_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;some_id&quot;</span><span class="p">}}</span>
<span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">config</span><span class="o">=</span><span class="n">thread_config</span><span class="p">)</span>
</code></pre></div>

<p><img alt="alt text" src="image/langgraph7.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">human_editing</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">(</span>
        <span class="c1"># Interrupt information to surface to the client.</span>
        <span class="c1"># Can be any JSON serializable value.</span>
        <span class="p">{</span>
            <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;Review the output from the LLM and make any necessary edits.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;llm_generated_summary&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;llm_generated_summary&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Update the state with the edited text</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;llm_generated_summary&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;edited_text&quot;</span><span class="p">]</span>
    <span class="p">}</span>

<span class="c1"># Add the node to the graph in an appropriate location</span>
<span class="c1"># and connect it to the relevant nodes.</span>
<span class="n">graph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;human_editing&quot;</span><span class="p">,</span> <span class="n">human_editing</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">graph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span>

<span class="o">...</span>

<span class="c1"># After running the graph and hitting the interrupt, the graph will pause.</span>
<span class="c1"># Resume it with the edited text.</span>
<span class="n">thread_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;some_id&quot;</span><span class="p">}}</span>
<span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="n">Command</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;edited_text&quot;</span><span class="p">:</span> <span class="s2">&quot;The edited text&quot;</span><span class="p">}),</span>
    <span class="n">config</span><span class="o">=</span><span class="n">thread_config</span>
<span class="p">)</span>
</code></pre></div>

<p><img alt="alt text" src="image/langgraph8.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.checkpoint.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemorySaver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>

<span class="c1"># An example of a sensitive tool that requires human review / approval</span>
<span class="k">def</span><span class="w"> </span><span class="nf">book_hotel</span><span class="p">(</span><span class="n">hotel_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Book a hotel&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">(</span>  
        <span class="sa">f</span><span class="s2">&quot;Trying to call `book_hotel` with args </span><span class="se">{{</span><span class="s2">&#39;hotel_name&#39;: </span><span class="si">{</span><span class="n">hotel_name</span><span class="si">}</span><span class="se">}}</span><span class="s2">. &quot;</span>
        <span class="s2">&quot;Please approve or suggest edits.&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;accept&quot;</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;edit&quot;</span><span class="p">:</span>
        <span class="n">hotel_name</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;hotel_name&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown response type: </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Successfully booked a stay at </span><span class="si">{</span><span class="n">hotel_name</span><span class="si">}</span><span class="s2">.&quot;</span>

<span class="n">checkpointer</span> <span class="o">=</span> <span class="n">InMemorySaver</span><span class="p">()</span> 

<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_hotel</span><span class="p">],</span>
    <span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">,</span> 
<span class="p">)</span>
</code></pre></div>

<p>Run the agent with the stream() method, passing the config object to specify the thread ID. This allows the agent to resume the same conversation on future invocations.</p>
<div class="codehilite"><pre><span></span><code>config = {
   &quot;configurable&quot;: {
      &quot;thread_id&quot;: &quot;1&quot;
   }
}

for chunk in agent.stream(
    {&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;book a stay at McKittrick hotel&quot;}]},
    config
):
    print(chunk)
    print(&quot;\n&quot;)
</code></pre></div>

<p><code>You should see that the agent runs until it reaches the interrupt() call, at which point it pauses and waits for human input.</code></p>
<p>Resume the agent with a Command to continue based on human input.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
    <span class="n">Command</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;accept&quot;</span><span class="p">}),</span>  
    <span class="c1"># Command(resume={&quot;type&quot;: &quot;edit&quot;, &quot;args&quot;: {&quot;hotel_name&quot;: &quot;McKittrick Hotel&quot;}}),</span>
    <span class="n">config</span>
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Add interrupts to any tool</strong></p>
<p>You can create a wrapper to add interrupts to any tool. The example below provides a reference implementation compatible with Agent Inbox UI and Agent Chat UI.</p>
<p><strong>Wrapper that adds human-in-the-loop to any tool</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseTool</span><span class="p">,</span> <span class="n">tool</span> <span class="k">as</span> <span class="n">create_tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunnableConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt.interrupt</span><span class="w"> </span><span class="kn">import</span> <span class="n">HumanInterruptConfig</span><span class="p">,</span> <span class="n">HumanInterrupt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">add_human_in_the_loop</span><span class="p">(</span>
    <span class="n">tool</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">BaseTool</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">interrupt_config</span><span class="p">:</span> <span class="n">HumanInterruptConfig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseTool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap a tool to support human-in-the-loop review.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">BaseTool</span><span class="p">):</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="n">create_tool</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interrupt_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">interrupt_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;allow_accept&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;allow_edit&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;allow_respond&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@create_tool</span><span class="p">(</span>  
        <span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">tool</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
        <span class="n">args_schema</span><span class="o">=</span><span class="n">tool</span><span class="o">.</span><span class="n">args_schema</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">call_tool_with_interrupt</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">RunnableConfig</span><span class="p">,</span> <span class="o">**</span><span class="n">tool_input</span><span class="p">):</span>
        <span class="n">request</span><span class="p">:</span> <span class="n">HumanInterrupt</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;action_request&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">tool_input</span>
            <span class="p">},</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">interrupt_config</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Please review the tool call&quot;</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">([</span><span class="n">request</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>  
        <span class="c1"># approve the tool call</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;accept&quot;</span><span class="p">:</span>
            <span class="n">tool_response</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">tool_input</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
        <span class="c1"># update tool call args</span>
        <span class="k">elif</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;edit&quot;</span><span class="p">:</span>
            <span class="n">tool_input</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
            <span class="n">tool_response</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">tool_input</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
        <span class="c1"># respond to the LLM with user feedback</span>
        <span class="k">elif</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;response&quot;</span><span class="p">:</span>
            <span class="n">user_feedback</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
            <span class="n">tool_response</span> <span class="o">=</span> <span class="n">user_feedback</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported interrupt response type: </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tool_response</span>

    <span class="k">return</span> <span class="n">call_tool_with_interrupt</span>
</code></pre></div>

<p>You can use the wrapper to add interrupt() to any tool without having to add it inside the tool:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.checkpoint.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemorySaver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>

<span class="n">checkpointer</span> <span class="o">=</span> <span class="n">InMemorySaver</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">book_hotel</span><span class="p">(</span><span class="n">hotel_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;Book a hotel&quot;&quot;&quot;</span>
   <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Successfully booked a stay at </span><span class="si">{</span><span class="n">hotel_name</span><span class="si">}</span><span class="s2">.&quot;</span>


<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span>
        <span class="n">add_human_in_the_loop</span><span class="p">(</span><span class="n">book_hotel</span><span class="p">),</span> 
    <span class="p">],</span>
    <span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">}}</span>

<span class="c1"># Run the agent</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;book a stay at McKittrick hotel&quot;</span><span class="p">}]},</span>
    <span class="n">config</span>
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Validate human input</strong></p>
<p>If you need to validate the input provided by the human within the graph itself (rather than on the client side), you can achieve this by using multiple interrupt calls within a single node.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">human_node</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Human node with validation.&quot;&quot;&quot;</span>
    <span class="n">question</span> <span class="o">=</span> <span class="s2">&quot;What is your age?&quot;</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>

        <span class="c1"># Validate answer, if the answer isn&#39;t valid ask for input again.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">answer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">question</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="s2"> is not a valid age. What is your age?&quot;</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the answer is valid, we can proceed.</span>
            <span class="k">break</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The human in the loop is </span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="s2"> years old.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">answer</span>
    <span class="p">}</span>
</code></pre></div>

<p><strong>Debug with interrupts</strong></p>
<p>To debug and test a graph, use static interrupts (also known as static breakpoints) to step through the graph execution one node at a time or to pause the graph execution at specific nodes. Static interrupts are triggered at defined points either before or after a node executes. You can set static interrupts by specifying interrupt_before and interrupt_after at compile time or run time.</p>
<p><code>Static interrupts are not recommended for human-in-the-loop workflows. Use dynamic interrupts instead.</code></p>
<p><strong>compile time</strong></p>
<div class="codehilite"><pre><span></span><code>graph = graph_builder.compile( 
    interrupt_before=[&quot;node_a&quot;], 
    interrupt_after=[&quot;node_b&quot;, &quot;node_c&quot;], 
    checkpointer=checkpointer, 
)

config = {
    &quot;configurable&quot;: {
        &quot;thread_id&quot;: &quot;some_thread&quot;
    }
}

<span class="gh">#</span> Run the graph until the breakpoint
graph.invoke(inputs, config=thread_config) 

<span class="gh">#</span> Resume the graph
graph.invoke(None, config=thread_config)
</code></pre></div>

<p><strong>Run time</strong></p>
<div class="codehilite"><pre><span></span><code>graph.invoke( 
    inputs,
    interrupt_before=[&quot;node_a&quot;], 
    interrupt_after=[&quot;node_b&quot;, &quot;node_c&quot;] 
    config={
        &quot;configurable&quot;: {&quot;thread_id&quot;: &quot;some_thread&quot;}
    },
)

config = {
    &quot;configurable&quot;: {
        &quot;thread_id&quot;: &quot;some_thread&quot;
    }
}

<span class="gh">#</span> Run the graph until the breakpoint
graph.invoke(inputs, config=config) 

<span class="gh">#</span> Resume the graph
graph.invoke(None, config=config)
</code></pre></div>

<p><code>You cannot set static breakpoints at runtime for sub-graphs. If you have a sub-graph, you must set the breakpoints at compilation time.</code></p>
<p><strong>Use static interrupts in LangGraph Studio</strong></p>
<p>You can use LangGraph Studio to debug your graph. You can set static breakpoints in the UI and then run the graph. You can also use the UI to inspect the graph state at any point in the execution.</p>
<p><img alt="alt text" src="image/langgraph9.png" /></p>
<p><code>LangGraph Studio is free with locally deployed applications using langgraph dev.</code></p>
<p><strong>Considerations</strong></p>
<p>When using human-in-the-loop, there are some considerations to keep in mind.</p>
<p><strong>Using with code with side-effects</strong></p>
<p>Place code with side effects, such as API calls, after the interrupt or in a separate node to avoid duplication, as these are re-triggered every time the node is resumed.</p>
<p><strong>Side effects after interrupt</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">human_node</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Human node with validation.&quot;&quot;&quot;</span>

    <span class="n">answer</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>

    <span class="n">api_call</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span> <span class="c1"># OK as it&#39;s after the interrupt</span>
</code></pre></div>

<p><strong>Side effects in a separate node</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">human_node</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Human node with validation.&quot;&quot;&quot;</span>

    <span class="n">answer</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;answer&quot;</span><span class="p">:</span> <span class="n">answer</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">api_call_node</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">api_call</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># OK as it&#39;s in a separate node</span>
</code></pre></div>

<p><strong>Using with subgraphs called as functions</strong></p>
<p>When invoking a subgraph as a function, the parent graph will resume execution from the <strong>beginning of the node</strong> where the subgraph was invoked where the interrupt was triggered. Similarly, the <strong>subgraph</strong> will resume from the <strong>beginning of the node</strong> where the interrupt() function was called.</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">node_in_parent_graph</span><span class="p">(</span><span class="n">state</span><span class="o">:</span><span class="w"> </span><span class="n">State</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="n">some_code</span><span class="p">()</span><span class="w">  </span><span class="c1"># &lt;-- This will re-execute when the subgraph is resumed.</span>
<span class="w">    </span><span class="c1"># Invoke a subgraph as a function.</span>
<span class="w">    </span><span class="c1"># The subgraph contains an `interrupt` call.</span>
<span class="w">    </span><span class="n">subgraph_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subgraph</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">some_input</span><span class="p">)</span>
<span class="w">    </span><span class="p">...</span>
</code></pre></div>

<p><strong>Using multiple interrupts in a single node</strong></p>
<p>Using multiple interrupts within a single node can be helpful for patterns like validating human input. However, using multiple interrupts in the same node can lead to unexpected behavior if not handled carefully.</p>
<p>When a node contains multiple interrupt calls, LangGraph keeps a list of resume values specific to the task executing the node. Whenever execution resumes, it starts at the beginning of the node. For each interrupt encountered, LangGraph checks if a matching value exists in the task's resume list. Matching is strictly index-based, so the order of interrupt calls within the node is critical.</p>
<p>To avoid issues, refrain from dynamically changing the node's structure between executions. This includes adding, removing, or reordering interrupt calls, as such changes can result in mismatched indices. These problems often arise from unconventional patterns, such as mutating state via Command(resume=..., update=SOME_STATE_MUTATION) or relying on global variables to modify the node's structure dynamically.</p>
<h2 id="time-travel">Time Travel<a class="headerlink" href="#time-travel" title="Permanent link">#</a></h2>
<p>When working with non-deterministic systems that make model-based decisions (e.g., agents powered by LLMs), it can be useful to examine their decision-making process in detail:</p>
<ol>
<li>
<p>🤔 <strong>Understand reasoning:</strong> Analyze the steps that led to a successful result.</p>
</li>
<li>
<p>🐞 <strong>Debug mistakes:</strong> Identify where and why errors occurred.</p>
</li>
<li>
<p>🔍 <strong>Explore alternatives:</strong> Test different paths to uncover better solutions.</p>
</li>
</ol>
<p>LangGraph provides <strong>time travel functionality</strong> to support these use cases. Specifically, you can resume execution from a prior checkpoint — either replaying the same state or modifying it to explore alternatives. In all cases, resuming past execution produces a new fork in the history.</p>
<p><strong>Use time-travel</strong></p>
<p>To use time-travel in LangGraph:</p>
<ol>
<li>
<p><strong>Run the graph</strong> with initial inputs using <strong>invoke</strong> or <strong>stream</strong> methods.</p>
</li>
<li>
<p><strong>Identify a checkpoint in an existing thread:</strong> Use the <code>get_state_history()</code> method to retrieve the execution history for a specific thread_id and locate the desired checkpoint_id.
Alternatively, set an interrupt before the node(s) where you want execution to pause. You can then find the most recent checkpoint recorded up to that interrupt.</p>
</li>
<li>
<p>**Update the graph state (optional): Use the update_state method to modify the graph's state at the checkpoint and resume execution from alternative state.</p>
</li>
<li>
<p><strong>Resume execution from the checkpoint:</strong> Use the invoke or stream methods with an input of None and a configuration containing the appropriate thread_id and checkpoint_id.</p>
</li>
</ol>
<p><strong>In a workflow</strong></p>
<p>This example builds a simple LangGraph workflow that generates a joke topic and writes a joke using an LLM. It demonstrates how to run the graph, retrieve past execution</p>
<p>checkpoints, optionally modify the state, and resume execution from a chosen checkpoint to explore alternate outcomes.</p>
<p><strong>Setup</strong></p>
<p>First we need to install the packages required</p>
<div class="codehilite"><pre><span></span><code><span class="o">%</span><span class="nf">%capture</span><span class="w"> </span><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">stderr</span>
<span class="nf">%pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">--</span><span class="n">quiet</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="n">langgraph</span><span class="w"> </span><span class="n">langchain_anthropic</span>
</code></pre></div>

<p>Next, we need to set API keys for Anthropic (the LLM we will use)</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">NotRequired</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.checkpoint.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemorySaver</span>


<span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">topic</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">joke</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>


<span class="n">llm</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span>
    <span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_topic</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LLM call to generate a topic for the joke&quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s2">&quot;Give me a funny topic for a joke&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">write_joke</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LLM call to write a joke based on the topic&quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write a short joke about </span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;topic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;joke&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>


<span class="c1"># Build workflow</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>

<span class="c1"># Add nodes</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;generate_topic&quot;</span><span class="p">,</span> <span class="n">generate_topic</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;write_joke&quot;</span><span class="p">,</span> <span class="n">write_joke</span><span class="p">)</span>

<span class="c1"># Add edges to connect nodes</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;generate_topic&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;generate_topic&quot;</span><span class="p">,</span> <span class="s2">&quot;write_joke&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;write_joke&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">)</span>

<span class="c1"># Compile</span>
<span class="n">checkpointer</span> <span class="o">=</span> <span class="n">InMemorySaver</span><span class="p">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span>
<span class="n">graph</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">NotRequired</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.checkpoint.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemorySaver</span>


<span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">topic</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">joke</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>


<span class="n">llm</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span>
    <span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_topic</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LLM call to generate a topic for the joke&quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s2">&quot;Give me a funny topic for a joke&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">write_joke</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LLM call to write a joke based on the topic&quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write a short joke about </span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;topic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;joke&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">}</span>


<span class="c1"># Build workflow</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>

<span class="c1"># Add nodes</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;generate_topic&quot;</span><span class="p">,</span> <span class="n">generate_topic</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;write_joke&quot;</span><span class="p">,</span> <span class="n">write_joke</span><span class="p">)</span>

<span class="c1"># Add edges to connect nodes</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;generate_topic&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;generate_topic&quot;</span><span class="p">,</span> <span class="s2">&quot;write_joke&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;write_joke&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">)</span>

<span class="c1"># Compile</span>
<span class="n">checkpointer</span> <span class="o">=</span> <span class="n">InMemorySaver</span><span class="p">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span>
<span class="n">graph</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">How</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="ss">&quot;The Secret Life of Socks in the Dryer&quot;</span><span class="vm">?</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">know</span><span class="p">,</span><span class="w"> </span><span class="n">exploring</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">mysterious</span><span class="w"> </span><span class="n">phenomenon</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">socks</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">laundry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">pairs</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">come</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">singles</span><span class="p">.</span><span class="w"> </span><span class="k">Where</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="k">go</span><span class="vm">?</span><span class="w"> </span><span class="k">Are</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">lives</span><span class="w"> </span><span class="n">elsewhere</span><span class="vm">?</span><span class="w"> </span><span class="k">Is</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sock</span><span class="w"> </span><span class="n">paradise</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t know about? There&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lot</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">comedic</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">everyday</span><span class="w"> </span><span class="n">mystery</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">unites</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="ow">all</span><span class="err">!</span>

<span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Secret</span><span class="w"> </span><span class="n">Life</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">Socks</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Dryer</span>

<span class="n">I</span><span class="w"> </span><span class="n">finally</span><span class="w"> </span><span class="n">discovered</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">missing</span><span class="w"> </span><span class="n">socks</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dryer</span><span class="p">.</span><span class="w"> </span><span class="n">Turns</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">they</span><span class="s1">&#39;re not missing at all—they&#39;</span><span class="n">ve</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">eloped</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">someone</span><span class="w"> </span><span class="k">else</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">socks</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">laundromat</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">lives</span><span class="w"> </span><span class="n">together</span><span class="p">.</span>

<span class="n">My</span><span class="w"> </span><span class="n">blue</span><span class="w"> </span><span class="n">argyle</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">living</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Bermuda</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="n">polka</span><span class="w"> </span><span class="n">dot</span><span class="p">,</span><span class="w"> </span><span class="n">posting</span><span class="w"> </span><span class="n">vacation</span><span class="w"> </span><span class="n">photos</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">Sockstagram</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">sending</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="n">lint</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">alimony</span><span class="p">.</span>
</code></pre></div>

<p>** Identify a checkpoint**</p>
<div class="codehilite"><pre><span></span><code><span class="gh">#</span> The states are returned in reverse chronological order.
states = list(graph.get_state_history(config))

for state in states:
    print(state.next)
    print(state.config[&quot;configurable&quot;][&quot;checkpoint_id&quot;])
    print()
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>()
1f02ac4a-ec9f-6524-8002-8f7b0bbeed0e

(&#39;write_joke&#39;,)
1f02ac4a-ce2a-6494-8001-cb2e2d651227

(&#39;generate_topic&#39;,)
1f02ac4a-a4e0-630d-8000-b73c254ba748

(&#39;__start__&#39;,)
1f02ac4a-a4dd-665e-bfff-e6c8c44315d9
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="gh">#</span> This is the state before last (states are listed in chronological order)
selected_state = states[1]
print(selected_state.next)
print(selected_state.values)
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="s1">&#39;write_joke&#39;</span><span class="p">,)</span>
<span class="err">{</span><span class="s1">&#39;topic&#39;</span><span class="err">:</span><span class="w"> </span><span class="s1">&#39;How about &quot;The Secret Life of Socks in the Dryer&quot;? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don\\&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">about</span><span class="vm">?</span><span class="w"> </span><span class="n">There</span><span class="err">\\</span><span class="s1">&#39;s a lot of comedic potential in the everyday mystery that unites us all!&#39;</span><span class="err">}</span>
</code></pre></div>

<p><strong>Update the state (optional)</strong></p>
<p>update_state will create a new checkpoint. The new checkpoint will be associated with the same thread, but a new checkpoint ID.</p>
<div class="codehilite"><pre><span></span><code>new_config = graph.update_state(selected_state.config, values={&quot;topic&quot;: &quot;chickens&quot;})
print(new_config)
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>{&#39;configurable&#39;: {&#39;thread_id&#39;: &#39;c62e2e03-c27b-4cb6-8cea-ea9bfedae006&#39;, &#39;checkpoint_ns&#39;: &#39;&#39;, &#39;checkpoint_id&#39;: &#39;1f02ac4a-ecee-600b-8002-a1d21df32e4c&#39;}}
</code></pre></div>

<p><strong>Resume execution from the checkpoint</strong></p>
<div class="codehilite"><pre><span></span><code>graph.invoke(None, new_config)
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>{&#39;topic&#39;: &#39;chickens&#39;,
 &#39;joke&#39;: &#39;Why did the chicken join a band?\n\nBecause it had excellent drumsticks!&#39;}
</code></pre></div>

<h2 id="subgraphs">Subgraphs<a class="headerlink" href="#subgraphs" title="Permanent link">#</a></h2>
<p>A subgraph is a graph that is used as a node in another graph — this is the concept of encapsulation applied to LangGraph. Subgraphs allow you to build complex systems with multiple components that are themselves graphs.</p>
<p><img alt="alt text" src="image/langgraph10.png" /></p>
<p>Some reasons for using subgraphs are:</p>
<ul>
<li>
<p>building multi-agent systems</p>
</li>
<li>
<p>when you want to reuse a set of nodes in multiple graphs</p>
</li>
<li>
<p>when you want different teams to work on different parts of the graph independently, you can define each part as a subgraph, and as long as the subgraph interface (the input and output schemas) is respected, the parent graph can be built without knowing any details of the subgraph</p>
</li>
</ul>
<p>The main question when adding subgraphs is how the parent graph and subgraph communicate, i.e. how they pass the state between each other during the graph execution. There are two scenarios:</p>
<ul>
<li>parent and subgraph have shared state keys in their state schemas. In this case, you can include the subgraph as a node in the parent graph</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">MessagesState</span><span class="p">,</span> <span class="n">START</span>

<span class="c1"># Subgraph</span>

<span class="k">def</span><span class="w"> </span><span class="nf">call_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">}</span>

<span class="n">subgraph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">call_model</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">subgraph</span> <span class="o">=</span> <span class="n">subgraph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Parent graph</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;subgraph_node&quot;</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;subgraph_node&quot;</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="o">...</span>
<span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;hi!&quot;</span><span class="p">}]})</span>
</code></pre></div>

<ul>
<li>parent graph and subgraph have <strong>different schemas</strong> (no shared state keys in their state schemas). In this case, you have to call the subgraph from inside a node in the parent graph: this is useful when the parent graph and the subgraph have different state schemas and you need to transform state before or after calling the subgraph</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">Annotated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnyMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">MessagesState</span><span class="p">,</span> <span class="n">START</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_messages</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SubgraphMessagesState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">subgraph_messages</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AnyMessage</span><span class="p">],</span> <span class="n">add_messages</span><span class="p">]</span>

<span class="c1"># Subgraph</span>

<span class="k">def</span><span class="w"> </span><span class="nf">call_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SubgraphMessagesState</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;subgraph_messages&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;subgraph_messages&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">}</span>

<span class="n">subgraph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">SubgraphMessagesState</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;call_model_from_subgraph&quot;</span><span class="p">,</span> <span class="n">call_model</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;call_model_from_subgraph&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">subgraph</span> <span class="o">=</span> <span class="n">subgraph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Parent graph</span>

<span class="k">def</span><span class="w"> </span><span class="nf">call_subgraph</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;subgraph_messages&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]})</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;subgraph_messages&quot;</span><span class="p">]}</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;subgraph_node&quot;</span><span class="p">,</span> <span class="n">call_subgraph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;subgraph_node&quot;</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="o">...</span>
<span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;hi!&quot;</span><span class="p">}]})</span>
</code></pre></div>

<h2 id="use-subgraphs">Use subgraphs<a class="headerlink" href="#use-subgraphs" title="Permanent link">#</a></h2>
<p>This guide explains the mechanics of using subgraphs. A common application of subgraphs is to build multi-agent systems.</p>
<p>When adding subgraphs, you need to define how the parent graph and the subgraph communicate:</p>
<ul>
<li>
<p><strong>Shared state schemas</strong> — parent and subgraph have <strong>shared state keys</strong> in their state schemas</p>
</li>
<li>
<p><strong>Different state schemas</strong> — <strong>no shared state keys</strong> in parent and subgraph schemas</p>
</li>
</ul>
<p><strong>Setup</strong></p>
<div class="codehilite"><pre><span></span><code>pip install -U langgraph
</code></pre></div>

<p><strong>Shared state schemas</strong></p>
<p>A common case is for the parent graph and subgraph to communicate over a shared state key (channel) in the schema. For example, in multi-agent systems, the agents often communicate over a shared messages key.</p>
<p>If your subgraph shares state keys with the parent graph, you can follow these steps to add it to your graph:</p>
<ol>
<li>
<p>Define the subgraph workflow (<code>subgraph_builder</code> in the example below) and compile it</p>
</li>
<li>
<p>Pass compiled subgraph to the <code>.add_node</code> method when defining the parent graph workflow</p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph.state</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span>

<span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># Subgraph</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;hi! &quot;</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]}</span>

<span class="n">subgraph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_1</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">)</span>
<span class="n">subgraph</span> <span class="o">=</span> <span class="n">subgraph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Parent graph</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;node_1&quot;</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
</code></pre></div>

<p><strong>Full example: shared state schemas</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph.state</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span>

<span class="c1"># Define subgraph</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SubgraphState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>  
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span>  

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SubgraphState</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SubgraphState</span><span class="p">):</span>
    <span class="c1"># note that this node is using a state key (&#39;bar&#39;) that is only available in the subgraph</span>
    <span class="c1"># and is sending update on the shared state key (&#39;foo&#39;)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]}</span>

<span class="n">subgraph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">SubgraphState</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_1</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_2</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_2&quot;</span><span class="p">)</span>
<span class="n">subgraph</span> <span class="o">=</span> <span class="n">subgraph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Define parent graph</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ParentState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ParentState</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;hi! &quot;</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]}</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">ParentState</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="n">node_1</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_2&quot;</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;node_1&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="s2">&quot;node_2&quot;</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">stream</span><span class="p">({</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">}):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre></div>

<p><strong>Different state schemas</strong></p>
<p>For more complex systems you might want to define subgraphs that have a <strong>completely different schema</strong> from the parent graph (no shared keys). For example, you might want to keep a private message history for each of the agents in a multi-agent system.</p>
<p>If that's the case for your application, you need to define a node <strong>function that invokes the subgraph</strong>. This function needs to transform the input (parent) state to the subgraph state before invoking the subgraph, and transform the results back to the parent state before returning the state update from the node.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph.state</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SubgraphState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># Subgraph</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SubgraphState</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;hi! &quot;</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]}</span>

<span class="n">subgraph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">SubgraphState</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_1</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">)</span>
<span class="n">subgraph</span> <span class="o">=</span> <span class="n">subgraph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Parent graph</span>

<span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">call_subgraph</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">subgraph_output</span> <span class="o">=</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]})</span>  
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">subgraph_output</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]}</span>  

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="n">call_subgraph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;node_1&quot;</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
</code></pre></div>

<p><strong>Full example: different state schemas</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph.state</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span>

<span class="c1"># Define subgraph</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SubgraphState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="c1"># note that none of these keys are shared with the parent graph state</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SubgraphState</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="s2">&quot;baz&quot;</span><span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SubgraphState</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;baz&quot;</span><span class="p">]}</span>

<span class="n">subgraph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">SubgraphState</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_1</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_2</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_2&quot;</span><span class="p">)</span>
<span class="n">subgraph</span> <span class="o">=</span> <span class="n">subgraph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Define parent graph</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ParentState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ParentState</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;hi! &quot;</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">node_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ParentState</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]})</span>  
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]}</span>  


<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">ParentState</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="n">node_1</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_2&quot;</span><span class="p">,</span> <span class="n">node_2</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;node_1&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="s2">&quot;node_2&quot;</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">stream</span><span class="p">({</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">},</span> <span class="n">subgraphs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre></div>

<p><strong>Full example: different state schemas (two levels of subgraphs)</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Grandchild graph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph.state</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GrandChildState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">my_grandchild_key</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">grandchild_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">GrandChildState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GrandChildState</span><span class="p">:</span>
    <span class="c1"># NOTE: child or parent keys will not be accessible here</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;my_grandchild_key&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;my_grandchild_key&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, how are you&quot;</span><span class="p">}</span>


<span class="n">grandchild</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">GrandChildState</span><span class="p">)</span>
<span class="n">grandchild</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;grandchild_1&quot;</span><span class="p">,</span> <span class="n">grandchild_1</span><span class="p">)</span>

<span class="n">grandchild</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;grandchild_1&quot;</span><span class="p">)</span>
<span class="n">grandchild</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;grandchild_1&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">)</span>

<span class="n">grandchild_graph</span> <span class="o">=</span> <span class="n">grandchild</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Child graph</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ChildState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">my_child_key</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">call_grandchild_graph</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ChildState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChildState</span><span class="p">:</span>
    <span class="c1"># NOTE: parent or grandchild keys won&#39;t be accessible here</span>
    <span class="n">grandchild_graph_input</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;my_grandchild_key&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;my_child_key&quot;</span><span class="p">]}</span>  
    <span class="n">grandchild_graph_output</span> <span class="o">=</span> <span class="n">grandchild_graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">grandchild_graph_input</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;my_child_key&quot;</span><span class="p">:</span> <span class="n">grandchild_graph_output</span><span class="p">[</span><span class="s2">&quot;my_grandchild_key&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; today?&quot;</span><span class="p">}</span>  

<span class="n">child</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">ChildState</span><span class="p">)</span>
<span class="n">child</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;child_1&quot;</span><span class="p">,</span> <span class="n">call_grandchild_graph</span><span class="p">)</span>  
<span class="n">child</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;child_1&quot;</span><span class="p">)</span>
<span class="n">child</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;child_1&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">)</span>
<span class="n">child_graph</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Parent graph</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ParentState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">my_key</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">parent_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ParentState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ParentState</span><span class="p">:</span>
    <span class="c1"># NOTE: child or grandchild keys won&#39;t be accessible here</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;my_key&quot;</span><span class="p">:</span> <span class="s2">&quot;hi &quot;</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;my_key&quot;</span><span class="p">]}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">parent_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ParentState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ParentState</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;my_key&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;my_key&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; bye!&quot;</span><span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">call_child_graph</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ParentState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ParentState</span><span class="p">:</span>
    <span class="n">child_graph_input</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;my_child_key&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;my_key&quot;</span><span class="p">]}</span>  
    <span class="n">child_graph_output</span> <span class="o">=</span> <span class="n">child_graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">child_graph_input</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;my_key&quot;</span><span class="p">:</span> <span class="n">child_graph_output</span><span class="p">[</span><span class="s2">&quot;my_child_key&quot;</span><span class="p">]}</span>  

<span class="n">parent</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">ParentState</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;parent_1&quot;</span><span class="p">,</span> <span class="n">parent_1</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;child&quot;</span><span class="p">,</span> <span class="n">call_child_graph</span><span class="p">)</span>  
<span class="n">parent</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;parent_2&quot;</span><span class="p">,</span> <span class="n">parent_2</span><span class="p">)</span>

<span class="n">parent</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;parent_1&quot;</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;parent_1&quot;</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;child&quot;</span><span class="p">,</span> <span class="s2">&quot;parent_2&quot;</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;parent_2&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">)</span>

<span class="n">parent_graph</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">parent_graph</span><span class="o">.</span><span class="n">stream</span><span class="p">({</span><span class="s2">&quot;my_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">},</span> <span class="n">subgraphs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre></div>

<p><strong>Add persistence</strong></p>
<p>You only need to <strong>provide the checkpointer when compiling the parent graph</strong>. LangGraph will automatically propagate the checkpointer to the child subgraphs.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">START</span><span class="p">,</span> <span class="n">StateGraph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.checkpoint.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemorySaver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># Subgraph</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;bar&quot;</span><span class="p">}</span>

<span class="n">subgraph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_1</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">)</span>
<span class="n">subgraph</span> <span class="o">=</span> <span class="n">subgraph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Parent graph</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;node_1&quot;</span><span class="p">)</span>

<span class="n">checkpointer</span> <span class="o">=</span> <span class="n">MemorySaver</span><span class="p">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span>
</code></pre></div>

<p>If you want the subgraph to have its own memory, you can compile it with the appropriate checkpointer option. This is useful in multi-agent systems, if you want agents to keep track of their internal message histories:</p>
<div class="codehilite"><pre><span></span><code>subgraph_builder = StateGraph(...)
subgraph = subgraph_builder.compile(checkpointer=True)
</code></pre></div>

<p><strong>View subgraph state</strong></p>
<p>When you enable persistence, you can inspect the graph state (checkpoint) via the appropriate method. To view the subgraph state, you can use the subgraphs option.</p>
<p>You can inspect the graph state via <code>graph.get_state(config)</code>. To view the subgraph state, you can use <code>graph.get_state(config, subgraphs=True)</code>.</p>
<p><code>Subgraph state can only be viewed when the subgraph is interrupted. Once you resume the graph, you won't be able to access the subgraph state.</code></p>
<p><strong>View interrupted subgraph state</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">START</span><span class="p">,</span> <span class="n">StateGraph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.checkpoint.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemorySaver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span><span class="p">,</span> <span class="n">Command</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># Subgraph</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">(</span><span class="s2">&quot;Provide value:&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span><span class="p">}</span>

<span class="n">subgraph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_1</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">)</span>

<span class="n">subgraph</span> <span class="o">=</span> <span class="n">subgraph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Parent graph</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;node_1&quot;</span><span class="p">)</span>

<span class="n">checkpointer</span> <span class="o">=</span> <span class="n">MemorySaver</span><span class="p">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">}}</span>

<span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span> <span class="n">config</span><span class="p">)</span>
<span class="n">parent_state</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">subgraph_state</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">subgraphs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">state</span>  

<span class="c1"># resume the subgraph</span>
<span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">),</span> <span class="n">config</span><span class="p">)</span>
</code></pre></div>

<p><strong>Stream subgraph outputs</strong></p>
<p>To include outputs from subgraphs in the streamed outputs, you can set the subgraphs option in the stream method of the parent graph. This will stream outputs from both the parent graph and any subgraphs.</p>
<div class="codehilite"><pre><span></span><code>for chunk in graph.stream(
    {&quot;foo&quot;: &quot;foo&quot;},
    subgraphs=True, 
    stream_mode=&quot;updates&quot;,
):
    print(chunk)
</code></pre></div>

<p><strong>Stream from subgraphs</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph.state</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span>

<span class="c1"># Define subgraph</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SubgraphState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SubgraphState</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subgraph_node_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SubgraphState</span><span class="p">):</span>
    <span class="c1"># note that this node is using a state key (&#39;bar&#39;) that is only available in the subgraph</span>
    <span class="c1"># and is sending update on the shared state key (&#39;foo&#39;)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]}</span>

<span class="n">subgraph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">SubgraphState</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_1</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">subgraph_node_2</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">)</span>
<span class="n">subgraph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;subgraph_node_1&quot;</span><span class="p">,</span> <span class="s2">&quot;subgraph_node_2&quot;</span><span class="p">)</span>
<span class="n">subgraph</span> <span class="o">=</span> <span class="n">subgraph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Define parent graph</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ParentState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">node_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ParentState</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;hi! &quot;</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]}</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">ParentState</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="n">node_1</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;node_2&quot;</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;node_1&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;node_1&quot;</span><span class="p">,</span> <span class="s2">&quot;node_2&quot;</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">},</span>
    <span class="n">stream_mode</span><span class="o">=</span><span class="s2">&quot;updates&quot;</span><span class="p">,</span>
    <span class="n">subgraphs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre></div>

<h2 id="multi-agent-systems">Multi-agent systems<a class="headerlink" href="#multi-agent-systems" title="Permanent link">#</a></h2>
<p>An agent is a system that uses an LLM to decide the control flow of an application. As you develop these systems, they might grow more complex over time, making them harder to manage and scale. For example, you might run into the following problems:</p>
<ul>
<li>
<p>agent has too many tools at its disposal and makes poor decisions about which tool to call next</p>
</li>
<li>
<p>context grows too complex for a single agent to keep track of</p>
</li>
<li>
<p>there is a need for multiple specialization areas in the system (e.g. planner, researcher, math expert, etc.)</p>
</li>
</ul>
<p>To tackle these, you might consider breaking your application into multiple smaller, independent agents and composing them into a <strong>multi-agent system</strong>.These independent agents can be as simple as a prompt and an LLM call, or as complex as a ReAct agent (and more!).</p>
<p>The primary benefits of using multi-agent systems are:</p>
<ul>
<li>
<p><strong>Modularity:</strong> Separate agents make it easier to develop, test, and maintain agentic systems.</p>
</li>
<li>
<p><strong>Specialization:</strong> You can create expert agents focused on specific domains, which helps with the overall system performance.</p>
</li>
<li>
<p><strong>Control:</strong> You can explicitly control how agents communicate (as opposed to relying on function calling).</p>
</li>
</ul>
<h2 id="multi-agent-architectures">Multi-agent architectures<a class="headerlink" href="#multi-agent-architectures" title="Permanent link">#</a></h2>
<p><img alt="alt text" src="image/langgraph11.png" /></p>
<p>There are several ways to connect agents in a multi-agent system:</p>
<ul>
<li>
<p><strong>Network:</strong> each agent can communicate with every other agent. Any agent can decide which other agent to call next.</p>
</li>
<li>
<p><strong>Supervisor:</strong> each agent communicates with a single supervisor agent. Supervisor agent makes decisions on which agent should be called next.</p>
</li>
<li>
<p><strong>Supervisor (tool-calling):</strong> this is a special case of supervisor architecture. Individual agents can be represented as tools. In this case, a supervisor agent uses a tool-calling LLM to decide which of the agent tools to call, as well as the arguments to pass to those agents.</p>
</li>
<li>
<p><strong>Hierarchical:</strong> you can define a multi-agent system with a supervisor of supervisors. This is a generalization of the supervisor architecture and allows for more complex control flows.</p>
</li>
<li>
<p><strong>Custom multi-agent workflow:</strong> each agent communicates with only a subset of agents. Parts of the flow are deterministic, and only some agents can decide which other agents to call next.</p>
</li>
</ul>
<p><strong>Handoffs</strong></p>
<p>In multi-agent architectures, agents can be represented as graph nodes. Each agent node executes its step(s) and decides whether to finish execution or route to another agent, including potentially routing to itself (e.g., running in a loop). A common pattern in multi-agent interactions is <strong>handoffs</strong>, where one agent hands off control to another. Handoffs allow you to specify:</p>
<ul>
<li>
<p><strong>destination:</strong> target agent to navigate to (e.g., name of the node to go to)</p>
</li>
<li>
<p><strong>payload:</strong> information to pass to that agent (e.g., state update)</p>
</li>
</ul>
<p>To implement handoffs in LangGraph, agent nodes can return Command object that allows you to combine both control flow and state updates:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">agent</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;agent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;another_agent&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="c1"># the condition for routing/halting can be anything, e.g. LLM tool call / structured output, etc.</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_next_agent</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="w">  </span><span class="c1"># &#39;agent&#39; / &#39;another_agent&#39;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Command</span><span class="p">(</span>
<span class="w">        </span><span class="c1"># Specify which agent to call next</span>
<span class="w">        </span><span class="n">goto</span><span class="o">=</span><span class="n">goto</span><span class="p">,</span>
<span class="w">        </span><span class="c1"># Update the graph state</span>
<span class="w">        </span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my_state_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my_state_value&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>

<p>In a more complex scenario where each agent node is itself a graph (i.e., a subgraph), a node in one of the agent subgraphs might want to navigate to a different agent. For example, if you have two agents, alice and bob (subgraph nodes in a parent graph), and alice needs to navigate to bob, you can set <code>graph=Command.PARENT</code> in the Command object:</p>
<div class="codehilite"><pre><span></span><code>def some_node_inside_alice(state):
    return Command(
        goto=&quot;bob&quot;,
        update={&quot;my_state_key&quot;: &quot;my_state_value&quot;},
        # specify which graph to navigate to (defaults to the current graph)
        graph=Command.PARENT,
    )
</code></pre></div>

<p>If you need to support visualization for subgraphs communicating using Command(graph=Command.PARENT) you would need to wrap them in a node function with Command annotation: Instead of this:</p>
<div class="codehilite"><pre><span></span><code>builder.add_node(alice)
</code></pre></div>

<p>you would need to do this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">call_alice</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s">&quot;bob&quot;</span><span class="p">]]</span><span class="o">:</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="n">alice</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

<span class="n">builder</span><span class="p">.</span><span class="n">add_node</span><span class="p">(</span><span class="s">&quot;alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">call_alice</span><span class="p">)</span>
</code></pre></div>

<p><strong>Handoffs as tools</strong></p>
<p>One of the most common agent types is a tool-calling agent. For those types of agents, a common pattern is wrapping a handoff in a tool call:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transfer_to_bob</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transfer to bob.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
        <span class="c1"># name of the agent (node) to go to</span>
        <span class="n">goto</span><span class="o">=</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span>
        <span class="c1"># data to send to the agent</span>
        <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my_state_key&quot;</span><span class="p">:</span> <span class="s2">&quot;my_state_value&quot;</span><span class="p">},</span>
        <span class="c1"># indicate to LangGraph that we need to navigate to</span>
        <span class="c1"># agent node in a parent graph</span>
        <span class="n">graph</span><span class="o">=</span><span class="n">Command</span><span class="o">.</span><span class="n">PARENT</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>

<p>This is a special case of updating the graph state from tools where, in addition to the state update, the control flow is included as well.</p>
<p>If you want to use tools that return Command, you can use the prebuilt create_react_agent / ToolNode components, or else implement your own logic:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">call_tools</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="n">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">tools_by_name</span><span class="p">[</span><span class="n">tool_call</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">tool_call</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tool_calls</span><span class="p">]</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">commands</span>
</code></pre></div>

<p><strong>Network</strong></p>
<p>In this architecture, agents are defined as graph nodes. Each agent can communicate with every other agent (many-to-many connections) and can decide which agent to call next. This architecture is good for problems that do not have a clear hierarchy of agents or a specific sequence in which agents should be called.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">MessagesState</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">agent_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;agent_2&quot;</span><span class="p">,</span> <span class="s2">&quot;agent_3&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">]]:</span>
    <span class="c1"># you can pass relevant parts of the state to the LLM (e.g., state[&quot;messages&quot;])</span>
    <span class="c1"># to determine which agent to call next. a common pattern is to call the model</span>
    <span class="c1"># with a structured output (e.g. force it to return an output with a &quot;next_agent&quot; field)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># route to one of the agents or exit based on the LLM&#39;s decision</span>
    <span class="c1"># if the LLM returns &quot;__end__&quot;, the graph will finish execution</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
        <span class="n">goto</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;next_agent&quot;</span><span class="p">],</span>
        <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]]},</span>
    <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">agent_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;agent_1&quot;</span><span class="p">,</span> <span class="s2">&quot;agent_3&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">]]:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
        <span class="n">goto</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;next_agent&quot;</span><span class="p">],</span>
        <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]]},</span>
    <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">agent_3</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;agent_1&quot;</span><span class="p">,</span> <span class="s2">&quot;agent_2&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">]]:</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
        <span class="n">goto</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;next_agent&quot;</span><span class="p">],</span>
        <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]]},</span>
    <span class="p">)</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">agent_1</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">agent_2</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">agent_3</span><span class="p">)</span>

<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;agent_1&quot;</span><span class="p">)</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
</code></pre></div>

<p><strong>Supervisor</strong></p>
<p>In this architecture, we define agents as nodes and add a supervisor node (LLM) that decides which agent nodes should be called next. We use Command to route execution to the appropriate agent node based on supervisor's decision. This architecture also lends itself well to running multiple agents in parallel or using <code>map-reduce pattern</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">MessagesState</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">supervisor</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;agent_1&quot;</span><span class="p">,</span> <span class="s2">&quot;agent_2&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">]]:</span>
    <span class="c1"># you can pass relevant parts of the state to the LLM (e.g., state[&quot;messages&quot;])</span>
    <span class="c1"># to determine which agent to call next. a common pattern is to call the model</span>
    <span class="c1"># with a structured output (e.g. force it to return an output with a &quot;next_agent&quot; field)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># route to one of the agents or exit based on the supervisor&#39;s decision</span>
    <span class="c1"># if the supervisor returns &quot;__end__&quot;, the graph will finish execution</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;next_agent&quot;</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">agent_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;supervisor&quot;</span><span class="p">]]:</span>
    <span class="c1"># you can pass relevant parts of the state to the LLM (e.g., state[&quot;messages&quot;])</span>
    <span class="c1"># and add any additional logic (different models, custom prompts, structured output, etc.)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
        <span class="n">goto</span><span class="o">=</span><span class="s2">&quot;supervisor&quot;</span><span class="p">,</span>
        <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]},</span>
    <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">agent_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;supervisor&quot;</span><span class="p">]]:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
        <span class="n">goto</span><span class="o">=</span><span class="s2">&quot;supervisor&quot;</span><span class="p">,</span>
        <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]},</span>
    <span class="p">)</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">supervisor</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">agent_1</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">agent_2</span><span class="p">)</span>

<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;supervisor&quot;</span><span class="p">)</span>

<span class="n">supervisor</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
</code></pre></div>

<p><strong>Supervisor (tool-calling)</strong></p>
<p>In this variant of the supervisor architecture, we define a supervisor agent which is responsible for calling sub-agents. The sub-agents are exposed to the supervisor as tools, and the supervisor agent decides which tool to call next. The supervisor agent follows a standard implementation as an LLM running in a while loop calling tools until it decides to stop.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">InjectedState</span><span class="p">,</span> <span class="n">create_react_agent</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">()</span>

<span class="c1"># this is the agent function that will be called as tool</span>
<span class="c1"># notice that you can pass the state to the tool via InjectedState annotation</span>
<span class="k">def</span><span class="w"> </span><span class="nf">agent_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">InjectedState</span><span class="p">]):</span>
    <span class="c1"># you can pass relevant parts of the state to the LLM (e.g., state[&quot;messages&quot;])</span>
    <span class="c1"># and add any additional logic (different models, custom prompts, structured output, etc.)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># return the LLM response as a string (expected tool response format)</span>
    <span class="c1"># this will be automatically turned to ToolMessage</span>
    <span class="c1"># by the prebuilt create_react_agent (supervisor)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

<span class="k">def</span><span class="w"> </span><span class="nf">agent_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">InjectedState</span><span class="p">]):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">agent_1</span><span class="p">,</span> <span class="n">agent_2</span><span class="p">]</span>
<span class="c1"># the simplest way to build a supervisor w/ tool-calling is to use prebuilt ReAct agent graph</span>
<span class="c1"># that consists of a tool-calling LLM node (i.e. supervisor) and a tool-executing node</span>
<span class="n">supervisor</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tools</span><span class="p">)</span>
</code></pre></div>

<p><strong>Hierarchical</strong></p>
<p>As you add more agents to your system, it might become too hard for the supervisor to manage all of them. The supervisor might start making poor decisions about which agent to call next, or the context might become too complex for a single supervisor to keep track of. In other words, you end up with the same problems that motivated the multi-agent architecture in the first place.</p>
<p>To address this, you can design your system hierarchically. For example, you can create separate, specialized teams of agents managed by individual supervisors, and a top-level supervisor to manage the teams.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">MessagesState</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">()</span>

<span class="c1"># define team 1 (same as the single supervisor example above)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">team_1_supervisor</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;team_1_agent_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1_agent_2&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">]]:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;next_agent&quot;</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">team_1_agent_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;team_1_supervisor&quot;</span><span class="p">]]:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="s2">&quot;team_1_supervisor&quot;</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]})</span>

<span class="k">def</span><span class="w"> </span><span class="nf">team_1_agent_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;team_1_supervisor&quot;</span><span class="p">]]:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="s2">&quot;team_1_supervisor&quot;</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]})</span>

<span class="n">team_1_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">Team1State</span><span class="p">)</span>
<span class="n">team_1_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">team_1_supervisor</span><span class="p">)</span>
<span class="n">team_1_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">team_1_agent_1</span><span class="p">)</span>
<span class="n">team_1_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">team_1_agent_2</span><span class="p">)</span>
<span class="n">team_1_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;team_1_supervisor&quot;</span><span class="p">)</span>
<span class="n">team_1_graph</span> <span class="o">=</span> <span class="n">team_1_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># define team 2 (same as the single supervisor example above)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Team2State</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">):</span>
    <span class="nb">next</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;team_2_agent_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2_agent_2&quot;</span><span class="p">,</span> <span class="s2">&quot;__end__&quot;</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">team_2_supervisor</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">Team2State</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">team_2_agent_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">Team2State</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">team_2_agent_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">Team2State</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">team_2_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">Team2State</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">team_2_graph</span> <span class="o">=</span> <span class="n">team_2_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>


<span class="c1"># define top-level supervisor</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">top_level_supervisor</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;team_1_graph&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2_graph&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">]]:</span>
    <span class="c1"># you can pass relevant parts of the state to the LLM (e.g., state[&quot;messages&quot;])</span>
    <span class="c1"># to determine which team to call next. a common pattern is to call the model</span>
    <span class="c1"># with a structured output (e.g. force it to return an output with a &quot;next_team&quot; field)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># route to one of the teams or exit based on the supervisor&#39;s decision</span>
    <span class="c1"># if the supervisor returns &quot;__end__&quot;, the graph will finish execution</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;next_team&quot;</span><span class="p">])</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">top_level_supervisor</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;team_1_graph&quot;</span><span class="p">,</span> <span class="n">team_1_graph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;team_2_graph&quot;</span><span class="p">,</span> <span class="n">team_2_graph</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;top_level_supervisor&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;team_1_graph&quot;</span><span class="p">,</span> <span class="s2">&quot;top_level_supervisor&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;team_2_graph&quot;</span><span class="p">,</span> <span class="s2">&quot;top_level_supervisor&quot;</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
</code></pre></div>

<p><strong>Custom multi-agent workflow</strong></p>
<p>In this architecture we add individual agents as graph nodes and define the order in which agents are called ahead of time, in a custom workflow. In LangGraph the workflow can be defined in two ways:</p>
<ul>
<li>
<p><strong>Explicit control flow (normal edges):</strong> LangGraph allows you to explicitly define the control flow of your application (i.e. the sequence of how agents communicate) explicitly, via normal graph edges. This is the most deterministic variant of this architecture above — we always know which agent will be called next ahead of time.</p>
</li>
<li>
<p><strong>Dynamic control flow (Command):</strong> in LangGraph you can allow LLMs to decide parts of your application control flow. This can be achieved by using Command. A special case of this is a supervisor tool-calling architecture. In that case, the tool-calling LLM powering the supervisor agent will make decisions about the order in which the tools (agents) are being called.</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">MessagesState</span><span class="p">,</span> <span class="n">START</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">agent_1</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">agent_2</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]}</span>

<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">agent_1</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">agent_2</span><span class="p">)</span>
<span class="c1"># define the flow explicitly</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;agent_1&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;agent_1&quot;</span><span class="p">,</span> <span class="s2">&quot;agent_2&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Communication and state management</strong></p>
<p>The most important thing when building multi-agent systems is figuring out how the agents communicate.</p>
<p><strong>Handoffs vs tool calls</strong></p>
<p>What is the "payload" that is being passed around between agents? In most of the architectures discussed above, the agents communicate via handoffs and pass the graph state as part of the handoff payload. Specifically, agents pass around lists of messages as part of the graph state. In the case of the supervisor with tool-calling, the payloads are tool call arguments.</p>
<p><img alt="alt text" src="image/langgraph12.png" /></p>
<p><strong>Message passing between agents</strong></p>
<p>The most common way for agents to communicate is via a shared state channel, typically a list of messages. This assumes that there is always at least a single channel (key) in the state that is shared by the agents (e.g., messages). When communicating via a shared message list, there is an additional consideration: should the agents share the full history of their thought process or only the final result?</p>
<p><img alt="alt text" src="image/langgraph13.png" /></p>
<p><strong>Sharing full thought process</strong></p>
<p>Agents can share the full history of their thought process (i.e., "scratchpad") with all other agents. This "scratchpad" would typically look like a list of messages. The benefit of sharing the full thought process is that it might help other agents make better decisions and improve reasoning ability for the system as a whole. The downside is that as the number of agents and their complexity grows, the "scratchpad" will grow quickly and might require additional strategies for memory management.</p>
<p><strong>Sharing only final results</strong></p>
<p>Agents can have their own private "scratchpad" and only share the final result with the rest of the agents. This approach might work better for systems with many agents or agents that are more complex. In this case, you would need to define agents with different state schemas.</p>
<p>For agents called as tools, the supervisor determines the inputs based on the tool schema. Additionally, LangGraph allows passing state to individual tools at runtime, so subordinate agents can access parent state, if needed.</p>
<p><strong>Indicating agent name in messages</strong></p>
<p>It can be helpful to indicate which agent a particular AI message is from, especially for long message histories. Some LLM providers (like OpenAI) support adding a name parameter to messages — you can use that to attach the agent name to the message. If that is not supported, you can consider manually injecting the agent name into the message content, e.g., <agent>alice</agent><message>message from alice</message>.</p>
<h2 id="multi-agent">Multi-agent<a class="headerlink" href="#multi-agent" title="Permanent link">#</a></h2>
<p>A single agent might struggle if it needs to specialize in multiple domains or manage many tools. To tackle this, you can break your agent into smaller, independent agents and compose them into a multi-agent system.</p>
<p>In multi-agent systems, agents need to communicate between each other. They do so via handoffs — a primitive that describes which agent to hand control to and the payload to send to that agent.</p>
<p>Two of the most popular multi-agent architectures are:</p>
<ul>
<li>
<p><strong>supervisor</strong> — individual agents are coordinated by a central supervisor agent. The supervisor controls all communication flow and task delegation, making decisions about which agent to invoke based on the current context and task requirements.</p>
</li>
<li>
<p><strong>swarm</strong> — agents dynamically hand off control to one another based on their specializations. The system remembers which agent was last active, ensuring that on subsequent interactions, the conversation resumes with that agent.</p>
</li>
</ul>
<p><img alt="alt text" src="image/langgraph14.png" /></p>
<p>Use <code>langgraph-supervisor</code> library to create a supervisor multi-agent system:</p>
<div class="codehilite"><pre><span></span><code>pip install langgraph-supervisor
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph_supervisor</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_supervisor</span>

<span class="k">def</span><span class="w"> </span><span class="nf">book_hotel</span><span class="p">(</span><span class="n">hotel_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Book a hotel&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Successfully booked a stay at </span><span class="si">{</span><span class="n">hotel_name</span><span class="si">}</span><span class="s2">.&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">book_flight</span><span class="p">(</span><span class="n">from_airport</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_airport</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Book a flight&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Successfully booked a flight from </span><span class="si">{</span><span class="n">from_airport</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_airport</span><span class="si">}</span><span class="s2">.&quot;</span>

<span class="n">flight_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai:gpt-4o&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_flight</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;You are a flight booking assistant&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span>
<span class="p">)</span>

<span class="n">hotel_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai:gpt-4o&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_hotel</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;You are a hotel booking assistant&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;hotel_assistant&quot;</span>
<span class="p">)</span>

<span class="n">supervisor</span> <span class="o">=</span> <span class="n">create_supervisor</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">flight_assistant</span><span class="p">,</span> <span class="n">hotel_assistant</span><span class="p">],</span>
    <span class="n">model</span><span class="o">=</span><span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">),</span>
    <span class="n">prompt</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;You manage a hotel booking assistant and a&quot;</span>
        <span class="s2">&quot;flight booking assistant. Assign work to them.&quot;</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">supervisor</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;book a flight from BOS to JFK and a stay at McKittrick Hotel&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><img alt="alt text" src="image/langgraph15.png" /></p>
<p>Use <code>langgraph-swarm</code> library to create a swarm multi-agent system:</p>
<div class="codehilite"><pre><span></span><code>pip install langgraph-swarm
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph_swarm</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_swarm</span><span class="p">,</span> <span class="n">create_handoff_tool</span>

<span class="n">transfer_to_hotel_assistant</span> <span class="o">=</span> <span class="n">create_handoff_tool</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;hotel_assistant&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Transfer user to the hotel-booking assistant.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">transfer_to_flight_assistant</span> <span class="o">=</span> <span class="n">create_handoff_tool</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Transfer user to the flight-booking assistant.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">flight_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_flight</span><span class="p">,</span> <span class="n">transfer_to_hotel_assistant</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;You are a flight booking assistant&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span>
<span class="p">)</span>
<span class="n">hotel_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_hotel</span><span class="p">,</span> <span class="n">transfer_to_flight_assistant</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;You are a hotel booking assistant&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;hotel_assistant&quot;</span>
<span class="p">)</span>

<span class="n">swarm</span> <span class="o">=</span> <span class="n">create_swarm</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">flight_assistant</span><span class="p">,</span> <span class="n">hotel_assistant</span><span class="p">],</span>
    <span class="n">default_active_agent</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">swarm</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;book a flight from BOS to JFK and a stay at McKittrick Hotel&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Handoffs</strong></p>
<p>A common pattern in multi-agent interactions is handoffs, where one agent hands off control to another. Handoffs allow you to specify:</p>
<ul>
<li>
<p><strong>destination:</strong> target agent to navigate to</p>
</li>
<li>
<p><strong>payload:</strong> information to pass to that agent</p>
</li>
</ul>
<p>This is used both by <code>langgraph-supervisor</code>(supervisor hands off to individual agents) and <code>langgraph-swarm</code> (an individual agent can hand off to other agents).</p>
<p>To implement handoffs with <code>create_react_agent</code>, you need to:</p>
<ol>
<li>Create a special tool that can transfer control to a different agent</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">transfer_to_bob</span><span class="p">()</span><span class="err">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Transfer to bob.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Command</span><span class="p">(</span>
<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span>
<span class="w">        </span><span class="k">goto</span><span class="o">=</span><span class="ss">&quot;bob&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">agent</span>
<span class="w">        </span><span class="k">update</span><span class="o">=</span><span class="err">{</span><span class="ss">&quot;messages&quot;</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">...</span><span class="o">]</span><span class="err">}</span><span class="p">,</span>
<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">indicate</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">LangGraph</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">navigate</span><span class="w"> </span><span class="k">to</span>
<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">graph</span>
<span class="w">        </span><span class="n">graph</span><span class="o">=</span><span class="n">Command</span><span class="p">.</span><span class="n">PARENT</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>

<ol>
<li>Create individual agents that have access to handoff tools:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">flight_assistant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_react_agent</span><span class="p">(</span>
<span class="w">    </span><span class="o">...</span><span class="p">,</span><span class="w"> </span><span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_flight</span><span class="p">,</span><span class="w"> </span><span class="n">transfer_to_hotel_assistant</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">hotel_assistant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_react_agent</span><span class="p">(</span>
<span class="w">    </span><span class="o">...</span><span class="p">,</span><span class="w"> </span><span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_hotel</span><span class="p">,</span><span class="w"> </span><span class="n">transfer_to_flight_assistant</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<ol>
<li>Define a parent graph that contains individual agents as nodes:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">MessagesState</span>
<span class="n">multi_agent_graph</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">flight_assistant</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">hotel_assistant</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p>Putting this together, here is how you can implement a simple multi-agent system with two agents — a flight booking assistant and a hotel booking assistant:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span><span class="p">,</span> <span class="n">InjectedToolCallId</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span><span class="p">,</span> <span class="n">InjectedState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">MessagesState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_handoff_tool</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;transfer_to_</span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;Transfer to </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@tool</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handoff_tool</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">MessagesState</span><span class="p">,</span> <span class="n">InjectedState</span><span class="p">],</span> 
        <span class="n">tool_call_id</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InjectedToolCallId</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">:</span>
        <span class="n">tool_message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;tool&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Successfully transferred to </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;tool_call_id&quot;</span><span class="p">:</span> <span class="n">tool_call_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>  
            <span class="n">goto</span><span class="o">=</span><span class="n">agent_name</span><span class="p">,</span>  
            <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">tool_message</span><span class="p">]},</span>  
            <span class="n">graph</span><span class="o">=</span><span class="n">Command</span><span class="o">.</span><span class="n">PARENT</span><span class="p">,</span>  
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">handoff_tool</span>

<span class="c1"># Handoffs</span>
<span class="n">transfer_to_hotel_assistant</span> <span class="o">=</span> <span class="n">create_handoff_tool</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;hotel_assistant&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Transfer user to the hotel-booking assistant.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">transfer_to_flight_assistant</span> <span class="o">=</span> <span class="n">create_handoff_tool</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Transfer user to the flight-booking assistant.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Simple agent tools</span>
<span class="k">def</span><span class="w"> </span><span class="nf">book_hotel</span><span class="p">(</span><span class="n">hotel_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Book a hotel&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Successfully booked a stay at </span><span class="si">{</span><span class="n">hotel_name</span><span class="si">}</span><span class="s2">.&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">book_flight</span><span class="p">(</span><span class="n">from_airport</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_airport</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Book a flight&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Successfully booked a flight from </span><span class="si">{</span><span class="n">from_airport</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_airport</span><span class="si">}</span><span class="s2">.&quot;</span>

<span class="c1"># Define agents</span>
<span class="n">flight_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_flight</span><span class="p">,</span> <span class="n">transfer_to_hotel_assistant</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;You are a flight booking assistant&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span>
<span class="p">)</span>
<span class="n">hotel_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_hotel</span><span class="p">,</span> <span class="n">transfer_to_flight_assistant</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;You are a hotel booking assistant&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;hotel_assistant&quot;</span>
<span class="p">)</span>

<span class="c1"># Define multi-agent graph</span>
<span class="n">multi_agent_graph</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">flight_assistant</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">hotel_assistant</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;flight_assistant&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># Run the multi-agent graph</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">multi_agent_graph</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;book a flight from BOS to JFK and a stay at McKittrick Hotel&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="build-multi-agent-systems">Build multi-agent systems<a class="headerlink" href="#build-multi-agent-systems" title="Permanent link">#</a></h2>
<p><strong>Handoffs</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span><span class="p">,</span> <span class="n">InjectedToolCallId</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span><span class="p">,</span> <span class="n">InjectedState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">MessagesState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_handoff_tool</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;transfer_to_</span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;Transfer to </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@tool</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handoff_tool</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">MessagesState</span><span class="p">,</span> <span class="n">InjectedState</span><span class="p">],</span> 
        <span class="n">tool_call_id</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InjectedToolCallId</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">:</span>
        <span class="n">tool_message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;tool&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Successfully transferred to </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;tool_call_id&quot;</span><span class="p">:</span> <span class="n">tool_call_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>  
            <span class="n">goto</span><span class="o">=</span><span class="n">agent_name</span><span class="p">,</span>  
            <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">tool_message</span><span class="p">]},</span>  
            <span class="n">graph</span><span class="o">=</span><span class="n">Command</span><span class="o">.</span><span class="n">PARENT</span><span class="p">,</span>  
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">handoff_tool</span>
</code></pre></div>

<p><strong>Control agent inputs</strong></p>
<p>You can use the Send() primitive to directly send data to the worker agents during the handoff. For example, you can request that the calling agent populate a task description for the next agent:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span><span class="p">,</span> <span class="n">InjectedToolCallId</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">InjectedState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">MessagesState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span><span class="p">,</span> <span class="n">Send</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_task_description_handoff_tool</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;transfer_to_</span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;Ask </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2"> for help.&quot;</span>

    <span class="nd">@tool</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handoff_tool</span><span class="p">(</span>
        <span class="c1"># this is populated by the calling agent</span>
        <span class="n">task_description</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;Description of what the next agent should do, including all of the relevant context.&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="c1"># these parameters are ignored by the LLM</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">MessagesState</span><span class="p">,</span> <span class="n">InjectedState</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">:</span>
        <span class="n">task_description_message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">task_description</span><span class="p">}</span>
        <span class="n">agent_input</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">task_description_message</span><span class="p">]}</span>
        <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
            <span class="n">goto</span><span class="o">=</span><span class="p">[</span><span class="n">Send</span><span class="p">(</span><span class="n">agent_name</span><span class="p">,</span> <span class="n">agent_input</span><span class="p">)],</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">Command</span><span class="o">.</span><span class="n">PARENT</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">handoff_tool</span>
</code></pre></div>

<p><strong>Build a multi-agent system</strong></p>
<p>You can use handoffs in any agents built with LangGraph. We recommend using the prebuilt agent or ToolNode, as they natively support handoffs tools returning Command. Below is an example of how you can implement a multi-agent system for booking travel using handoffs:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">MessagesState</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_handoff_tool</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># same implementation as above</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Handoffs</span>
<span class="n">transfer_to_hotel_assistant</span> <span class="o">=</span> <span class="n">create_handoff_tool</span><span class="p">(</span><span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;hotel_assistant&quot;</span><span class="p">)</span>
<span class="n">transfer_to_flight_assistant</span> <span class="o">=</span> <span class="n">create_handoff_tool</span><span class="p">(</span><span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span><span class="p">)</span>

<span class="c1"># Define agents</span>
<span class="n">flight_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">transfer_to_hotel_assistant</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span>
<span class="p">)</span>
<span class="n">hotel_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">transfer_to_flight_assistant</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;hotel_assistant&quot;</span>
<span class="p">)</span>

<span class="c1"># Define multi-agent graph</span>
<span class="n">multi_agent_graph</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">flight_assistant</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">hotel_assistant</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;flight_assistant&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Full example: Multi-agent system for booking travel</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_to_messages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span><span class="p">,</span> <span class="n">InjectedToolCallId</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span><span class="p">,</span> <span class="n">InjectedState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">MessagesState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>

<span class="c1"># We&#39;ll use `pretty_print_messages` helper to render the streamed agent outputs nicely</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pretty_print_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">pretty_message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">pretty_repr</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">indent</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pretty_message</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">indented</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pretty_message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">indented</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">pretty_print_messages</span><span class="p">(</span><span class="n">update</span><span class="p">,</span> <span class="n">last_message</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">is_subgraph</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">ns</span><span class="p">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">update</span>
        <span class="c1"># skip parent graph updates in the printouts</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">graph_id</span> <span class="o">=</span> <span class="n">ns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Update from subgraph </span><span class="si">{</span><span class="n">graph_id</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">is_subgraph</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node_update</span> <span class="ow">in</span> <span class="n">update</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">update_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Update from node </span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">:&quot;</span>
        <span class="k">if</span> <span class="n">is_subgraph</span><span class="p">:</span>
            <span class="n">update_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">update_label</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">update_label</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">messages</span> <span class="o">=</span> <span class="n">convert_to_messages</span><span class="p">(</span><span class="n">node_update</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">last_message</span><span class="p">:</span>
            <span class="n">messages</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
            <span class="n">pretty_print_message</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">is_subgraph</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_handoff_tool</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;transfer_to_</span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;Transfer to </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@tool</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handoff_tool</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">MessagesState</span><span class="p">,</span> <span class="n">InjectedState</span><span class="p">],</span> 
        <span class="n">tool_call_id</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InjectedToolCallId</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">:</span>
        <span class="n">tool_message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;tool&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Successfully transferred to </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;tool_call_id&quot;</span><span class="p">:</span> <span class="n">tool_call_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>  
            <span class="n">goto</span><span class="o">=</span><span class="n">agent_name</span><span class="p">,</span>  
            <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">tool_message</span><span class="p">]},</span>  
            <span class="n">graph</span><span class="o">=</span><span class="n">Command</span><span class="o">.</span><span class="n">PARENT</span><span class="p">,</span>  
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">handoff_tool</span>

<span class="c1"># Handoffs</span>
<span class="n">transfer_to_hotel_assistant</span> <span class="o">=</span> <span class="n">create_handoff_tool</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;hotel_assistant&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Transfer user to the hotel-booking assistant.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">transfer_to_flight_assistant</span> <span class="o">=</span> <span class="n">create_handoff_tool</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Transfer user to the flight-booking assistant.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Simple agent tools</span>
<span class="k">def</span><span class="w"> </span><span class="nf">book_hotel</span><span class="p">(</span><span class="n">hotel_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Book a hotel&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Successfully booked a stay at </span><span class="si">{</span><span class="n">hotel_name</span><span class="si">}</span><span class="s2">.&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">book_flight</span><span class="p">(</span><span class="n">from_airport</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_airport</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Book a flight&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Successfully booked a flight from </span><span class="si">{</span><span class="n">from_airport</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_airport</span><span class="si">}</span><span class="s2">.&quot;</span>

<span class="c1"># Define agents</span>
<span class="n">flight_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_flight</span><span class="p">,</span> <span class="n">transfer_to_hotel_assistant</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;You are a flight booking assistant&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;flight_assistant&quot;</span>
<span class="p">)</span>
<span class="n">hotel_assistant</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">book_hotel</span><span class="p">,</span> <span class="n">transfer_to_flight_assistant</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;You are a hotel booking assistant&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;hotel_assistant&quot;</span>
<span class="p">)</span>

<span class="c1"># Define multi-agent graph</span>
<span class="n">multi_agent_graph</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">flight_assistant</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">hotel_assistant</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;flight_assistant&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># Run the multi-agent graph</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">multi_agent_graph</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;book a flight from BOS to JFK and a stay at McKittrick Hotel&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">subgraphs</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
    <span class="n">pretty_print_messages</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre></div>

<p><strong>Multi-turn conversation</strong></p>
<p>Users might want to engage in a multi-turn conversation with one or more agents. To build a system that can handle this, you can create a node that uses an interrupt to collect user input and routes back to the active agent.</p>
<p>The agents can then be implemented as nodes in a graph that executes agent steps and determines the next action:</p>
<ol>
<li>
<p><strong>Wait for user input</strong> to continue the conversation, or</p>
</li>
<li>
<p><strong>Route to another agent</strong> (or back to itself, such as in a loop) via a handoff</p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">human</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;agent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;another_agent&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A node for collecting user input.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">user_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">interrupt</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;Ready for user input.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Determine the active agent.</span>
<span class="w">    </span><span class="n">active_agent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">...</span>

<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Command</span><span class="p">(</span>
<span class="w">        </span><span class="n">update</span><span class="o">=</span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;messages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">                </span><span class="s2">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;human&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">user_input</span><span class="p">,</span>
<span class="w">            </span><span class="p">}]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">goto</span><span class="o">=</span><span class="n">active_agent</span>
<span class="w">    </span><span class="p">)</span>

<span class="n">def</span><span class="w"> </span><span class="n">agent</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Command</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;agent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;another_agent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;human&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="c1"># The condition for routing/halting can be anything, e.g. LLM tool call / structured output, etc.</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_next_agent</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="w">  </span><span class="c1"># &#39;agent&#39; / &#39;another_agent&#39;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">goto</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Command</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="n">goto</span><span class="p">,</span><span class="w"> </span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my_state_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my_state_value&quot;</span><span class="p">})</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Command</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="s2">&quot;human&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># Go to human node</span>
</code></pre></div>

<h2 id="mcp">MCP<a class="headerlink" href="#mcp" title="Permanent link">#</a></h2>
<p>Model Context Protocol (MCP) is an open protocol that standardizes how applications provide tools and context to language models. LangGraph agents can use tools defined on MCP servers through the langchain-mcp-adapters library.</p>
<p><img alt="alt text" src="image/langgraph16.png" /></p>
<p>Install the <code>langchain-mcp-adapters</code> library to use MCP tools in LangGraph:</p>
<div class="codehilite"><pre><span></span><code>pip install langchain-mcp-adapters
</code></pre></div>

<p><strong>Use MCP tools</strong></p>
<p>The <code>langchain-mcp-adapters</code> package enables agents to use tools defined across one or more MCP servers.</p>
<p><strong>In an agent</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_mcp_adapters.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiServerMCPClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">MultiServerMCPClient</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;math&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span>
            <span class="c1"># Replace with absolute path to your math_server.py file</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/path/to/math_server.py&quot;</span><span class="p">],</span>
            <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;stdio&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weather&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># Ensure you start your weather server on port 8000</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8000/mcp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable_http&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get_tools</span><span class="p">()</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="s2">&quot;anthropic:claude-3-7-sonnet-latest&quot;</span><span class="p">,</span>
    <span class="n">tools</span>
<span class="p">)</span>
<span class="n">math_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what&#39;s (3 + 5) x 12?&quot;</span><span class="p">}]}</span>
<span class="p">)</span>
<span class="n">weather_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what is the weather in nyc?&quot;</span><span class="p">}]}</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>In a workflow</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_mcp_adapters.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiServerMCPClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">MessagesState</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolNode</span>

<span class="c1"># Initialize the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;anthropic:claude-3-5-sonnet-latest&quot;</span><span class="p">)</span>

<span class="c1"># Set up MCP client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">MultiServerMCPClient</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;math&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span>
            <span class="c1"># Make sure to update to the full absolute path to your math_server.py file</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;./examples/math_server.py&quot;</span><span class="p">],</span>
            <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;stdio&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weather&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># make sure you start your weather server on port 8000</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8000/mcp/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable_http&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get_tools</span><span class="p">()</span>

<span class="c1"># Bind tools to model</span>
<span class="n">model_with_tools</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>

<span class="c1"># Create ToolNode</span>
<span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">should_continue</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span>
    <span class="n">last_message</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">last_message</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;tools&quot;</span>
    <span class="k">return</span> <span class="n">END</span>

<span class="c1"># Define call_model function</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">model_with_tools</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]}</span>

<span class="c1"># Build the graph</span>
<span class="n">builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;call_model&quot;</span><span class="p">,</span> <span class="n">call_model</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="n">tool_node</span><span class="p">)</span>

<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;call_model&quot;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_conditional_edges</span><span class="p">(</span>
    <span class="s2">&quot;call_model&quot;</span><span class="p">,</span>
    <span class="n">should_continue</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="s2">&quot;call_model&quot;</span><span class="p">)</span>

<span class="c1"># Compile the graph</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="c1"># Test the graph</span>
<span class="n">math_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">graph</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what&#39;s (3 + 5) x 12?&quot;</span><span class="p">}]}</span>
<span class="p">)</span>
<span class="n">weather_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">graph</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;what is the weather in nyc?&quot;</span><span class="p">}]}</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Custom MCP servers</strong></p>
<p>To create your own MCP servers, you can use the mcp library. This library provides a simple way to define tools and run them as servers.</p>
<p>Install the MCP library:</p>
<div class="codehilite"><pre><span></span><code>pip install mcp
</code></pre></div>

<p>Use the following reference implementations to test your agent with MCP tool servers.</p>
<p><strong>Example Math Server (stdio transport)</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">mcp.server.fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>

<span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;Math&quot;</span><span class="p">)</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two numbers&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">mcp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;stdio&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Example Weather Server (Streamable HTTP transport)</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">mcp.server.fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>

<span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;Weather&quot;</span><span class="p">)</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_weather</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get weather for location.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;It&#39;s always sunny in New York&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">mcp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;streamable-http&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="tracing">Tracing<a class="headerlink" href="#tracing" title="Permanent link">#</a></h2>
<p>Traces are a series of steps that your application takes to go from input to output. Each of these individual steps is represented by a run. You can use <code>LangSmith</code> to visualize these execution steps. To use it, enable tracing for your application. This enables you to do the following:</p>
<p><strong>Enable tracing for your application</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">LANGSMITH_TRACING</span><span class="o">=</span><span class="bp">true</span>
<span class="k">export</span><span class="w"> </span><span class="n">LANGSMITH_API_KEY</span><span class="o">=&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">key</span><span class="o">&gt;</span>
</code></pre></div>

<h2 id="evals">Evals<a class="headerlink" href="#evals" title="Permanent link">#</a></h2>
<p>To evaluate your agent's performance you can use LangSmith evaluations. You would need to first define an evaluator function to judge the results from an agent, such as final outputs or trajectory. Depending on your evaluation technique, this may or may not involve a reference output:</p>
<div class="codehilite"><pre><span></span><code>def evaluator(*, outputs: dict, reference_outputs: dict):
    # compare agent outputs against reference outputs
    output_messages = outputs[&quot;messages&quot;]
    reference_messages = reference_outputs[&quot;messages&quot;]
    score = compare_messages(output_messages, reference_messages)
    return {&quot;key&quot;: &quot;evaluator_score&quot;, &quot;score&quot;: score}
</code></pre></div>

<p>To get started, you can use prebuilt evaluators from AgentEvals package:</p>
<div class="codehilite"><pre><span></span><code>pip install -U agentevals
</code></pre></div>

<p><strong>Create evaluator</strong></p>
<p>A common way to evaluate agent performance is by comparing its trajectory (the order in which it calls its tools) against a reference trajectory:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentevals.trajectory.match</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_trajectory_match_evaluator</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tool_calls&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;get_weather&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;san francisco&quot;</span><span class="p">}),</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;get_directions&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;destination&quot;</span><span class="p">:</span> <span class="s2">&quot;presidio&quot;</span><span class="p">}),</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">],</span>
    <span class="p">}</span>
<span class="p">]</span>
<span class="n">reference_outputs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tool_calls&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;get_weather&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;san francisco&quot;</span><span class="p">}),</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="c1"># Create the evaluator</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">create_trajectory_match_evaluator</span><span class="p">(</span>
    <span class="n">trajectory_match_mode</span><span class="o">=</span><span class="s2">&quot;superset&quot;</span><span class="p">,</span>  
<span class="p">)</span>

<span class="c1"># Run the evaluator</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">reference_outputs</span><span class="o">=</span><span class="n">reference_outputs</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>LLM-as-a-judge</strong></p>
<p>You can use LLM-as-a-judge evaluator that uses an LLM to compare the trajectory against the reference outputs and output a score:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentevals.trajectory.llm</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">create_trajectory_llm_as_judge</span><span class="p">,</span>
    <span class="n">TRAJECTORY_ACCURACY_PROMPT_WITH_REFERENCE</span>
<span class="p">)</span>

<span class="n">evaluator</span> <span class="o">=</span> <span class="n">create_trajectory_llm_as_judge</span><span class="p">(</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">TRAJECTORY_ACCURACY_PROMPT_WITH_REFERENCE</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai:o3-mini&quot;</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Run evaluator</strong></p>
<p>To run an evaluator, you will first need to create a LangSmith dataset. To use the prebuilt AgentEvals evaluators, you will need a dataset with the following schema:</p>
<ul>
<li><strong>input</strong>: {"messages": [...]} input messages to call the agent with.</li>
<li><strong>output</strong>: {"messages": [...]} expected message history in the agent output. For trajectory evaluation, you can choose to keep only assistant messages.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langsmith</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentevals.trajectory.match</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_trajectory_match_evaluator</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">create_trajectory_match_evaluator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">experiment_results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">inputs</span><span class="p">),</span>
    <span class="c1"># replace with your dataset name</span>
    <span class="n">data</span><span class="o">=</span><span class="s2">&quot;&lt;Name of your dataset&gt;&quot;</span><span class="p">,</span>
    <span class="n">evaluators</span><span class="o">=</span><span class="p">[</span><span class="n">evaluator</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">#</a></h2>
<p><a href="https://langchain-ai.github.io/langgraph/reference/">!LangGraph</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="crewai.html" class="btn btn-neutral float-left" title="crewai"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="AutoGen.html" class="btn btn-neutral float-right" title="AutoGen">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="crewai.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="AutoGen.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
